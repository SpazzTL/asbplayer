(this["webpackJsonp@project/client"]=this["webpackJsonp@project/client"]||[]).push([[0],{297:function(e,t,n){var a={"./de.json":[420,3],"./en.json":[421,4],"./ja.json":[422,5],"./pl.json":[423,6]};function i(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],i=t[0];return n.e(t[1]).then((function(){return n.t(i,3)}))}i.keys=function(){return Object.keys(a)},i.id=297,e.exports=i},330:function(e,t){},332:function(e,t){},346:function(e,t){},348:function(e,t){},371:function(e,t,n){},402:function(e,t,n){"use strict";n.r(t);n(283);var a=n(207),i=n(10),r=n(24),s=n(8),o=n(18),c=n(22),u=n(5),l=n(3),d=n(4),b=n.n(d),f=n(0),h=n.n(f),v=n(94),p=n(25),g=n(257),j=n(214),m=n.n(j),k=v.a.use(g.a).use(m()((function(e){return n(297)("./".concat(e,".json"))}))).use(p.b).init({partialBundledLanguages:!0,resources:{},fallbackLng:"en",debug:!1,ns:"translation",defaultNS:"translation",interpolation:{escapeValue:!1},detection:{order:["localStorage"],lookupLocalStorage:"i18nextLng",caches:["localStorage"]}}),O=n(21),y=n(137),x=n(458),S=n(256),C=n(466);function w(e){var t=Object(f.useState)([0,0]),n=Object(l.a)(t,2),a=n[0],i=n[1];return Object(f.useLayoutEffect)((function(){function t(){e&&i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var T=n(139),F=n(13),_=n(12),P=function(){function e(){Object(F.a)(this,e)}return Object(_.a)(e,null,[{key:"encode",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(a,i){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=new FileReader).onload=function(){var e=Object(s.a)(b.a.mark((function e(t){var r,s,o,c,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=new AudioContext,null!==t.target){e.next=5;break}return i(new Error("Could not obtain buffer to encode")),e.abrupt("return");case 5:return e.next=7,r.decodeAudioData(t.target.result);case 7:for(s=e.sent,o=[],c=0;c<s.numberOfChannels;++c)o.push(s.getChannelData(c));(u=n()).postMessage({command:"encode",audioBuffer:{channels:o,numberOfChannels:s.numberOfChannels,length:s.length,sampleRate:s.sampleRate}}),u.onmessage=function(e){a(new Blob(e.data.buffer,{type:"audio/mp3"})),u.terminate()},u.onerror=function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.error)&&void 0!==t?t:new Error("MP3 encoding failed: "+(null===e||void 0===e?void 0:e.message));i(n),u.terminate()},e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),i(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),r.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function E(){return new Worker(n.p+"static/js/mp3-encoder-worker.7f842300.worker.js")}var R,M=n(120),A=n.n(M);function B(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Math.floor(e/1e3);t=n?Math.round(e/1e3%60*10)/10:a%60;var i=Math.floor(a/60)%60,r=Math.floor(a/3600);return r>0?r+"h"+String(i).padStart(2,"0")+"m"+String(t).padStart(2,"0")+"s":i+"m"+String(t).padStart(2,"0")+"s"}function I(e,t,n,a){for(var i=t,r=t;r>=0&&!D(e,i=r,t,n,a,R.backward);--r);for(var s=i,o=t;o<=e.length-1&&!D(e,s=o,t,n,a,R.forward);++o);return e.slice(i,s+1)}function N(e,t,n){var a=[e],i=e.start-e.originalStart;if(e.end<t){var r=Math.min(t,e.end+n);a.push({text:"",start:e.end,end:r,originalStart:e.end-i,originalEnd:r-i,track:e.track})}if(e.start>0){var s=Math.max(0,e.start-n);a.unshift({text:"",start:s,end:e.start,originalStart:s-i,originalEnd:e.start-i,track:e.track})}return a}function D(e,t,n,a,i,r){var s;return s=r==R.forward?t+1<e.length?e[t+1]:null:t-1>=0?e[t-1]:null,Math.abs(n-t)>=a&&(null===s||Math.abs(s.start-e[n].start)>=i)}function L(e,t){var n=Math.max(0,e.end-e.start);if(0===n)return!1;var a=Math.max(e.start,t[0]);return Math.min(e.end,t[1])-a>=n/2}function H(e){return e.filter((function(e){return""!==e.text.trim()})).map((function(e){return e.text})).join("\n")}function W(e,t){if(0===t.length)return e.text;var n=[e.start,e.end];return H(t.filter((function(e){return L(e,n)})))}function U(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=n,a.download=A()(t),a.click(),URL.revokeObjectURL(n),a.remove()}function z(e){var t=e.subtitleColor,n=e.subtitleSize,a=e.subtitleThickness,r=e.subtitleOutlineThickness,s=e.subtitleOutlineColor,o=e.subtitleBackgroundOpacity,c=e.subtitleBackgroundColor,u=e.subtitleFontFamily,l=e.subtitleCustomStyles,d={color:t,fontSize:"".concat(n,"px"),fontWeight:String(a)};if(r>0){var b=r,f=s;d.webkitTextStroke="".concat(f," ").concat(b,"px")}if(o>0){var h=o,v=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)return{r:255,g:255,b:255};return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(c),p=v.r,g=v.g,j=v.b;d.backgroundColor="rgba(".concat(p,", ").concat(g,", ").concat(j,", ").concat(h,")")}u&&u.length>0&&(d.fontFamily=u);var m,k=Object(i.a)(l);try{for(k.s();!(m=k.n()).done;){var O=m.value;d[O.key]=O.value}}catch(y){k.e(y)}finally{k.f()}return d}function V(e){var t=e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(function(e,t){return(t?"-":"")+e.toLowerCase()}));return t.startsWith("webkit-")||t.startsWith("moz-")||t.startsWith("ms-")||t.startsWith("o-")?"-".concat(t):t}!function(e){e[e.forward=0]="forward",e[e.backward=1]="backward"}(R||(R={}));var K=function(){return new E};function q(){var e={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"};return Object.keys(e).filter(MediaRecorder.isTypeSupported).map((function(t){return[t,e[t]]}))[0]}var G=function(){function e(t,n,a,i,r,s){Object(F.a)(this,e),this._name=void 0,this._start=void 0,this._end=void 0,this.playbackRate=void 0,this._base64=void 0,this._extension=void 0,this.playingAudio=void 0,this.stopAudioTimeout=void 0,this.cachedBlob=void 0,this._name=t+"_"+Math.floor(n)+"_"+Math.floor(a),this._start=n,this._end=a,this.playbackRate=i,this._base64=r,this._extension=s}return Object(_.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"base64",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t,n,a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.playingAudio){e.next=6;break}return this.stopAudio(this.playingAudio),clearTimeout(this.stopAudioTimeout),this.playingAudio=void 0,this.stopAudioTimeout=void 0,e.abrupt("return");case 6:return e.next=8,this._blob();case 8:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),this.playingAudio=n,e.next=16,n.play();case 16:this.stopAudioTimeout=setTimeout((function(){a.stopAudio(n),a.playingAudio=void 0,a.stopAudioTimeout=void 0}),(this._end-this._start)/this.playbackRate+100);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopAudio",value:function(e){e.pause();var t=e.src;e.src="",URL.revokeObjectURL(t)}},{key:"_blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t){return this}},{key:"isSliceable",value:function(){return!1}},{key:"isPlayable",value:function(){return!0}}]),e}(),X=function(){function e(t,n,a,i,r){Object(F.a)(this,e),this.file=void 0,this._name=void 0,this._start=void 0,this._end=void 0,this.playbackRate=void 0,this.trackId=void 0,this._extension=void 0,this.recorderMimeType=void 0,this.clippingAudio=void 0,this.clippingAudioReject=void 0,this.stopClippingTimeout=void 0,this.playingAudio=void 0,this.stopAudioTimeout=void 0,this._blob=void 0;var s=q(),o=Object(l.a)(s,2),c=o[0],u=o[1];this.recorderMimeType=c,this.file=t,this._name=t.name+"_"+n+"_"+a,this._start=n,this._end=a,this.playbackRate=i,this.trackId=r,this._extension=u}return Object(_.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"base64",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(n,a){var i,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new FileReader,e.next=3,t.blob();case 3:void 0===(r=e.sent)?a("Did not finish recording blob"):(i.readAsDataURL(r),i.onloadend=function(){var e=i.result,t=e.substring(e.indexOf(",")+1);n(t)});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t,n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:if(!this.playingAudio){e.next=11;break}return this.stopAudio(this.playingAudio),clearTimeout(this.stopAudioTimeout),this.playingAudio=void 0,this.stopAudioTimeout=void 0,e.abrupt("return");case 11:return e.next=13,this._audioElement(this._blob,!1);case 13:return(t=e.sent).currentTime=0,e.next=17,t.play();case 17:this.playingAudio=t,this.stopAudioTimeout=setTimeout((function(){n.stopAudio(t),n.stopAudioTimeout=void 0,n.playingAudio=void 0}),(this._end-this._start)/this.playbackRate+100);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:if(void 0!==this._blob){e.next=6;break}throw new Error("Did not finish recording blob");case 6:return e.abrupt("return",this._blob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t,n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clippingAudio){e.next=8;break}return this.stopAudio(this.clippingAudio),clearTimeout(this.stopClippingTimeout),null===(t=this.clippingAudioReject)||void 0===t||t.call(this,"Did not finish recording blob"),this.clippingAudio=void 0,this.stopClippingTimeout=void 0,this.clippingAudioReject=void 0,e.abrupt("return",void 0);case 8:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(t,a){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n._audioElement(n.file,!0);case 3:(r=e.sent).oncanplay=function(){var e=Object(s.a)(b.a.mark((function e(s){var o,c,u,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.play(),o=n._captureStream(r),c=new MediaRecorder(o,{mimeType:n.recorderMimeType}),u=[],c.ondataavailable=function(e){u.push(e.data)},l=!1,c.onstop=function(e){l&&t(new Blob(u,{type:n.recorderMimeType}))},c.start(),n.clippingAudioReject=a,n.clippingAudio=r,n.stopClippingTimeout=setTimeout((function(){n.stopAudio(r),n.clippingAudio=void 0,n.stopClippingTimeout=void 0,n.clippingAudioReject=void 0,l=!0,c.stop();var e,t=Object(i.a)(o.getAudioTracks());try{for(t.s();!(e=t.n()).done;){e.value.stop()}}catch(a){t.e(a)}finally{t.f()}}),(n._end-n._start)/n.playbackRate+100);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e,t){var n=this,a=new Audio;return a.src=URL.createObjectURL(e),new Promise((function(e,r){a.onloadedmetadata=function(r){if(t&&n.trackId&&a.audioTracks&&a.audioTracks.length>0){var s,o=Object(i.a)(a.audioTracks);try{for(o.s();!(s=o.n()).done;){var c=s.value;c.enabled=n.trackId===c.id}}catch(u){o.e(u)}finally{o.f()}}a.currentTime=n._start/1e3,a.playbackRate=n.playbackRate,e(a)}}))}},{key:"stopAudio",value:function(e){e.pause();var t=e.src;e.src="",URL.revokeObjectURL(t)}},{key:"_captureStream",value:function(e){var t;if("function"===typeof e.captureStream&&(t=e.captureStream()),"function"===typeof e.mozCaptureStream&&(t=e.mozCaptureStream()),void 0===t)throw new Error("Unable to capture stream from audio");var n,a=new MediaStream,r=Object(i.a)(t.getVideoTracks());try{for(r.s();!(n=r.n()).done;){n.value.stop()}}catch(u){r.e(u)}finally{r.f()}var s,o=Object(i.a)(t.getAudioTracks());try{for(o.s();!(s=o.n()).done;){var c=s.value;c.enabled&&a.addTrack(c)}}catch(u){o.e(u)}finally{o.f()}return a}},{key:"slice",value:function(t,n){return new e(this.file,t,n,this.playbackRate,this.trackId)}},{key:"isSliceable",value:function(){return!0}},{key:"isPlayable",value:function(){return!0}}]),e}(),J=function(){function e(t,n){Object(F.a)(this,e),this.data=void 0,this.workerFactory=void 0,this._blob=void 0,this.data=t,this.workerFactory=n}return Object(_.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return"mp3"}},{key:"start",get:function(){return this.data.start}},{key:"end",get:function(){return this.data.end}},{key:"base64",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(n,a){var i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=new FileReader,e.t0=i,e.next=5,t.blob();case 5:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),i.onloadend=function(){var e=i.result,t=e.substring(e.indexOf(",")+1);n(t)},e.next=13;break;case 10:e.prev=10,e.t2=e.catch(0),a(e.t2);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=9;break}return e.t0=P,e.next=4,this.data.blob();case 4:return e.t1=e.sent,e.t2=this.workerFactory,e.next=8,e.t0.encode.call(e.t0,e.t1,e.t2);case 8:this._blob=e.sent;case 9:return e.abrupt("return",this._blob);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n),this.workerFactory)}},{key:"isSliceable",value:function(){return this.data.isSliceable()}},{key:"isPlayable",value:function(){return this.data.isPlayable()}}]),e}(),Y=function(){function e(t,n,a){Object(F.a)(this,e),this._name=void 0,this._start=void 0,this._end=void 0,this._extension=void 0,this._name="".concat(t,"_").concat(n,"_").concat(a),this._start=n,this._end=a;var i=q(),r=Object(l.a)(i,2);this._extension=r[1]}return Object(_.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"base64",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not supported");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not supported");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not supported");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t){return this}},{key:"isSliceable",value:function(){return!1}},{key:"isPlayable",value:function(){return!1}}]),e}(),Q=function(){function e(t){Object(F.a)(this,e),this.data=void 0,this.data=t}return Object(_.a)(e,[{key:"start",get:function(){return this.data.start}},{key:"end",get:function(){return this.data.end}},{key:"name",get:function(){return this.data.name+"."+this.data.extension}},{key:"play",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:U(e.sent,this.name);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toMp3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K;return this.data instanceof J||"mp3"===this.data.extension?this:new e(new J(this.data,t))}},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n))}},{key:"isSliceable",value:function(){return this.data.isSliceable()}},{key:"isPlayable",value:function(){return this.data.isPlayable()}}],[{key:"fromBase64",value:function(t,n,a,i,r,s){return new e(new G(t.substring(0,t.lastIndexOf(".")),n,a,i,r,s))}},{key:"fromFile",value:function(t,n,a,i,r){return new e(new X(t,n,a,i,r))}},{key:"fromMissingFile",value:function(t,n,a){return new e(new Y(t,n,a))}}]),e}(),Z=function(e,t,n,a){return new Promise((function(i,r){var s=n<=0?1:n/e.width,o=a<=0?1:a/e.height,c=Math.min(1,Math.min(s,o));if(c<1){var u=e.width*c,l=e.height*c;createImageBitmap(e,{resizeWidth:u,resizeHeight:l,resizeQuality:"high"}).then((function(n){e.width=u,e.height=l,t.drawImage(n,0,0),i(e)})).catch((function(e){return r(e)}))}else i(e)}))},$=function(){function e(t,n,a){Object(F.a)(this,e),this._name=void 0,this._base64=void 0,this._extension=void 0,this.cachedBlob=void 0,this._name=t,this._base64=n,this._extension=a}return Object(_.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"available",get:function(){return!0}},{key:"base64",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),ee=function(){function e(t,n,a,i){Object(F.a)(this,e),this.file=void 0,this.timestamp=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this._name=void 0,this.file=t,this._name=t.name+"_"+Math.floor(n)+".jpeg",this.timestamp=n,this.maxWidth=a,this.maxHeight=i}return Object(_.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return"jpeg"}},{key:"available",get:function(){return!0}},{key:"base64",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(n,a){var i,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:i=e.sent,r=i.toDataURL("image/jpeg"),n(r.substring(r.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(n,a){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){null===e?a(new Error("Could not obtain blob")):n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(n,a){var i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=t._videoElement(t.file)).oncanplay=function(){var e=Object(s.a)(b.a.mark((function e(a){var r,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=document.createElement("canvas")).width=i.videoWidth,r.height=i.videoHeight,(s=r.getContext("2d")).drawImage(i,0,0,r.width,r.height),!(t.maxWidth>0||t.maxHeight>0)){e.next=11;break}return e.next=8,Z(r,s,t.maxWidth,t.maxHeight);case 8:n(r),e.next=12;break;case 11:n(r);case 12:URL.revokeObjectURL(i.src);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),te=function(){function e(t,n){Object(F.a)(this,e),this._name=void 0,this._name="".concat(t,"_").concat(Math.floor(n))}return Object(_.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return"jpeg"}},{key:"available",get:function(){return!1}},{key:"base64",value:function(){throw new Error("Not supported")}},{key:"dataUrl",value:function(){throw new Error("Not supported")}},{key:"blob",value:function(){throw new Error("Not supported")}}]),e}(),ne=function(){function e(t){Object(F.a)(this,e),this.data=void 0,this.data=t}return Object(_.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return this.data.extension}},{key:"available",get:function(){return this.data.available}},{key:"base64",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pngBlob",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(n,a){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=createImageBitmap,e.next=4,t.blob();case 4:e.t1=e.sent,(0,e.t0)(e.t1).then((function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toBlob((function(e){e?n(e):a("Failed to convert to PNG")}),"image/png")})),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),a(e.t2);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:U(e.sent,this.data.name);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromBase64",value:function(t,n,a,i){var r=t.substring(0,t.lastIndexOf("."))+"_"+Math.floor(n)+"."+i;return new e(new $(r,a,i))}},{key:"fromFile",value:function(t,n,a,i){return new e(new ee(t,n,a,i))}},{key:"fromMissingFile",value:function(t,n){return new e(new te(t,n))}}]),e}(),ae=function(){function e(){Object(F.a)(this,e)}return Object(_.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(s.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:JSON.stringify(n)});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}]),e}(),ie=['"',"*","_","\\",":"];var re,se,oe,ce=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ae;Object(F.a)(this,e),this.settingsProvider=void 0,this.fetcher=void 0,this.settingsProvider=t,this.fetcher=n}return Object(_.a)(e,[{key:"deckNames",value:function(){var e=Object(s.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("deckNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(s.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelFieldNames",{modelName:t},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWord",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWordGui",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_escapeQuery",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];ie.includes(a)?t+="\\".concat(a):t+=a}return'"'.concat(t,'"')}},{key:"requestPermission",value:function(){var e=Object(s.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("requestPermission",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n,a,i,r,s,o,c,u,l,d){var f,h,v,p,g,j,m,k,O,y,x,S,C,w,T,F,_;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f={},this._appendField(f,this.settingsProvider.sentenceField,t,!0),this._appendField(f,this.settingsProvider.definitionField,n,!0),this._appendField(f,this.settingsProvider.wordField,r,!1),this._appendField(f,this.settingsProvider.sourceField,s,!1),this._appendField(f,this.settingsProvider.urlField,o,!1),c)for(h=0,v=Object.keys(c);h<v.length;h++)p=v[h],this._appendField(f,this.settingsProvider.customAnkiFields[p],c[p],!0);if(g={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,tags:u,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},j="gui"===l,m="updateLast"===l,!(this.settingsProvider.audioField&&a&&a.isPlayable())){e.next=31;break}if(k=this._sanitizeFileName(a.name),!j&&!m){e.next=25;break}return e.t0=this,e.t1=k,e.next=17,a.base64();case 17:return e.t2=e.sent,e.t3=d,e.next=21,e.t0._storeMediaFile.call(e.t0,e.t1,e.t2,e.t3);case 21:O=e.sent.result,this._appendField(f,this.settingsProvider.audioField,"[sound:".concat(O,"]"),!1),e.next=31;break;case 25:return e.t4=k,e.next=28,a.base64();case 28:e.t5=e.sent,e.t6=[this.settingsProvider.audioField],g.note.audio={filename:e.t4,data:e.t5,fields:e.t6};case 31:if(!(this.settingsProvider.imageField&&i&&i.available)){e.next=52;break}if(y=this._sanitizeFileName(i.name),!j&&!m){e.next=46;break}return e.t7=this,e.t8=y,e.next=38,i.base64();case 38:return e.t9=e.sent,e.t10=d,e.next=42,e.t7._storeMediaFile.call(e.t7,e.t8,e.t9,e.t10);case 42:x=e.sent.result,this._appendField(f,this.settingsProvider.imageField,'<div><img src="'.concat(x,'"></div>'),!1),e.next=52;break;case 46:return e.t11=y,e.next=49,i.base64();case 49:e.t12=e.sent,e.t13=[this.settingsProvider.imageField],g.note.picture={filename:e.t11,data:e.t12,fields:e.t13};case 52:g.note.fields=f,e.t14=l,e.next="gui"===e.t14?56:"updateLast"===e.t14?59:"default"===e.t14?84:87;break;case 56:return e.next=58,this._executeAction("guiAddCards",g,d);case 58:return e.abrupt("return",e.sent.result);case 59:return e.next=61,this._executeAction("findNotes",{query:"added:1"},d);case 61:if(0!==(S=e.sent.result.sort()).length){e.next=64;break}throw new Error("Could not find note to update");case 64:return C=S[S.length-1],g.note.id=C,e.next=68,this._executeAction("notesInfo",{notes:[C]});case 68:if(!((w=e.sent).result.length>0&&w.result[0].noteId===C)){e.next=83;break}return F=w.result[0],this.settingsProvider.sentenceField&&F.fields&&"string"===typeof(null===(T=F.fields[this.settingsProvider.sentenceField])||void 0===T?void 0:T.value)&&"string"===typeof g.note.fields[this.settingsProvider.sentenceField]&&(g.note.fields[this.settingsProvider.sentenceField]=this._inheritHtmlMarkup(g.note.fields[this.settingsProvider.sentenceField],F.fields[this.settingsProvider.sentenceField].value)),e.next=74,this._executeAction("updateNoteFields",g,d);case 74:if(!(u.length>0)){e.next=77;break}return e.next=77,this._executeAction("addTags",{notes:[C],tags:u.join(" ")},d);case 77:if(this.settingsProvider.wordField&&F.fields){e.next=79;break}return e.abrupt("return",F.noteId);case 79:if((_=F.fields[this.settingsProvider.wordField])&&_.value){e.next=82;break}return e.abrupt("return",F.noteId);case 82:return e.abrupt("return",_.value);case 83:throw new Error("Could not update last card because the card info could not be fetched");case 84:return e.next=86,this._executeAction("addNote",g,d);case 86:return e.abrupt("return",e.sent.result);case 87:throw new Error("Unknown export mode: "+l);case 88:case"end":return e.stop()}}),e,this)})));return function(t,n,a,i,r,s,o,c,u,l,d){return e.apply(this,arguments)}}()},{key:"_appendField",value:function(e,t,n,a){if(t&&n){var i=a?n.split("\n").join("<br>"):n,r=e[t];r&&(i=r+"<br>"+i),e[t]=i}}},{key:"_sanitizeFileName",value:function(e){return A()(e,{replacement:"_"})}},{key:"_inheritHtmlMarkup",value:function(e,t){for(var n=RegExp("<[^>]*>(.*?)</[^>]*>","ig"),a=t.replace("<br>",""),i=e;;){var r=n.exec(a);if(null===r||r.length<2)break;i=i.replace(r[1],r[0])}return i}},{key:"_storeMediaFile",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n,a){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAction("storeMediaFile",{filename:t,data:n},a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n,a){var i,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={action:t,version:6},n&&(i.params=n),e.next=4,this.fetcher.fetch(a||this.settingsProvider.ankiConnectUrl,i);case 4:if(!(r=e.sent).error){e.next=7;break}throw new Error(r.error);case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}();!function(e){e[e.none=0]="none",e[e.showAnkiDialog=1]="showAnkiDialog",e[e.updateLastCard=2]="updateLastCard"}(re||(re={})),function(e){e[e.atStart=1]="atStart",e[e.atEnd=2]="atEnd"}(se||(se={})),function(e){e[e.normal=1]="normal",e[e.condensed=2]="condensed",e[e.autoPause=3]="autoPause"}(oe||(oe={}));var ue=function(){function e(){Object(F.a)(this,e),this.lastStartedShowing=void 0,this.lastWillStopShowing=void 0,this.onStartedShowing=void 0,this.onWillStopShowing=void 0,this.onNextToShow=void 0}return Object(_.a)(e,[{key:"willStopShowing",value:function(e){var t,n;e.end!==(null===(t=this.lastWillStopShowing)||void 0===t?void 0:t.end)&&(null===(n=this.onWillStopShowing)||void 0===n||n.call(this),this.lastWillStopShowing=e)}},{key:"startedShowing",value:function(e){var t,n;e.start!==(null===(t=this.lastStartedShowing)||void 0===t?void 0:t.start)&&(null===(n=this.onStartedShowing)||void 0===n||n.call(this),this.lastStartedShowing=e)}},{key:"clear",value:function(){this.lastStartedShowing=void 0,this.lastWillStopShowing=void 0}}]),e}(),le=function(){function e(){Object(F.a)(this,e),this.offscreenElement=void 0,this._cachedContentElements={},this._empty=!0}return Object(_.a)(e,[{key:"empty",get:function(){return this._empty}},{key:"clear",value:function(){var e;null===(e=this.offscreenElement)||void 0===e||e.remove(),this.offscreenElement=void 0,this._cachedContentElements={},this._empty=!0}},{key:"add",value:function(e,t){var n=document.createElement("div");n.innerHTML="".concat(t,"\n"),this._cachedContentElements[e]=n,this._offscreenElement().appendChild(n),this._empty=!1}},{key:"return",value:function(e){this._offscreenElement().appendChild(e)}},{key:"get",value:function(e,t){var n=this._cachedContentElements[e];if(!n){if(void 0===t)throw new Error("Cached html not found for key ".concat(e));(n=document.createElement("div")).innerHTML=t(),this._cachedContentElements[e]=n,this._offscreenElement().appendChild(n)}return n}},{key:"_offscreenElement",value:function(){if(this.offscreenElement)return this.offscreenElement;var e=document.createElement("div");return e.className="asbplayer-offscreen",document.body.append(e),this.offscreenElement=e,e}}]),e}(),de=["en","ja","de","pl"],be=n(493),fe=n(6),he=n(494),ve=n(259),pe=n(1),ge=Object(x.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function je(e){var t=ge();return Object(f.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}}),[e.open,e.autoHideDuration,e.onClose]),Object(pe.jsx)("div",{className:t.root,children:Object(pe.jsx)(ve.a,{in:e.open,children:Object(pe.jsx)(he.a,{severity:e.severity,children:e.children})})})}var me=n(460),ke=["tags","onTagsChange"];function Oe(e){var t=e.tags,n=e.onTagsChange,a=Object(u.a)(e,ke),r=Object(f.useState)(""),s=Object(l.a)(r,2),o=s[0],d=s[1];Object(f.useEffect)((function(){t.join(", ")!==o&&d(t.join(", "))}),[o,t]);var b=Object(f.useCallback)((function(e){var t=e.target.value;o.length>t.length&&o.includes(t)&&t.endsWith(",")&&(t=t.substring(0,t.length-1));var a=function(e){var t,n=e.split(" ").join("").split(","),a=[],r=Object(i.a)(n);try{for(r.s();!(t=r.n()).done;){var s=t.value;a.push(s.trim())}}catch(o){r.e(o)}finally{r.f()}return a}(t);d(a.join(", ")),n(a)}),[o,n]);return Object(pe.jsx)(me.a,Object(c.a)(Object(c.a)({},a),{},{value:o,onChange:b}))}var ye=n(262),xe=n(464),Se=n(465),Ce=n(463),we=Object(ye.a)((function(e){return{image:function(e){return{width:e.width,height:e.height,backgroundSize:"contain"}}}}));function Te(e){var t,n=e.open,a=e.image,i=e.onClose,r=Object(f.useState)(),o=Object(l.a)(r,2),c=o[0],u=o[1],d=Object(f.useState)(0),h=Object(l.a)(d,2),v=h[0],p=h[1],g=Object(f.useState)(0),j=Object(l.a)(g,2),m=j[0],k=j[1],O=function(){var e=Object(f.useState)([0,0]),t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(f.useLayoutEffect)((function(){function e(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),y=Object(l.a)(O,2),x=y[0],S=y[1];t=v>0&&m>0?Math.min(1,Math.min(x/(2*v),S/(2*m))):1;var C=we({width:v*t,height:m*t});return Object(f.useEffect)((function(){function e(){return e=Object(s.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.dataUrl();case 4:t=e.sent,(n=new Image).onload=function(){p(n.width),k(n.height),u(t)},n.src=t;case 8:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}u(void 0),function(){e.apply(this,arguments)}()}),[a]),a&&c?Object(pe.jsx)(Ce.a,{open:n,onClose:i,maxWidth:"lg",children:Object(pe.jsx)(xe.a,{children:Object(pe.jsx)(Se.a,{className:C.image,image:c,title:a.name,style:{width:v*t,height:m*t}})})}):null}var Fe=n(160),_e=n.n(Fe),Pe=n(216),Ee=n.n(Pe),Re=n(473),Me=n(130),Ae=n.n(Me),Be=n(472),Ie=n(470),Ne=n(218),De=n.n(Ne),Le=n(217),He=n.n(Le),We=n(471),Ue=n(406),ze=n(468),Ve=n(141),Ke=n(220),qe=n.n(Ke),Ge=n(219),Xe=n.n(Ge),Je=n(128),Ye=n.n(Je),Qe=n(129),Ze=n.n(Qe),$e=n(496),et=n(469),tt=n(467),nt=n(67),at=n(221),it=n.n(at),rt=n(222),st=n.n(rt);function ot(e){var t=e.subtitle,n=e.availableWidth,a=e.scale;if(void 0===t.textImage)return null;var i=a*n/t.textImage.screen.width*t.textImage.image.width;return Object(pe.jsx)("div",{style:{maxWidth:i},children:Object(pe.jsx)("img",{style:{width:"100%"},alt:"subtitle",src:t.textImage.dataUrl})})}var ct=_e()((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},title:{flexGrow:1},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}},rangeSelectSlider:{"& .MuiSlider-markLabel":{transform:"translateX(-3%)"}}}}));function ut(e,t){var n={};return e.subtitles.filter((function(e){return""!==e.text.trim()||void 0!==e.textImage})).map((function(e){return e.start in n?null:(n[e.start]=!0,{value:e.start,label:"".concat(e.text.trim().substring(0,Math.min(e.text.length,3)),"...")})})).filter((function(e){return null!==e})).filter((function(e){return e.value>=t[0]&&e.value<=t[1]}))}function lt(e){return B(e,!0)}function dt(e){var t=e.children,n=e.open,a=e.value;return Object(pe.jsx)(tt.a,{open:n,enterTouchDelay:0,placement:"top",title:a,children:t})}var bt=_e()((function(e){return{root:{marginBottom:e.spacing(1),padding:e.spacing(1),backgroundColor:e.palette.action.disabledBackground}}}));function ft(e){var t=e.selectedSubtitles,n=e.width,a=bt();return 0===t.length||n<=0?null:Object(pe.jsx)(Ve.a,{elevation:0,className:a.root,children:t.map((function(e,t){return Object(pe.jsx)(ot,{availableWidth:n,subtitle:e,scale:1},t)}))})}var ht=Ee()({root:{transform:"translateY(-8px)"}})(ze.a);function vt(e){var t=e.open,n=e.disabled,a=e.text,r=e.onProceed,o=e.onCancel,c=e.onViewImage,u=e.onOpenSettings,d=e.onRerecord,h=e.onCopyToClipboard,v=e.audioClip,g=e.image,j=e.source,m=e.url,k=e.sliderContext,O=e.customFields,y=e.settingsProvider,x=e.anki,S=e.definition,C=e.word,w=e.customFieldValues,T=e.timestampInterval,F=e.timestampBoundaryInterval,_=e.initialTimestampInterval,P=e.lastAppliedTimestampIntervalToText,E=e.lastAppliedTimestampIntervalToAudio,R=e.stateRef,M=ct(),A=Object(f.useState)(""),B=Object(l.a)(A,2),N=B[0],D=B[1],W=Object(f.useState)(""),U=Object(l.a)(W,2),z=U[0],V=U[1],K=Object(f.useState)(""),q=Object(l.a)(K,2),G=q[0],X=q[1],J=Object(f.useState)(),Y=Object(l.a)(J,2),Q=Y[0],Z=Y[1],$=Object(f.useState)(null!==j&&void 0!==j?j:""),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],ae=Object(f.useState)(y.tags),ie=Object(l.a)(ae,2),re=ie[0],se=ie[1],oe=Object(f.useState)(null!==m&&void 0!==m?m:""),ce=Object(l.a)(oe,2),ue=ce[0],le=ce[1],de=Object(f.useState)([]),be=Object(l.a)(de,2),fe=be[0],he=be[1],ve=Object(f.useState)(0),ge=Object(l.a)(ve,2),je=ge[0],ke=ge[1],ye=Object(f.useState)({}),xe=Object(l.a)(ye,2),Se=xe[0],we=xe[1],Te=Object(f.useState)(),Fe=Object(l.a)(Te,2),_e=Fe[0],Pe=Fe[1],Ee=Object(f.useState)([]),Me=Object(l.a)(Ee,2),Ne=Me[0],Le=Me[1],Ve=Object(f.useState)(),Ke=Object(l.a)(Ve,2),Ge=Ke[0],Je=Ke[1],Qe=Object(f.useState)(),at=Object(l.a)(Qe,2),rt=at[0],ot=at[1],bt=Object(f.useState)(),vt=Object(l.a)(bt,2),pt=vt[0],gt=vt[1],jt=Object(f.useState)(),mt=Object(l.a)(jt,2),kt=mt[0],Ot=mt[1],yt=Object(f.useState)(),xt=Object(l.a)(yt,2),St=xt[0],Ct=xt[1],wt=Object(f.useState)(),Tt=Object(l.a)(wt,2),Ft=Tt[0],_t=Tt[1],Pt=Object(f.useState)(0),Et=Object(l.a)(Pt,2),Rt=Et[0],Mt=Et[1],At=Object(f.useState)(),Bt=Object(l.a)(At,2),It=Bt[0],Nt=Bt[1],Dt=Object(f.useCallback)((function(e){var t;Mt(null!==(t=null===e||void 0===e?void 0:e.getBoundingClientRect().width)&&void 0!==t?t:0)}),[]),Lt=Object(p.c)().t;R&&(R.current={text:z,sliderContext:k,definition:N,word:G,source:te,url:ue,customFieldValues:Se,initialTimestampInterval:Ge,timestampBoundaryInterval:pt,lastAppliedTimestampIntervalToText:St,lastAppliedTimestampIntervalToAudio:Ft,timestampInterval:_e});var Ht=Object(f.useCallback)((function(e){return H(k.subtitles.filter((function(t){return L(t,e)})))}),[k]);Object(f.useEffect)((function(){V(null!==a&&void 0!==a?a:""),D(null!==S&&void 0!==S?S:""),X(null!==C&&void 0!==C?C:""),ne(null!==j&&void 0!==j?j:""),le(null!==m&&void 0!==m?m:""),he([]),we(null!==w&&void 0!==w?w:{})}),[a,j,S,C,w,m]),Object(f.useEffect)((function(){se(y.tags)}),[y.tags]),Object(f.useEffect)((function(){var e=T||k&&[k.subtitleStart,k.subtitleEnd]||void 0,t=k&&function(e){var t=e.subtitles.findIndex((function(t){return t.start===e.subtitleStart}));t=-1===t?e.subtitles.length/2:t;var n,a=I(e.subtitles,t,1,5e3),r=null,s=null,o=Object(i.a)(a);try{for(o.s();!(n=o.n()).done;){var c=n.value;(null===r||c.start<r)&&(r=c.start),(null===s||c.end>s)&&(s=c.end)}}catch(u){o.e(u)}finally{o.f()}return null!==r&&null!==s&&[r,s]}(k)||void 0,n=k&&ut(k,t)||void 0,r=void 0===k||void 0===e?[]:k.subtitles.filter((function(t){return L(t,e)}));V(null!==a&&void 0!==a?a:H(r)),Pe(e),Le(r),Je(_||e),Ct(P||e),_t(E||e),gt(null!==F&&void 0!==F?F:t),ot(t),Ot(n)}),[k,_,T,F,P,E]),Object(f.useEffect)((function(){if(v){var e=v;y.preferMp3&&(e=e.toMp3()),Ft&&(e=e.slice(Math.max(0,Math.round(Ft[0])-y.audioPaddingStart),Math.round(Ft[1])+y.audioPaddingEnd)),Nt(e)}else Nt(void 0)}),[v,y.preferMp3,Ft,y.audioPaddingStart,y.audioPaddingEnd]),Object(f.useEffect)((function(){ke(Date.now())}),[G]),Object(f.useEffect)((function(){if(G&&y.wordField){var e=G.trim();if(""!==e&&e!==Q){var t=setTimeout(Object(s.a)(b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=he,t.next=4,x.findNotesWithWord(e);case 4:t.t1=t.sent,(0,t.t0)(t.t1),Z(e),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),console.error(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),500);return function(){return clearTimeout(t)}}}}),[G,je,Q,x,y.wordField]);var Wt,Ut=Object(f.useCallback)((function(e){null!==It&&void 0!==It&&It.isPlayable()&&(e.preventDefault(),e.stopPropagation(),It.play())}),[It]),zt=Object(f.useCallback)((function(e,t){var n={};Object.assign(n,Se),n[e]=t,we(n)}),[Se]);Wt=G&&G.trim()===Q&&y.wordField?fe.length>0?Lt("ankiDialog.foundDuplicateNotes",{count:fe.length,word:G,field:y.wordField}):Lt("ankiDialog.foundNoDuplicateNote",{word:G,field:y.wordField}):"";var Vt,Kt,qt,Gt,Xt=Object(f.useCallback)((function(e){null!==g&&void 0!==g&&g.available&&(e.preventDefault(),e.stopPropagation(),c(g))}),[g,c]),Jt=Object(f.useCallback)((function(){if(void 0!==_e){var e=Ht(_e);V(e),Ct(_e)}}),[Ht,_e]),Yt=Object(f.useCallback)((function(e,t){var n=t;Pe(n);var a=k.subtitles.filter((function(e){return L(e,n)}));if(Le(a),void 0!==St){var i=Ht(St);if(z.trim()===i.trim()){var r=Ht(n);V(r),Ct(n)}}void 0===d&&!0===(null===It||void 0===It?void 0:It.isSliceable())&&_t(n)}),[k,z,St,Ht]),Qt=Object(f.useCallback)((function(e){d?(e.stopPropagation(),d()):_t(_e)}),[d,_e]),Zt=Object(f.useCallback)((function(){if(rt){var e=void 0===k||void 0===Ge?[]:k.subtitles.filter((function(e){return L(e,Ge)}));Le(e),Pe(Ge),gt(rt),Ot(k&&ut(k,rt))}}),[Ge,rt,k]),$t=Object(f.useCallback)((function(){if(pt&&_e){var e=[(pt[0]+_e[0])/2,(pt[1]+_e[1])/2];gt(e),Ot(k&&ut(k,e))}}),[pt,_e,k]),en=Object(f.useCallback)((function(){if(pt&&_e){var e=(pt[1]-pt[0])/4,t=[Math.max(0,Math.min(pt[0]-e,2*pt[0]-_e[0])),Math.max(pt[1]+e,2*pt[1]-_e[1])];gt(t),Ot(k&&ut(k,t))}}),[pt,_e,k]),tn=Object(f.useCallback)(function(){var e=Object(s.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),g){e.next=3;break}return e.abrupt("return");case 3:return e.t0=h,e.next=6,g.pngBlob();case 6:e.t1=e.sent,(0,e.t0)(e.t1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[g,h]),nn=!k||0===k.subtitles.filter((function(e){return""!==e.text.trim()})).length,an=void 0;if(void 0!==d&&(an=Object(pe.jsx)(tt.a,{title:Lt("ankiDialog.rerecord"),children:Object(pe.jsx)("span",{children:Object(pe.jsx)(Ue.a,{disabled:!_e||!Ft||_e[0]===Ft[0]&&_e[1]===Ft[1],onClick:Qt,edge:"end",children:Object(pe.jsx)(He.a,{})})})})),It)if(It.isPlayable()){if(void 0===d&&!It.isSliceable()){var rn;Vt=null!==(rn=Lt("ankiDialog.cannotUpdateAudio"))&&void 0!==rn?rn:void 0}}else Vt=null!==(Kt=Lt("ankiDialog.audioFileLinkLost"))&&void 0!==Kt?Kt:void 0;g&&(g.available||(qt=null!==(Gt=Lt("ankiDialog.imageFileLinkLost"))&&void 0!==Gt?Gt:void 0));return Object(pe.jsxs)(Ce.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onClose:o,children:[Object(pe.jsxs)(et.a,{children:[Object(pe.jsx)(nt.a,{variant:"h6",className:M.title,children:Lt("ankiDialog.title")}),u&&Object(pe.jsx)(Ue.a,{edge:"end",onClick:function(){return u()},children:Object(pe.jsx)(Ye.a,{})}),o&&Object(pe.jsx)(Ue.a,{edge:"end",onClick:function(){return o()},children:Object(pe.jsx)(Ze.a,{})})]}),Object(pe.jsx)(Ie.a,{ref:Dt,children:Object(pe.jsxs)("form",{className:M.root,children:[k&&_e&&Object(pe.jsx)(ft,{selectedSubtitles:Ne.filter((function(e){return void 0!==e.textImage})),width:Rt}),Object(pe.jsx)(me.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,maxRows:8,label:Lt("ankiDialog.sentence"),value:z,onChange:function(e){return V(e.target.value)},InputProps:{endAdornment:_e&&Object(pe.jsx)(ht,{position:"end",children:Object(pe.jsx)(tt.a,{title:Lt("ankiDialog.applySelection"),children:Object(pe.jsx)("span",{children:Object(pe.jsx)(Ue.a,{disabled:!_e||!St||_e[0]===St[0]&&_e[1]===St[1]||nn,onClick:Jt,edge:"end",children:Object(pe.jsx)(De.a,{})})})})})}}),Object(pe.jsx)(me.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,minRows:8,label:Lt("ankiDialog.definition"),value:N,onChange:function(e){return D(e.target.value)}}),Object(pe.jsx)(me.a,{variant:"filled",color:"secondary",fullWidth:!0,label:Lt("ankiDialog.word"),value:G,onChange:function(e){return X(e.target.value)},helperText:Wt,InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:Object(pe.jsx)(tt.a,{title:Lt("ankiDialog.searchInAnki"),children:Object(pe.jsx)("span",{children:Object(pe.jsx)(Ue.a,{disabled:n||!y.wordField||!G||""===G.trim(),onClick:function(){return x.findNotesWithWordGui(G.trim())},edge:"end",children:Object(pe.jsx)(Xe.a,{})})})})})}}),Object.keys(O).map((function(e){return Object(pe.jsx)(me.a,{variant:"filled",color:"secondary",fullWidth:!0,multiline:!0,maxRows:8,label:e,value:Se[e]||"",onChange:function(t){return zt(e,t.target.value)}},e)})),It&&Object(pe.jsx)("div",{className:M.mediaField,onClick:Ut,children:Object(pe.jsx)(me.a,{variant:"filled",color:"secondary",fullWidth:!0,value:It.name,label:Lt("ankiDialog.audio"),helperText:Vt,disabled:!It.isPlayable(),InputProps:{endAdornment:an&&_e&&Object(pe.jsx)(ze.a,{position:"end",children:an})}})}),g&&Object(pe.jsx)("div",{className:M.mediaField,onClick:Xt,children:Object(pe.jsx)(me.a,{variant:"filled",color:"secondary",fullWidth:!0,value:g.name,label:Lt("ankiDialog.image"),helperText:qt,disabled:!g.available,InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:Object(pe.jsx)(tt.a,{title:Lt("ankiDialog.copyToClipboard"),children:Object(pe.jsx)("span",{children:Object(pe.jsx)(Ue.a,{disabled:!g.available,onClick:tn,edge:"end",children:Object(pe.jsx)(Ae.a,{})})})})})}})}),Object(pe.jsx)(me.a,{variant:"filled",color:"secondary",fullWidth:!0,label:Lt("ankiDialog.source"),value:te,onChange:function(e){return ne(e.target.value)}}),m&&Object(pe.jsx)(me.a,{variant:"filled",color:"secondary",fullWidth:!0,label:Lt("ankiDialog.url"),value:ue,onChange:function(e){return le(e.target.value)}}),y.tags.length>0&&Object(pe.jsx)(Oe,{variant:"filled",label:"Tags",helperText:Lt("ankiDialog.tagList"),fullWidth:!0,color:"secondary",tags:re,onTagsChange:function(e){return se(e)}}),_e&&pt&&kt&&Object(pe.jsxs)(We.a,{container:!0,direction:"row",children:[Object(pe.jsx)(We.a,{item:!0,style:{flexGrow:1},children:Object(pe.jsx)($e.a,{ValueLabelComponent:dt,value:_e,valueLabelFormat:lt,onChange:Yt,min:pt[0],max:pt[1],marks:kt,step:1,valueLabelDisplay:"auto",className:M.rangeSelectSlider,color:"secondary"})}),Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(tt.a,{title:Lt("ankiDialog.resetSlider"),children:Object(pe.jsx)("span",{children:Object(pe.jsx)(Ue.a,{edge:"end",style:{marginTop:-8},onClick:Zt,children:Object(pe.jsx)(qe.a,{})})})})}),Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(tt.a,{title:Lt("ankiDialog.zoomIn"),children:Object(pe.jsx)("span",{children:Object(pe.jsx)(Ue.a,{edge:"end",style:{marginTop:-8},onClick:$t,children:Object(pe.jsx)(it.a,{})})})})}),Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(tt.a,{title:Lt("ankiDialog.zoomOut"),children:Object(pe.jsx)("span",{children:Object(pe.jsx)(Ue.a,{edge:"end",style:{marginTop:-8},onClick:en,children:Object(pe.jsx)(st.a,{})})})})})]})]})}),Object(pe.jsxs)(Be.a,{children:[Object(pe.jsx)(Re.a,{disabled:n,onClick:function(){return r(z,N,It,g,G,null!==te&&void 0!==te?te:"",null!==ue&&void 0!==ue?ue:"",Se,re,"gui")},children:Lt("ankiDialog.openInAnki")}),Object(pe.jsx)(Re.a,{disabled:n,onClick:function(){return r(z,N,It,g,G,null!==te&&void 0!==te?te:"",null!==ue&&void 0!==ue?ue:"",Se,re,"updateLast")},children:Lt("ankiDialog.updateLastCard")}),Object(pe.jsx)(Re.a,{disabled:n,onClick:function(){return r(z,N,It,g,G,null!==te&&void 0!==te?te:"",null!==ue&&void 0!==ue?ue:"",Se,re,"default")},children:Lt("ankiDialog.export")})]})]})}var pt=n(490),gt=n(260),jt=n.p+"static/media/background-colored.cbc50e45.png",mt=Object(ye.a)((function(e){return{root:function(e){var t=e.dragging;return{position:"absolute",height:e.appBarHidden?"100%":"calc(100% - 64px)",width:"100%",zIndex:101,pointerEvents:t?"auto":"none"}},transparentBackground:function(e){return{"&::before":{content:"' '",position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",backgroundSize:"300px 300px",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(".concat(jt,")"),backgroundBlendMode:"overlay",background:"rgba(0, 0, 0, .3)",filter:"drop-shadow(10px 10px 10px rgb(0, 0, 0, .4))"},width:"100%",height:"100%"}}}}));function kt(e){var t=e.dragging,n=e.appBarHidden,a=e.loading,i=mt({dragging:t,appBarHidden:n});return Object(pe.jsx)("div",{className:i.root,children:Object(pe.jsx)(gt.a,{in:t||a,children:Object(pe.jsx)("div",{className:i.transparentBackground})})})}var Ot=n(491),yt=n(161),xt=n(162),St=n(226),Ct=n(227),wt=RegExp("</?([^>]*)>","ig"),Tt=RegExp(/\\[nN]/,"ig"),Ft=document.createElement("div"),_t=document.createElement("canvas"),Pt=function(){function e(t){Object(F.a)(this,e),this._textFilter=void 0,this.xmlParser=void 0,this._textFilter=t}return Object(_.a)(e,[{key:"subtitles",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n){var a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e,t){return a._subtitles(e,!0===n?0:t)})));case 2:return e.abrupt("return",e.sent.flatMap((function(e){return e})).filter((function(e){return void 0!==e.textImage||""!==e.text})).sort((function(e,t){return e.start-t.start})));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_subtitles",value:function(){var e=Object(s.a)(b.a.mark((function e(t,n){var a,r,o,c,u,l,d,f,h,v,p,g,j,m,k,O,y,x,S,C,w,T,F=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=yt.a,e.next=4,t.text();case 4:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.abrupt("return",a.filter((function(e){return"cue"===e.type})).map((function(e){var t=e.data;return{start:t.start,end:t.end,text:F._filterText(t.text).replace(wt,""),track:n}})));case 7:if(!t.name.endsWith(".vtt")&&!t.name.endsWith(".nfvtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(s.a)(b.a.mark((function e(a,r){var s,o,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.name.endsWith(".nfvtt"),o=new xt.WebVTT.Parser(window,xt.WebVTT.StringDecoder()),c=[],o.oncue=function(e){if(e.text=F._filterText(e.text).replace(wt,""),s){var t,n=e.text.split("\n"),a=[],r=Object(i.a)(n);try{for(r.s();!(t=r.n()).done;){var o=t.value;a.push(F._fixRTL(o))}}catch(u){r.e(u)}finally{r.f()}e.text=a.join("\n")}c.push(e)},o.onflush=function(){return a(c.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text,track:n}})))},e.t0=o,e.next=8,t.text();case 8:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),o.flush();case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=17;break}return e.t2=Ot.a,e.next=13,t.text();case 13:return e.t3=e.sent,e.t4={},r=(0,e.t2)(e.t3,e.t4),e.abrupt("return",r.dialogues.map((function(e){return{start:Math.round(1e3*e.start),end:Math.round(1e3*e.end),text:F._filterText(e.slices.flatMap((function(e){return e.fragments.map((function(e){return e.text}))})).join("")).replace(Tt,"\n"),track:n}})));case 17:if(!t.name.endsWith(".ytxml")){e.next=37;break}return e.next=20,t.text();case 20:if(o=e.sent,c=this._xmlParser().parse(o),0!==Object.keys(c).length){e.next=24;break}return e.abrupt("return",[]);case 24:u=c.transcript.text,l=[],d=0,f=u.length;case 27:if(!(d<f)){e.next=36;break}if("#text"in(h=u[d])&&"@_dur"in h&&"@_start"in h){e.next=31;break}return e.abrupt("continue",33);case 31:v=parseFloat(h["@_start"]),l.push({start:Math.floor(1e3*v),end:Math.floor(1e3*(v+parseFloat(h["@_dur"]))),text:this._filterText(this._decodeHTML(String(h["#text"])).replace(wt,"")),track:n});case 33:d++,e.next=27;break;case 36:return e.abrupt("return",l);case 37:if(!t.name.endsWith(".sup")){e.next=42;break}return p=[],e.next=41,t.stream().pipeThrough(Object(Ct.parseDisplaySets)()).pipeTo(this._displaySetsToSubtitles(p,n));case 41:return e.abrupt("return",p);case 42:if(!t.name.endsWith(".dfxp")&&!t.name.endsWith("ttml2")){e.next=62;break}return e.next=45,t.text();case 45:g=e.sent,j=new DOMParser,m=j.parseFromString(g,"application/xml"),k=this._xmlNodePath(m.documentElement,["body","div"]),O=[],y=0,x=k.length;case 51:if(!(y<x)){e.next=61;break}if(C=k[y],w=C.getAttribute("begin"),T=C.getAttribute("end"),null!==w&&null!==T){e.next=57;break}return e.abrupt("continue",58);case 57:O.push({text:this._filterText(null!==(S=C.textContent)&&void 0!==S?S:""),start:this._parseTtmlTimestamp(w),end:this._parseTtmlTimestamp(T),track:n});case 58:y++,e.next=51;break;case 61:return e.abrupt("return",O);case 62:throw new Error("Unsupported subtitle file format");case 63:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_parseTtmlTimestamp",value:function(e){var t=e.split(":");return Math.floor(1e3*parseFloat(t[t.length-1]))+6e4*(t.length<2?0:Number(t[t.length-2]))+36e5*(t.length<3?0:Number(t[t.length-3]))}},{key:"_xmlNodePath",value:function(e,t){if(0===t.length){for(var n=[],a=0;a<e.children.length;++a){var i=e.children[a];n.push(i)}return n}for(var r=0;r<e.children.length;++r){var s=e.children[r];if(this._dropTagNamespace(s.tagName)===t[0])return this._xmlNodePath(s,t.slice(1))}throw new Error("Failied to parse XML path")}},{key:"_dropTagNamespace",value:function(e){var t=e.lastIndexOf(":");return-1!==t?e.substring(t+1):e}},{key:"_displaySetsToSubtitles",value:function(e,t){var n,a;return new WritableStream({write:function(i,r){if(i.objectDefinitionSegments.length>0)void 0===a&&(a=i);else if(void 0!==a){var s,o=a.presentationCompositionSegment.width,c=a.presentationCompositionSegment.height;n=void 0===n||n.length<c*o*4?new Uint8ClampedArray(o*c*4):n;var u=a.imageData(n);_t.width=u.width,_t.height=u.height,_t.getContext("2d").putImageData(u,0,0),e.push({start:null!==(s=a.objectDefinitionSegments[0].header.presentationTimestamp/90)&&void 0!==s?s:0,end:i.endDefinitionSegment.header.presentationTimestamp/90,text:"",textImage:{dataUrl:_t.toDataURL("image/png"),image:{width:u.width,height:u.height},screen:{width:a.presentationCompositionSegment.width,height:a.presentationCompositionSegment.height}},track:t}),a=void 0}}})}},{key:"_fixRTL",value:function(e){var t=e.indexOf("&lrm;"),n=e.indexOf("&rlm;"),a="";return t>-1?(a=e.substring(0,t)+"\u202a"+e.substring(t+5)+"\u202c",this._fixRTL(a)):n>-1?(a=e.substring(0,n)+"\u202b"+e.substring(n+5)+"\u202c",this._fixRTL(a)):e}},{key:"_decodeHTML",value:function(e){var t;return Ft.innerHTML=e,null!==(t=Ft.textContent)&&void 0!==t?t:Ft.innerText}},{key:"_xmlParser",value:function(){return void 0===this.xmlParser&&(this.xmlParser=new St.XMLParser({ignoreAttributes:!1})),this.xmlParser}},{key:"_filterText",value:function(e){return void 0===this._textFilter?e:e.replace(this._textFilter.regex,this._textFilter.replacement).trim()}},{key:"subtitlesToSrt",value:function(e){var t=e.map((function(e){return{type:"cue",data:{start:e.start,end:e.end,text:e.text}}}));return Object(yt.b)(t,{format:"SRT"})}},{key:"filesToSrt",value:function(){var e=Object(s.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.subtitles(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.subtitlesToSrt.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Et=n(474),Rt=n(230),Mt=n.n(Rt),At=n(229),Bt=n.n(At),It=n(231),Nt=n.n(It),Dt=n(228),Lt=n.n(Dt),Ht=n(232),Wt=n.n(Ht),Ut=n(131),zt=n.n(Ut),Vt=["show"],Kt=Object(x.a)((function(e){return{title:{flexGrow:1},leftButton:{marginRight:e.spacing(1)},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:function(e){var t=e.drawerWidth;return"calc(100% - ".concat(t,"px)")},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:function(e){return e.drawerWidth}},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}})),qt=Object(x.a)((function(e){return{tooltip:function(e){return{display:e.show?"block":"none"}}}}));function Gt(e){var t=e.show,n=Object(u.a)(e,Vt),a=qt({show:t});return Object(pe.jsx)(tt.a,Object(c.a)({classes:a},n))}function Xt(e){var t,n=e.drawerWidth,a=e.drawerOpen,i=e.hidden,r=e.title,s=e.subtitleFiles,c=e.onOpenSettings,u=e.onOpenCopyHistory,l=e.onFileSelector,d=e.onDownloadSubtitleFilesAsSrt,b=Kt({drawerWidth:n}),h=void 0!==s&&void 0!==s.find((function(e){return!e.name.endsWith(".sup")})),v=Object(p.c)().t,g=Object(f.useCallback)((function(e){l()}),[l]),j=Object(f.useCallback)((function(){d()}),[d]);return Object(pe.jsx)(pe.Fragment,{children:Object(pe.jsx)(Et.a,{position:"static",elevation:0,className:Object(fe.a)(b.appBar,(t={},Object(o.a)(t,b.appBarShift,a),Object(o.a)(t,b.hide,i),t)),children:Object(pe.jsxs)(et.a,{children:[Object(pe.jsx)(tt.a,{title:v("action.openFiles"),children:Object(pe.jsx)(Ue.a,{edge:"start",color:"inherit",className:b.leftButton,onClick:g,children:Object(pe.jsx)(Lt.a,{})})}),h&&Object(pe.jsx)(tt.a,{title:v("action.downloadSubtitlesAsSrt"),children:Object(pe.jsx)(Ue.a,{edge:"start",color:"inherit",className:b.leftButton,onClick:j,children:Object(pe.jsx)(zt.a,{})})}),Object(pe.jsx)(nt.a,{variant:"h6",noWrap:!0,className:b.title,children:r}),Object(pe.jsx)(tt.a,{title:v("bar.donate"),children:Object(pe.jsx)(Ue.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer#donations",target:"_blank",rel:"noreferrer",children:Object(pe.jsx)(Bt.a,{})})}),Object(pe.jsx)(tt.a,{title:v("bar.submitIssue"),children:Object(pe.jsx)(Ue.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer/issues",target:"_blank",rel:"noreferrer",children:Object(pe.jsx)(Mt.a,{})})}),Object(pe.jsx)(tt.a,{title:v("bar.help"),children:Object(pe.jsx)(Ue.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer#usage",target:"_blank",rel:"noreferrer",children:Object(pe.jsx)(Nt.a,{})})}),Object(pe.jsx)(tt.a,{title:v("bar.settings"),children:Object(pe.jsx)(Ue.a,{edge:"end",color:"inherit",onClick:c,children:Object(pe.jsx)(Ye.a,{})})}),Object(pe.jsx)(Gt,{title:v("bar.miningHistory"),show:!a,children:Object(pe.jsx)(Ue.a,{edge:"end",color:"inherit","aria-label":"menu",className:Object(fe.a)(b.copyHistoryButton,Object(o.a)({},b.copyHistoryButtonShift,a)),onClick:u,children:Object(pe.jsx)(Wt.a,{})})})]})})})}function Jt(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e<0)return Jt(0,t);var a=(e=Math.round(e))%1e3,i=(e=(e-a)/1e3)%60,r=(e=(e-i)/60)%60;if(t>=36e5){var s=(e-r)/60;return n?Yt(s)+":"+Yt(r)+":"+Yt(i)+"."+Yt(a,3):Yt(s)+":"+Yt(r)+":"+Yt(i)}return n?Yt(r)+":"+Yt(i)+"."+Yt(a,3):Yt(r)+":"+Yt(i)}function Yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(e).padStart(t,"0")}var Qt=n(476),Zt=n(478),$t=n(497),en=n(235),tn=n.n(en),nn=n(462),an=n(416),rn=n(477),sn=n(475),on=n(461),cn=n(234),un=n.n(cn),ln=n(233),dn=n.n(ln),bn=Object(x.a)((function(e){return{drawer:{width:function(e){return e.drawerWidth},flexShrink:0},drawerPaper:{width:function(e){return e.drawerWidth}},drawerHeader:Object(c.a)(Object(c.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20},emptyState:{display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",height:"100%",padding:15},text:{flexGrow:1},emptyText:{flexGrow:1,color:e.palette.text.secondary},timestamp:{paddingRight:15,paddingLeft:15,color:e.palette.text.secondary}}}));function fn(e){var t=e.open,n=e.anchorEl,a=e.onClose,i=e.onSelect,r=e.onClipAudio,s=e.onDownloadImage,o=e.onDelete,c=e.item,u=Object(p.c)().t,l=Object(f.useCallback)((function(){navigator.clipboard.writeText(c.text),a()}),[c,a]),d=Object(f.useCallback)((function(){i(c),a()}),[c,i,a]),b=Object(f.useCallback)((function(){r(c),a()}),[c,r,a]),h=Object(f.useCallback)((function(){s(c),a()}),[c,s,a]),v=Object(f.useCallback)((function(){o(c),a()}),[c,o,a]);return c?Object(pe.jsx)(on.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(pe.jsxs)(nn.a,{children:[Object(pe.jsx)(an.a,{button:!0,onClick:l,children:Object(pe.jsx)(sn.a,{primaryTypographyProps:{variant:"body2"},primary:u("action.copy")})}),Object(pe.jsx)(an.a,{button:!0,onClick:d,children:Object(pe.jsx)(sn.a,{primaryTypographyProps:{variant:"body2"},primary:u("action.jumpTo")})}),(c.videoFile||c.audioFile||c.audio)&&Object(pe.jsx)(an.a,{button:!0,onClick:b,children:Object(pe.jsx)(sn.a,{primaryTypographyProps:{variant:"body2"},primary:u("action.downloadAudio")})}),(c.videoFile||c.image)&&Object(pe.jsx)(an.a,{button:!0,onClick:h,children:Object(pe.jsx)(sn.a,{primaryTypographyProps:{variant:"body2"},primary:u("action.downloadImage")})}),Object(pe.jsx)(an.a,{button:!0,onClick:v,children:Object(pe.jsx)(sn.a,{primaryTypographyProps:{variant:"body2"},primary:u("action.delete")})})]})}):null}function hn(e){var t,n=e.onDelete,a=bn(e),r=Object(f.useCallback)((function(e){e&&e.scrollIntoView()}),[]),s=Object(f.useState)(),o=Object(l.a)(s,2),c=o[0],u=o[1],d=Object(f.useState)(!1),b=Object(l.a)(d,2),v=b[0],g=b[1],j=Object(f.useState)(),m=Object(l.a)(j,2),k=m[0],O=m[1],y=Object(p.c)().t,x=Object(f.useCallback)((function(e,t){u(t),g(!0),O(e.currentTarget)}),[]),S=Object(f.useCallback)((function(){u(void 0),g(!1),O(void 0)}),[]),C=Object(f.useCallback)((function(e){n(e)}),[n]);return e.items.length>0?function(){var n,s,o=[],c=null,u=0,l={},d={},b=Object(i.a)(e.items);try{var f=function(){var t=s.value;if(null===c||c!==t.name){t.name in l?l[t.name]++:l[t.name]=0;var i=t.name+"-"+l[t.name];d[i]=[],c=t.name,n=i,o.push(Object(pe.jsxs)(an.a,{children:[Object(pe.jsx)(nt.a,{color:"textSecondary",children:t.name}),Object(pe.jsx)(Qt.a,{children:Object(pe.jsx)(tt.a,{title:y("copyHistory.downloadMinedSubsAsSrt"),children:Object(pe.jsx)(Ue.a,{onClick:function(){return e.onDownloadSectionAsSrt(t.name,d[i])},edge:"end",children:Object(pe.jsx)(zt.a,{})})})})]},i))}d[n].push(t);var b=u===e.items.length-1?r:null;o.push(Object(pe.jsxs)(an.a,{ref:b,className:a.listItem,classes:{gutters:a.listItemGutters},children:[Object(pe.jsx)(rn.a,{classes:{root:a.listItemIconRoot},children:Object(pe.jsx)(tt.a,{title:y("copyHistory.exportToAnki"),children:Object(pe.jsx)(Ue.a,{onClick:function(){return e.onAnki(t)},children:Object(pe.jsx)(dn.a,{fontSize:"small"})})})}),Object(pe.jsx)(rn.a,{classes:{root:a.listItemIconRoot},children:Object(pe.jsx)(Ue.a,{onClick:function(e){return x(e,t)},children:Object(pe.jsx)(un.a,{fontSize:"small"})})}),Object(pe.jsx)(sn.a,{primary:Object(pe.jsxs)(We.a,{wrap:"nowrap",container:!0,children:[Object(pe.jsx)(We.a,{item:!0,className:""===t.text?a.emptyText:a.text,children:""===t.text?y("copyHistory.blank"):t.text}),Object(pe.jsx)(We.a,{item:!0,className:a.timestamp,children:Jt(t.start,t.start,!1)})]})})]},t.id)),++u};for(b.s();!(s=b.n()).done;)f()}catch(h){b.e(h)}finally{b.f()}t=Object(pe.jsx)("div",{className:a.listContainer,children:Object(pe.jsx)(nn.a,{children:o})})}():t=Object(pe.jsx)("div",{className:a.emptyState,children:Object(pe.jsx)(nt.a,{variant:"h6",children:y("copyHistory.miningHistoryEmpty")})}),Object(pe.jsxs)(h.a.Fragment,{children:[Object(pe.jsxs)($t.a,{variant:"persistent",anchor:"right",open:e.open,className:a.drawer,classes:{paper:a.drawerPaper},children:[Object(pe.jsx)("div",{className:a.drawerHeader,children:Object(pe.jsx)(Ue.a,{onClick:e.onClose,children:Object(pe.jsx)(tn.a,{})})}),Object(pe.jsx)(Zt.a,{}),t]}),Object(pe.jsx)(fn,{open:e.open&&v,anchorEl:k,item:c,onClose:S,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage,onDelete:C})]})}var vn=n(83),pn=n.n(vn),gn=n(479),jn=Object(ye.a)((function(e){return{background:function(e){return{position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}},browseLink:{cursor:"pointer"}}}));function mn(e){var t=e.extension,n=e.latestExtensionVersion,a=e.extensionUrl,i=e.loading,r=e.dragging,s=e.appBarHidden,o=e.onFileSelector,c=jn({appBarHidden:s}),u=t.version&&pn()(n,t.version);return Object(pe.jsx)(h.a.Fragment,{children:Object(pe.jsx)(gt.a,{in:!i&&!r,timeout:500,children:Object(pe.jsx)("div",{className:c.background,children:Object(pe.jsxs)(nt.a,{variant:"h6",children:[Object(pe.jsxs)(p.a,{i18nKey:"landing.cta",children:["Drag and drop subtitle and media files, or",Object(pe.jsx)(gn.a,{target:"#",className:c.browseLink,onClick:o,color:"secondary",component:"label",children:"browse"}),"."]}),Object(pe.jsx)("br",{}),!t.installed&&Object(pe.jsxs)(p.a,{i18nKey:"landing.extensionNotInstalled",children:["Install the",Object(pe.jsx)(gn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"Chrome extension"}),"to sync subtitles with streaming video."]}),u&&Object(pe.jsxs)(p.a,{i18nKey:"landing.extensionUpdateAvailable",children:["An extension",Object(pe.jsx)(gn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"update"})," ","is available."]})]})})})})}var kn=n(163),On=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(F.a)(this,e),this.tree=void 0,this.gapsTree=void 0,this.options=void 0,this.tree=new kn.a,this.options=n,n.returnLastShown||n.returnNextToShow){var a;this.gapsTree=new kn.a,t.length>0&&t[0].start>0&&this.gapsTree.insert([0,t[0].start-1],t[0]);var r,s=Object(i.a)(t);try{for(s.s();!(r=s.n()).done;){var o=r.value;this.tree.insert([o.start,o.end],o),void 0!==a&&a.end<o.start&&this.gapsTree.insert([a.end+1,o.start-1],a),a=o}}catch(d){s.e(d)}finally{s.f()}}else{var c,u=Object(i.a)(t);try{for(u.s();!(c=u.n()).done;){var l=c.value;this.tree.insert([l.start,l.end],l)}}catch(d){u.e(d)}finally{u.f()}}}return Object(_.a)(e,[{key:"subtitlesAt",value:function(e){var t,n,a,r,s=[e,e],o=this.tree.search(s);if(0===o.length){if(void 0!==this.gapsTree){var c=[];if(t=this.gapsTree.search(s,(function(e,t){return c.push(t),e})),t.length>0&&this.options.returnNextToShow){var u=c[0].high+1;n=this.tree.search([u,u])}}}else if(void 0!==this.options.showingCheckRadiusMs){var l,d=Object(i.a)(o);try{for(d.s();!(l=d.n()).done;){var b=l.value;if(void 0===r&&b.end<e+this.options.showingCheckRadiusMs&&(r=b),void 0===a&&e-this.options.showingCheckRadiusMs<b.start&&(a=b),void 0!==a&&void 0!==r)break}}catch(f){d.e(f)}finally{d.f()}}return{showing:o,lastShown:t,nextToShow:n,startedShowing:a,willStopShowing:r}}}],[{key:"empty",value:function(){return e.emptySubtitleCollection}}]),e}();On.emptySubtitleCollection=new On([]);var yn,xn=function(){function e(t){Object(F.a)(this,e),this.channel=void 0,this.onMessage=void 0,this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(_.a)(e,[{key:"postMessage",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage(e)}},{key:"close",value:function(){var e;null===(e=this.channel)||void 0===e||e.close(),this.channel=void 0}}]),e}(),Sn=function(){function e(t,n,a){var i=this;Object(F.a)(this,e),this.tabId=void 0,this.src=void 0,this.extension=void 0,this.listener=void 0,this.unsubscribeFromExtension=void 0,this.onMessage=void 0,this.tabId=t,this.src=n,this.listener=function(e){var a;e.tabId===t&&e.src===n&&(null===(a=i.onMessage)||void 0===a||a.call(i,{data:e.data}))},this.unsubscribeFromExtension=a.subscribe(this.listener),this.extension=a}return Object(_.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId,this.src)}},{key:"close",value:function(){this.unsubscribeFromExtension()}}]),e}(),Cn=function(){function e(){Object(F.a)(this,e),this.accumulated=void 0,this.started=void 0,this.startTime=void 0,this._rate=1,this.accumulated=0,this.started=!1}return Object(_.a)(e,[{key:"rate",get:function(){return this._rate},set:function(e){this.started&&(this.accumulated+=this._elapsed(),this.startTime=Date.now()),this._rate=e}},{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+this._elapsed()):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=this._elapsed())}},{key:"_elapsed",value:function(){return(Date.now()-this.startTime)*this._rate}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),wn=n(7),Tn=n(237),Fn=n.n(Tn),_n=n(238),Pn=n.n(_n),En=n(246),Rn=n.n(En),Mn=n(407),An=n(249),Bn=n.n(An),In=n(251),Nn=n.n(In),Dn=n(236),Ln=n.n(Dn),Hn=n(250),Wn=n.n(Hn),Un=n(239),zn=n.n(Un),Vn=n(240),Kn=n.n(Vn),qn=n(247),Gn=n.n(qn),Xn=n(248),Jn=n.n(Xn),Yn=n(245),Qn=n.n(Yn),Zn=n(243),$n=n.n(Zn),ea=n(244),ta=n.n(ea),na=n(164),aa=n.n(na),ia=n(241),ra=n.n(ia),sa=n(242),oa=n.n(sa),ca=function(){function e(){Object(F.a)(this,e),this._cache={}}return Object(_.a)(e,[{key:"get",value:function(e){var t=this._cache[e];if(void 0===t){var n=localStorage.getItem(e);return this._cache[e]=n,n}return t}},{key:"set",value:function(e,t){localStorage.setItem(e,t),this._cache[e]=t}},{key:"delete",value:function(e){delete this._cache[e],localStorage.removeItem(e)}}]),e}(),ua="volume",la="theaterMode",da="offset",ba="subtitleAlignment",fa="subtitlePositionOffset";!function(e){e[e.bottom=0]="bottom",e[e.top=1]="top"}(yn||(yn={}));var ha=function(){function e(t){Object(F.a)(this,e),this.settingsProvider=void 0,this.storage=new ca,this.settingsProvider=t}return Object(_.a)(e,[{key:"volume",get:function(){var e=this.storage.get(ua);return null===e?100:Number(e)},set:function(e){this.storage.set(ua,String(e))}},{key:"theaterMode",get:function(){return"true"===this.storage.get(la)||!1},set:function(e){this.storage.set(la,String(e))}},{key:"offset",get:function(){if(!this.settingsProvider.rememberSubtitleOffset)return 0;var e=this.storage.get(da);return null===e?0:Number(e)},set:function(e){this.storage.set(da,String(e))}},{key:"subtitleAlignment",get:function(){var e=this.storage.get(ba);return void 0===e?yn.bottom:Number(e)},set:function(e){this.storage.set(ba,String(e))}},{key:"subtitlePositionOffset",get:function(){var e=this.storage.get(fa);return null===e?100:Number(e)},set:function(e){this.storage.set(fa,String(e))}}]),e}(),va=Object(x.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none",color:"#fff"},buttonContainer:{flexDirection:"row"},timeDisplay:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},numberInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:"#fff",pointerEvents:"auto"},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0,pointerEvents:"auto"},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100,pointerEvents:"auto"},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .4) 40%, rgba(0, 0, 0, 0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10},button:{pointerEvents:"auto"},inactiveButton:{color:"rgba(72, 72, 72, 0.7)",pointerEvents:"auto"},inactiveTopButton:{color:"rgba(255, 255, 255, 0.5)",pointerEvents:"auto"},progress:{margin:5},topButton:{pointerEvents:"auto",color:"#fff"},gridContainer:{pointerEvents:"auto",padding:2}}})),pa=Object(x.a)((function(e){return{root:{height:10},container:{height:10,pointerEvents:"auto",display:"flex",justifyContent:"center",flexDirection:"column",position:"absolute",width:"calc(100% - 20px)",marginLeft:10},mouseEventListener:{zIndex:1,height:10,cursor:"pointer",pointerEvents:"auto",position:"absolute",width:"100%"},fillContainer:{background:"rgba(30,30,30,0.7)",width:"100%",height:5,position:"relative"},fillContainerThick:{transition:e.transitions.create("height",{easing:e.transitions.easing.easeInOut,duration:50}),height:8},fill:{background:"linear-gradient(to left, #ff1f62, #49007a)",height:"100%"},handleContainer:{position:"absolute",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",bottom:0},handle:{borderRadius:"50%",width:16,height:16,opacity:0,left:-8,background:"white",position:"absolute"},handleOn:{opacity:1,transition:e.transitions.create("opacity",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.shortest})}}})),ga=Object(wn.a)((function(e){return{root:{color:"white",verticalAlign:"middle"},thumb:{backgroundColor:"white",color:"white","&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:"white"}}}))($e.a);function ja(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function ma(e){var t=e.onSeek,n=e.value,a=pa(),i=Object(f.useState)(!1),r=Object(l.a)(i,2),s=r[0],o=r[1],c=Object(f.useRef)(null),u=Object(f.useCallback)((function(e){var n=e.currentTarget.getBoundingClientRect(),a=n.right-n.left-20,i=Math.min(1,Math.max(0,(e.pageX-n.left-10)/a));t(i)}),[t]),d=Object(f.useCallback)((function(){return o(!0)}),[]),b=Object(f.useCallback)((function(){return o(!1)}),[]),h=c.current?function(e){var t=e.getBoundingClientRect();return t.right-t.left}(c.current)*n/100:0,v={width:h},p={marginLeft:h},g=s?a.fillContainer+" "+a.fillContainerThick:a.fillContainer,j=s?a.handle+" "+a.handleOn:a.handle;return Object(pe.jsxs)("div",{className:a.root,children:[Object(pe.jsx)("div",{ref:c,className:a.container,children:Object(pe.jsxs)("div",{className:g,children:[Object(pe.jsx)("div",{className:a.fill,style:v}),Object(pe.jsx)("div",{className:a.handleContainer,children:Object(pe.jsx)("div",{className:j,style:p})})]})}),Object(pe.jsx)("div",{className:a.mouseEventListener,onClick:u,onMouseOver:d,onMouseOut:b})]})}function ka(e){var t=e.open,n=e.anchorEl,a=e.audioTracks,i=e.selectedAudioTrack,r=e.onAudioTrackSelected,s=e.onClose;if(!a||0===a.length)return null;var o=a.map((function(e){return Object(pe.jsxs)(an.a,{selected:e.id===i,button:!0,onClick:function(){return r(e.id)},children:[e.language," ",e.label]},e.id)}));return Object(pe.jsx)("div",{children:Object(pe.jsx)(on.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:s,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(pe.jsx)(nn.a,{children:o})})})}function Oa(e){var t=e.open,n=e.anchorEl,a=e.onClose,i=e.tabs,r=e.selectedTab,s=e.onTabSelected;if(!i||0===i.length)return null;var o=i.map((function(e){return Object(pe.jsxs)(an.a,{selected:r&&e.id===r.id&&e.src===r.src,button:!0,onClick:function(){return s(e)},children:[e.id," ",e.title," ",e.src]},"".concat(e.id,":").concat(e.src))}));return Object(pe.jsx)("div",{children:Object(pe.jsx)(on.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(pe.jsx)(nn.a,{children:o})})})}function ya(e){var t=e.open,n=e.anchorEl,a=e.onUnload,i=e.onClose,r=e.file;return Object(pe.jsx)("div",{children:Object(pe.jsx)(on.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:i,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(pe.jsx)(nn.a,{children:Object(pe.jsxs)(an.a,{button:!0,onClick:function(e){return a()},children:["Unload ",r]})})})})}function xa(e){var t=e.open,n=e.anchorEl,a=e.selectedPlayMode,i=e.onPlayMode,r=e.onClose,s=Object(p.c)().t;return Object(pe.jsx)("div",{children:Object(pe.jsx)(on.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:r,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(pe.jsxs)(nn.a,{children:[Object(pe.jsx)(an.a,{selected:a===oe.normal,button:!0,onClick:function(e){return i(oe.normal)},children:s("controls.normalMode")}),Object(pe.jsx)(an.a,{selected:a===oe.condensed,button:!0,onClick:function(e){return i(oe.condensed)},children:s("controls.condensedMode")}),Object(pe.jsx)(an.a,{selected:a===oe.autoPause,button:!0,onClick:function(e){return i(oe.autoPause)},children:s("controls.autoPauseMode")})]})})})}function Sa(e){var t=e.clock,n=e.playing,a=e.length,i=e.offsetEnabled,r=e.displayLength,s=e.offset,o=e.playbackRate,c=e.playbackRateEnabled,u=e.onAudioTrackSelected,d=e.onSeek,b=e.mousePositionRef,v=e.onShow,g=e.onPause,j=e.onPlay,m=e.onTabSelected,k=e.onUnloadAudio,O=e.onUnloadVideo,y=e.onOffsetChange,x=e.onPlaybackRateChange,S=e.onVolumeChange,C=e.disableKeyEvents,w=e.playbackPreferences,T=e.closeEnabled,F=e.onClose,_=e.volumeEnabled,P=e.playMode,E=e.playModeEnabled,R=e.onPlayMode,M=e.subtitlesEnabled,A=e.subtitlesToggle,B=e.onSubtitlesToggle,I=e.videoFile,N=e.audioFile,D=e.audioTracks,L=e.selectedAudioTrack,H=e.tabs,W=e.selectedTab,U=e.popOutEnabled,z=e.popOut,V=e.onPopOutToggle,K=e.fullscreenEnabled,q=e.fullscreen,G=e.onFullscreenToggle,X=e.hideSubtitlePlayerToggleEnabled,J=e.subtitlePlayerHidden,Y=e.onHideSubtitlePlayerToggle,Q=e.showOnMouseMovement,Z=e.theaterModeToggleEnabled,$=e.theaterModeEnabled,ee=e.onTheaterModeToggle,te=e.subtitleAlignment,ne=e.subtitleAlignmentEnabled,ae=e.onSubtitleAlignment,ie=va(),re=Object(p.c)().t,se=Object(f.useState)(!0),oe=Object(l.a)(se,2),ce=oe[0],ue=oe[1],le=Object(f.useState)(!1),de=Object(l.a)(le,2),be=de[0],fe=de[1],he=Object(f.useState)(),ve=Object(l.a)(he,2),ge=ve[0],je=ve[1],me=Object(f.useState)(!1),ke=Object(l.a)(me,2),Oe=ke[0],ye=ke[1],xe=Object(f.useState)(),Se=Object(l.a)(xe,2),Ce=Se[0],we=Se[1],Te=Object(f.useState)(!1),Fe=Object(l.a)(Te,2),_e=Fe[0],Pe=Fe[1],Ee=Object(f.useState)(),Re=Object(l.a)(Ee,2),Me=Re[0],Ae=Re[1],Be=Object(f.useState)(!1),Ie=Object(l.a)(Be,2),Ne=Ie[0],De=Ie[1],Le=Object(f.useState)(),He=Object(l.a)(Le,2),ze=He[0],Ve=He[1],Ke=Object(f.useState)(!1),qe=Object(l.a)(Ke,2),Ge=qe[0],Xe=qe[1],Je=Object(f.useState)(),Ye=Object(l.a)(Je,2),Qe=Ye[0],$e=Ye[1],et=Object(f.useState)(!1),nt=Object(l.a)(et,2),at=nt[0],it=nt[1],rt=Object(f.useState)(100),st=Object(l.a)(rt,2),ot=st[0],ct=st[1],ut=Object(f.useState)(100),lt=Object(l.a)(ut,2),dt=lt[0],bt=lt[1],ft=Object(f.useRef)({x:0,y:0}),ht=Object(f.useRef)(Date.now()),vt=Object(f.useRef)(Date.now()),pt=Object(f.useRef)(!0),jt=Object(f.useRef)(!1),mt=Object(f.useState)(5),kt=Object(l.a)(mt,2),Ot=kt[0],yt=kt[1],xt=Object(f.useState)(5),St=Object(l.a)(xt,2),Ct=St[0],wt=St[1],Tt=Object(f.useRef)(),Ft=Object(f.useRef)(),_t=Object(f.useRef)(null),Pt=Object(f.useRef)(null),Et=Object(f.useState)(),Rt=Object(l.a)(Et,2)[1],Mt=Object(f.useCallback)((function(){return Rt({})}),[]),At=Object(f.useCallback)((function(e){d(e)}),[d]);function Bt(){jt.current=!0}function It(){jt.current=!1}Object(f.useEffect)((function(){var e=Number(w.volume);ct(e),S(e/100),e>0&&bt(e)}),[w,S]),Object(f.useEffect)((function(){var e=setInterval((function(){var e,t;Q?e=Date.now()-ht.current<2e3||Math.pow(b.current.x-ft.current.x,2)+Math.pow(b.current.y-ft.current.y,2)>100:e=null!==(t=_t.current&&b.current.y>_t.current.offsetTop-20||Pt.current&&b.current.y<Pt.current.offsetHeight+20)&&void 0!==t&&t;(e=e||jt.current||Tt.current===document.activeElement||Ft.current===document.activeElement||Date.now()-vt.current<2e3)&&!pt.current?(ht.current=Date.now(),ue(e)):!e&&pt.current&&ue(e),pt.current=e,ft.current.x=b.current.x,ft.current.y=b.current.y}),100);return function(){return clearInterval(e)}}),[b,Q]),Object(f.useEffect)((function(){return null===v||void 0===v?void 0:v(ce)}),[v,ce]);var Nt=Object(f.useCallback)((function(e){if(Tt.current){if(0===e)Tt.current.value="",yt(5);else{var t=e/1e3,n=t>=0?"+"+t.toFixed(2):String(t.toFixed(2));Tt.current.value=n,vt.current=Date.now(),yt(n.length)}Tt.current.blur()}}),[]),Dt=Object(f.useCallback)((function(e){if(Ft.current){if(1===e)Ft.current.value="",wt(5);else{var t="\xd7"+String(e.toFixed(2));Ft.current.value=t,vt.current=Date.now(),wt(t.length)}Ft.current.blur()}}),[]);Object(f.useEffect)((function(){if(!C)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if("Enter"===e.key)if(Tt.current===document.activeElement){var t=Number(Tt.current.value);if(t===s)return void Nt(s);if(Number.isNaN(t))return;y(1e3*t)}else if(Ft.current===document.activeElement){var n=Number(Ft.current.value);if(o===n)return void Dt(o);if(Number.isNaN(n)||n<.1||n>5)return;x(n)}}}),[y,x,Nt,Dt,s,o,C]);var Lt=Object(f.useCallback)((function(e){var t,n=e.target;n.setSelectionRange(0,(null===(t=n.value)||void 0===t?void 0:t.length)||0)}),[]);Object(f.useEffect)((function(){var e=setInterval((function(){Mt()}),100);return function(){return clearInterval(e)}}),[Mt]),Object(f.useEffect)((function(){Nt(s)}),[s,Nt]),Object(f.useEffect)((function(){Dt(o)}),[o,Dt]);var Ht=Object(f.useCallback)((function(){je(void 0),fe(!1)}),[]),Wt=Object(f.useCallback)((function(e){je(e.currentTarget),fe(!0)}),[]),Ut=Object(f.useCallback)((function(e){u(e),je(void 0),fe(!1)}),[u]),zt=Object(f.useCallback)((function(){we(void 0),ye(!1)}),[]),Vt=Object(f.useCallback)((function(e){we(e.currentTarget),ye(!0)}),[]),Kt=Object(f.useCallback)((function(e){null===m||void 0===m||m(e),we(void 0),ye(!1)}),[m]),qt=Object(f.useCallback)((function(){Ae(void 0),Pe(!1)}),[]),Gt=Object(f.useCallback)((function(e){Ae(e.currentTarget),Pe(!0)}),[]),Xt=Object(f.useCallback)((function(){null===k||void 0===k||k(),Pe(!1)}),[k]),Jt=Object(f.useCallback)((function(){Ve(void 0),De(!1)}),[]),Yt=Object(f.useCallback)((function(e){Ve(e.currentTarget),De(!0)}),[]),Qt=Object(f.useCallback)((function(){null===O||void 0===O||O(),De(!1)}),[O]),Zt=Object(f.useCallback)((function(){$e(void 0),Xe(!1)}),[]),$t=Object(f.useCallback)((function(e){$e(e.currentTarget),Xe(!0)}),[]),en=Object(f.useCallback)((function(e){null===R||void 0===R||R(e),$e(void 0),Xe(!1)}),[R]),tn=Object(f.useCallback)((function(){return it(!1)}),[]),nn=Object(f.useCallback)((function(){return it(!0)}),[]),an=Object(f.useCallback)((function(e,t){"number"===typeof t&&(ct(t),S(t/100))}),[S]),rn=Object(f.useCallback)((function(e,t){"number"===typeof t&&(t>0&&bt(t),w.volume=t)}),[w]),sn=Object(f.useCallback)((function(){ct((function(e){var t=e>0?0:dt;return S(t/100),t}))}),[S,dt]),on=Object(f.useCallback)((function(){if(ne&&void 0!==te&&void 0!==ae){var e=te===yn.top?yn.bottom:yn.top;ae(e)}}),[te,ne,ae]),cn=t.progress(a);return Object(pe.jsxs)(h.a.Fragment,{children:[Object(pe.jsx)(gt.a,{in:ce,timeout:200,children:Object(pe.jsxs)(We.a,{container:!0,style:{position:"absolute",top:0},children:[Object(pe.jsx)(We.a,{item:!0,style:{flexGrow:1},children:T&&Object(pe.jsx)(Ue.a,{ref:Pt,color:"inherit",className:ie.topButton,onClick:F,onMouseOver:Bt,onMouseOut:It,children:Object(pe.jsx)(Ze.a,{})})}),Object(pe.jsxs)(We.a,{item:!0,children:[Z&&Object(pe.jsx)(Ue.a,{color:"inherit",className:$?ie.topButton:ie.inactiveTopButton,onClick:ee,onMouseOver:Bt,onMouseOut:It,children:Object(pe.jsx)(Ln.a,{})}),X&&Object(pe.jsx)(Ue.a,{color:"inherit",className:ie.topButton,onClick:Y,onMouseOver:Bt,onMouseOut:It,children:J?Object(pe.jsx)(Fn.a,{}):Object(pe.jsx)(Pn.a,{})})]})]})}),Object(pe.jsxs)("div",{ref:_t,className:ie.container,onMouseOver:Bt,onMouseOut:It,children:[Object(pe.jsx)(gt.a,{in:ce,timeout:200,children:Object(pe.jsxs)("div",{className:ie.subContainer,children:[Object(pe.jsx)(ma,{onSeek:At,value:100*cn}),Object(pe.jsxs)(We.a,{container:!0,className:ie.gridContainer,direction:"row",children:[Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:function(){return n?g():j()},children:n?Object(pe.jsx)(zn.a,{className:ie.button}):Object(pe.jsx)(Kn.a,{className:ie.button})})}),_&&Object(pe.jsxs)(We.a,{item:!0,onMouseOver:nn,onMouseOut:tn,className:at?ie.volumeInputContainerShown:ie.volumeInputContainerHidden,children:[Object(pe.jsx)(Ue.a,{color:"inherit",onClick:sn,children:0===ot?Object(pe.jsx)(ra.a,{}):Object(pe.jsx)(oa.a,{})}),Object(pe.jsx)(ga,{onChange:an,onChangeCommitted:rn,value:ot,defaultValue:100,classes:{root:at?ie.volumeInputShown:ie.volumeInputHidden,thumb:at?ie.volumeInputThumbShown:ie.volumeInputThumbHidden}})]}),Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsxs)("div",{className:ie.timeDisplay,children:[ja(cn*a)," / ",ja(r||a)]})}),i&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(tt.a,{title:re("controls.subtitleOffset"),children:Object(pe.jsx)(Mn.a,{style:{width:"".concat(Ot,"ch")},inputRef:Tt,disableUnderline:!0,className:ie.numberInput,placeholder:"\xb1"+Number(0).toFixed(2),onClick:Lt,onChange:function(e){return yt(Math.max(5,e.target.value.length))}})})}),c&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(tt.a,{title:re("controls.playbackRate"),children:Object(pe.jsx)(Mn.a,{style:{width:"".concat(Ct,"ch"),marginLeft:4},inputRef:Ft,disableUnderline:!0,className:ie.numberInput,placeholder:"\xd7"+Number(1).toFixed(2),onClick:Lt,onChange:function(e){return wt(Math.max(5,e.target.value.length))}})})}),Object(pe.jsx)(We.a,{item:!0,style:{flexGrow:1}}),ne&&void 0!==te&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:on,children:te===yn.top?Object(pe.jsx)($n.a,{}):Object(pe.jsx)(ta.a,{})})}),A&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:B,children:Object(pe.jsx)(Qn.a,{className:M?ie.button:ie.inactiveButton})})}),I&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:Yt,children:Object(pe.jsx)(aa.a,{className:ie.button})})}),N&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:Gt,children:Object(pe.jsx)(Rn.a,{className:ie.button})})}),D&&D.length>1&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:Wt,children:Object(pe.jsx)(Gn.a,{className:ie.button})})}),H&&H.length>0&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:Vt,children:Object(pe.jsx)(aa.a,{className:W?ie.button:ie.inactiveButton})})}),E&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:$t,children:Object(pe.jsx)(Jn.a,{className:E?ie.button:ie.inactiveButton})})}),U&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:V,children:Object(pe.jsx)(Bn.a,{className:ie.button,style:z?{transform:"rotateX(180deg)"}:{}})})}),K&&Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(Ue.a,{color:"inherit",onClick:G,children:q?Object(pe.jsx)(Wn.a,{className:ie.button}):Object(pe.jsx)(Nn.a,{className:ie.button})})})]})]})}),Object(pe.jsx)(Oa,{open:Oe&&ce,anchorEl:Ce,tabs:H,selectedTab:W,onClose:zt,onTabSelected:Kt}),Object(pe.jsx)(ka,{open:be&&ce,anchorEl:ge,audioTracks:D,selectedAudioTrack:L,onClose:Ht,onAudioTrackSelected:Ut}),Object(pe.jsx)(ya,{open:_e,anchorEl:Me,file:N,onClose:qt,onUnload:Xt}),Object(pe.jsx)(ya,{open:Ne,anchorEl:ze,file:I,onClose:Jt,onUnload:Qt}),Object(pe.jsx)(xa,{open:Ge&&ce,anchorEl:Qe,selectedPlayMode:P,onClose:Zt,onPlayMode:en})]})]})}var Ca=function(){function e(t){Object(F.a)(this,e),this.ref=void 0,this.readyResolves=void 0,this.ref=t,this.readyResolves=[]}return Object(_.a)(e,[{key:"seek",value:function(){var e=Object(s.a)(b.a.mark((function e(t){var n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e(void 0)}))):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(s.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e(void 0)})):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t,n=this;4!==(null===(t=this.ref.current)||void 0===t?void 0:t.readyState)?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var t,a=Object(i.a)(n.readyResolves);try{for(a.s();!(t=a.n()).done;){(0,t.value)()}}catch(r){a.e(r)}finally{a.f()}n.readyResolves.length=0,n.ref.current&&(n.ref.current.oncanplay=null)}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}},{key:"playbackRate",value:function(e){this.ref.current&&(this.ref.current.playbackRate=e)}}]),e}(),wa=n(483),Ta=n(484),Fa=n(481),_a=n(482),Pa=n(480),Ea=["index","selected","subtitleRef","onClickSubtitle","onCopySubtitle","compressed","disabled","subtitle","copyButtonEnabled"],Ra=Object(x.a)((function(e){return{container:{height:function(e){return e.appBarHidden?"100vh":"calc(100vh - 64px)"},position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default,width:function(e){var t=e.compressed,n=e.windowWidth;return t?Math.max(350,.25*n):"100%"}},table:{backgroundColor:e.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}}})),Ma=Object(x.a)((function(e){return{subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},disabledSubtitle:{color:"transparent",backgroundColor:e.palette.action.disabledBackground,borderRadius:5},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}})),Aa=h.a.memo((function(e){var t=e.index,n=e.selected,a=e.subtitleRef,i=e.onClickSubtitle,r=e.onCopySubtitle,s=e.compressed,o=e.disabled,d=e.subtitle,b=e.copyButtonEnabled,h=Object(u.a)(e,Ea),v=Ma(),p=Object(f.useRef)(null),g=Object(f.useState)(!1),j=Object(l.a)(g,2),m=j[0],k=j[1],O=s?v.compressedSubtitle:v.subtitle,y=o?v.disabledSubtitle:"";if(d.start<0||d.end<0)return null;var x=d.textImage?Object(pe.jsx)(ot,{availableWidth:window.screen.availWidth/2,subtitle:d,scale:1}):Object(pe.jsx)("span",{ref:p,className:y,children:d.text});return Object(pe.jsxs)(Pa.a,Object(c.a)(Object(c.a)({onClick:function(){return!m&&i(t)},onMouseUp:function(){var e,t,n,a=document.getSelection(),i="Range"===(null===a||void 0===a?void 0:a.type)&&(null===(e=p.current)||void 0===e?void 0:e.isSameNode(null!==(t=null===(n=a.anchorNode)||void 0===n?void 0:n.parentNode)&&void 0!==t?t:null));k(null!==i&&void 0!==i&&i)},ref:a,className:v.subtitleRow,selected:n},h),{},{children:[Object(pe.jsx)(Fa.a,{className:O,children:x}),b&&Object(pe.jsx)(Fa.a,{className:v.copyButton,children:Object(pe.jsx)(Ue.a,{onClick:function(e){return r(e,t)},children:Object(pe.jsx)(Ae.a,{fontSize:s?"small":"medium"})})}),Object(pe.jsx)(Fa.a,{className:v.timestamp,children:Object(pe.jsx)("div",{children:"\n".concat(d.displayTime,"\n")})})]}))}));function Ba(e){var t=e.clock,n=e.onSeek,a=e.onCopy,s=e.onOffsetChange,o=e.onToggleSubtitleTrack,c=e.onSubtitlesSelected,u=e.autoPauseContext,d=e.playing,b=e.subtitles,h=e.subtitleCollection,v=e.length,g=e.jumpToSubtitle,j=e.compressed,m=e.copyButtonEnabled,k=e.loading,O=e.drawerOpen,y=e.appBarHidden,x=e.displayHelp,S=e.disableKeyEvents,C=e.lastJumpToTopTimestamp,T=e.hidden,F=e.disabledSubtitleTracks,_=e.settingsProvider,P=e.keyBinder,E=Object(p.c)().t,R=Object(f.useRef)();R.current=d;var M=Object(f.useRef)(t);M.current=t,Object(f.useRef)().current=b;var A=Object(f.useMemo)((function(){return b?Array(b.length).fill(void 0).map((function(e){return Object(f.createRef)()})):[]}),[b]),B=Object(f.useRef)(On.empty());B.current=null!==h&&void 0!==h?h:On.empty();var D=Object(f.useRef)([]);D.current=A;var L=Object(f.useState)({}),H=Object(l.a)(L,2),W=H[0],U=H[1],z=Object(f.useRef)({}),V=Object(f.useRef)(0);V.current=v;var K=Object(f.useRef)(!1);K.current=T;var q=Object(f.useRef)(0),G=Object(f.useRef)(),X=Object(f.useRef)();Object(f.useRef)().current=O;var J=w(!0),Y=Object(l.a)(J,1)[0],Q=Ra({compressed:j,windowWidth:Y,appBarHidden:y}),Z=Object(f.useRef)();Z.current=u;var $=Object(f.useRef)();$.current=c,Object(f.useEffect)((function(){return G.current=requestAnimationFrame((function e(){var t,n,a,r,s,o,c=D.current,u={},l=M.current.time(V.current),d=B.current.subtitlesAt(l),b=0===d.showing.length?null!==(t=d.lastShown)&&void 0!==t?t:[]:d.showing,f=Object(i.a)(b);try{for(f.s();!(a=f.n()).done;){var h=a.value;u[h.index]=!0,(void 0===n||h.index<n)&&(n=h.index)}}catch(g){f.e(g)}finally{f.f()}if(!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(u,z.current)&&(z.current=u,U(u),null===(r=$.current)||void 0===r||r.call($,b),void 0!==n)){var v=c[n],p=!K.current&&Date.now()-q.current>5e3;null!==v&&void 0!==v&&v.current&&p&&v.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}void 0!==d.startedShowing&&(null===(s=Z.current)||void 0===s||s.startedShowing(d.startedShowing));void 0!==d.willStopShowing&&(null===(o=Z.current)||void 0===o||o.willStopShowing(d.willStopShowing));G.current=requestAnimationFrame(e)})),function(){void 0!==G.current&&cancelAnimationFrame(G.current)}}),[]);var ee=Object(f.useCallback)((function(){var e,t=z.current;if(t){var n=Object.keys(t);if(0!==n.length){var a=A[Number(n[0])];null===a||void 0===a||null===(e=a.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[A]);Object(f.useEffect)((function(){if(!T)return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)};function e(){"visible"===document.visibilityState&&ee()}}),[T,W,A,ee]),Object(f.useEffect)((function(){T||ee()}),[T,ee]),Object(f.useEffect)((function(){var e;if(!K.current){var t=D.current;if(t&&0!==t.length){var n=t[0];null===n||void 0===n||null===(e=n.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[C]),Object(f.useEffect)((function(){return P.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),s(t)}),(function(){return S}),(function(){return b}))}),[P,s,S,b]),Object(f.useEffect)((function(){return P.bindResetOffet((function(e){e.preventDefault(),e.stopPropagation(),s(0)}),(function(){return S}))}),[P,s,S]),Object(f.useEffect)((function(){return P.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),s(t)}),(function(){return S}),(function(){return t.time(v)}),(function(){return b}))}),[P,s,S,t,b,v]),Object(f.useEffect)((function(){return P.bindSeekToSubtitle((function(e,t){var a;e.preventDefault(),e.stopPropagation(),n(t.start,null!==(a=R.current)&&void 0!==a&&a)}),(function(){return S}),(function(){return t.time(v)}),(function(){return b}))}),[P,n,b,S,t,v]),Object(f.useEffect)((function(){return P.bindSeekToBeginningOfCurrentSubtitle((function(e,t){var a;e.preventDefault(),e.stopPropagation(),n(t.start,null!==(a=R.current)&&void 0!==a&&a)}),(function(){return S}),(function(){return t.time(v)}),(function(){return b}))}),[P,n,b,S,t,v]),Object(f.useEffect)((function(){return P.bindSeekBackwardOrForward((function(e,a){var i,r;(e.stopPropagation(),e.preventDefault(),a)?n(Math.min(v,t.time(v)+1e4),null!==(i=R.current)&&void 0!==i&&i):n(Math.max(0,t.time(v)-1e4),null!==(r=R.current)&&void 0!==r&&r)}),(function(){return S}))}),[P,t,v,S,n]),Object(f.useEffect)((function(){function e(){q.current=Date.now()}var t=X.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[X,q]),Object(f.useEffect)((function(){if(!T&&g&&b){var e,t,n,a=-1,r=0,s=Object(i.a)(b);try{for(s.s();!(e=s.n()).done;){var o=e.value;if(o.originalStart===g.originalStart&&o.text===g.text){a=r;break}++r}}catch(c){s.e(c)}finally{s.f()}if(-1!==a)null===(t=A[a])||void 0===t||null===(n=t.current)||void 0===n||n.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[T,g,b,A]);var te=Object(f.useCallback)((function(){var e=t.time(v),n=Math.min(e+5e3,v);return{text:"",start:e,originalStart:e,end:n,originalEnd:n,track:0}}),[t,v]),ne=Object(f.useCallback)((function(e){return b&&0!==b.length?z.current&&0!==Object.keys(z.current).length?I(b,e,_.surroundingSubtitlesCountRadius,_.surroundingSubtitlesTimeRadius):[]:N(te(),v,5e3)}),[v,b,te,_.surroundingSubtitlesCountRadius,_.surroundingSubtitlesTimeRadius]),ae=Object(f.useCallback)((function(){if(!z.current)return[];var e=Math.min.apply(Math,Object(r.a)(Object.keys(z.current).map((function(e){return Number(e)}))));return ne(e)}),[ne]),ie=Object(f.useCallback)((function(){if(!b||0===b.length){var e=t.time(v),n=Math.min(e+5e3,v);return{text:"",start:e,originalStart:e,end:n,originalEnd:n,track:0}}if(z.current){var a=Object.keys(z.current).map((function(e){return Number(e)}));if(0!==a.length){var i=Math.min.apply(Math,Object(r.a)(a));return b[i]}}}),[t,b,v]);Object(f.useEffect)((function(){return P.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation(),a(t,ae(),re.none)}),(function(){return S}),(function(){return ie()}))}),[P,S,ie,ae,a]),Object(f.useEffect)((function(){return P.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){return S}))}),[P,S,o]),Object(f.useEffect)((function(){return P.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=ie();t&&a(t,ae(),re.showAnkiDialog)}),(function(){return S}))}),[P,a,S,b,ie,ae]),Object(f.useEffect)((function(){return P.bindUpdateLastCard((function(e){e.preventDefault(),e.stopPropagation();var t=ie();t&&a(t,ae(),re.updateLastCard)}),(function(){return S}))}),[P,a,S,b,ie,ae]);var se=Object(f.useCallback)((function(e){if(b){var t=z.current||{};n(b[e].start,!R.current&&e in t)}}),[b,n]),oe=Object(f.useCallback)((function(e,t){e.preventDefault(),e.stopPropagation(),b&&a(b[t],ne(t),re.none,!0)}),[b,ne,a]),ce=null;return b&&0!==b.length?ce=Object(pe.jsx)(_a.a,{className:Q.table,children:Object(pe.jsx)(wa.a,{children:Object(pe.jsx)(Ta.a,{children:b.map((function(e,t){var n=t in W;return Object(pe.jsx)(Aa,{index:t,compressed:j,selected:n,copyButtonEnabled:m,disabled:F[e.track],subtitle:b[t],subtitleRef:A[t],onClickSubtitle:se,onCopySubtitle:oe},t)}))})})}):!k&&x?ce=!k&&x&&Object(pe.jsx)("div",{className:Q.noSubtitles,children:Object(pe.jsx)(nt.a,{variant:"h6",children:x})}):b&&0===b.length&&(ce=Object(pe.jsx)("div",{className:Q.noSubtitles,children:Object(pe.jsx)(nt.a,{variant:"h6",children:E("landing.noSubtitles")})})),Object(pe.jsx)(Ve.a,{square:!0,elevation:0,ref:X,className:Q.container,children:ce})}var Ia=function(){function e(t){var n=this;Object(F.a)(this,e),this.protocol=void 0,this.time=void 0,this.isReady=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.currentTimeCallbacks=void 0,this.exitCallbacks=void 0,this.offsetCallbacks=void 0,this.playbackRateCallbacks=void 0,this.popOutToggleCallbacks=void 0,this.copyCallbacks=void 0,this.playModeCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.fullscreenToggleCallbacks=void 0,this.ankiDialogRequestCallbacks=void 0,this.toggleSubtitleTrackInListCallbacks=void 0,this.readyState=void 0,this.oncanplay=null,this.audioTracks=void 0,this.selectedAudioTrack=void 0,this.duration=void 0,this._playbackRate=void 0,this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this._playbackRate=1,this.selectedAudioTrack=void 0,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.fullscreenToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[];var a=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":var t=e.data;a.duration=t.duration,a.isReady=!0,a.audioTracks=t.audioTracks,a.selectedAudioTrack=t.selectedAudioTrack,a.readyState=4,a.time=t.currentTime,n._playbackRate=t.playbackRate;var r,s=Object(i.a)(a.readyCallbacks);try{for(s.s();!(r=s.n()).done;){(0,r.value)(t.paused)}}catch(Y){s.e(Y)}finally{s.f()}break;case"readyState":var o,c=e.data;if(a.readyState=c.value,4===a.readyState)null===(o=a.oncanplay)||void 0===o||o.call(a,new Event("canplay"));break;case"play":var u,l=e.data,d=Object(i.a)(a.playCallbacks);try{for(d.s();!(u=d.n()).done;){(0,u.value)(l.echo)}}catch(Y){d.e(Y)}finally{d.f()}break;case"pause":var b,f=e.data,h=Object(i.a)(a.pauseCallbacks);try{for(h.s();!(b=h.n()).done;){(0,b.value)(f.echo)}}catch(Y){h.e(Y)}finally{h.f()}break;case"audioTrackSelected":var v,p=e.data,g=Object(i.a)(a.audioTrackSelectedCallbacks);try{for(g.s();!(v=g.n()).done;){var j=v.value;a.selectedAudioTrack=p.id,j(p.id)}}catch(Y){g.e(Y)}finally{g.f()}break;case"currentTime":var m,k=e.data,O=Object(i.a)(a.currentTimeCallbacks);try{for(O.s();!(m=O.n()).done;){(0,m.value)(k.value,k.echo)}}catch(Y){O.e(Y)}finally{O.f()}break;case"exit":var y,x=Object(i.a)(a.exitCallbacks);try{for(x.s();!(y=x.n()).done;){(0,y.value)()}}catch(Y){x.e(Y)}finally{x.f()}break;case"offset":var S,C=e.data,w=Object(i.a)(a.offsetCallbacks);try{for(w.s();!(S=w.n()).done;){(0,S.value)(C.value)}}catch(Y){w.e(Y)}finally{w.f()}break;case"playbackRate":var T,F=e.data,_=Object(i.a)(a.playbackRateCallbacks);try{for(_.s();!(T=_.n()).done;){(0,T.value)(F.value,F.echo)}}catch(Y){_.e(Y)}finally{_.f()}break;case"popOutToggle":var P,E=Object(i.a)(a.popOutToggleCallbacks);try{for(E.s();!(P=E.n()).done;){(0,P.value)()}}catch(Y){E.e(Y)}finally{E.f()}break;case"copy":var R,M=Object(i.a)(a.copyCallbacks);try{for(M.s();!(R=M.n()).done;){var A,B=R.value,I=e.data;B(I.subtitle,I.surroundingSubtitles,I.audio,I.image,I.url,null!==(A=I.postMineAction)&&void 0!==A?A:re.none,I.id,I.mediaTimestamp)}}catch(Y){M.e(Y)}finally{M.f()}break;case"playMode":var N,D=Object(i.a)(a.playModeCallbacks);try{for(D.s();!(N=D.n()).done;){(0,N.value)(e.data.playMode)}}catch(Y){D.e(Y)}finally{D.f()}break;case"hideSubtitlePlayerToggle":var L,H=Object(i.a)(a.hideSubtitlePlayerToggleCallbacks);try{for(H.s();!(L=H.n()).done;){(0,L.value)()}}catch(Y){H.e(Y)}finally{H.f()}break;case"appBarToggle":var W,U=Object(i.a)(a.appBarToggleCallbacks);try{for(U.s();!(W=U.n()).done;){(0,W.value)()}}catch(Y){U.e(Y)}finally{U.f()}break;case"fullscreenToggle":var z,V=Object(i.a)(n.fullscreenToggleCallbacks);try{for(V.s();!(z=V.n()).done;){(0,z.value)()}}catch(Y){V.e(Y)}finally{V.f()}break;case"sync":case"syncv2":break;case"ankiDialogRequest":var K,q=Object(i.a)(a.ankiDialogRequestCallbacks);try{for(q.s();!(K=q.n()).done;){(0,K.value)()}}catch(Y){q.e(Y)}finally{q.f()}break;case"toggleSubtitleTrackInList":var G,X=e.data,J=Object(i.a)(a.toggleSubtitleTrackInListCallbacks);try{for(J.s();!(G=J.n()).done;){(0,G.value)(X.track)}}catch(Y){J.e(Y)}finally{J.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(_.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3;var t={command:"currentTime",value:this.time};this.protocol.postMessage(t)}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){var t={command:"playbackRate",value:e};this.protocol.postMessage(t)}},{key:"onReady",value:function(e){var t=this;return this.isReady&&e(!1),this.readyCallbacks.push(e),function(){return t._remove(e,t.readyCallbacks)}}},{key:"onPlay",value:function(e){var t=this;return this.playCallbacks.push(e),function(){return t._remove(e,t.playCallbacks)}}},{key:"onPause",value:function(e){var t=this;return this.pauseCallbacks.push(e),function(){return t._remove(e,t.pauseCallbacks)}}},{key:"onCurrentTime",value:function(e){var t=this;return this.currentTimeCallbacks.push(e),function(){return t._remove(e,t.currentTimeCallbacks)}}},{key:"onAudioTrackSelected",value:function(e){var t=this;return this.audioTrackSelectedCallbacks.push(e),function(){return t._remove(e,t.audioTrackSelectedCallbacks)}}},{key:"onExit",value:function(e){var t=this;return this.exitCallbacks.push(e),function(){return t._remove(e,t.exitCallbacks)}}},{key:"onOffset",value:function(e){var t=this;return this.offsetCallbacks.push(e),function(){return t._remove(e,t.offsetCallbacks)}}},{key:"onPlaybackRate",value:function(e){var t=this;return this.playbackRateCallbacks.push(e),function(){return t._remove(e,t.playbackRateCallbacks)}}},{key:"onPopOutToggle",value:function(e){var t=this;return this.popOutToggleCallbacks.push(e),function(){return t._remove(e,t.popOutToggleCallbacks)}}},{key:"onCopy",value:function(e){var t=this;return this.copyCallbacks.push(e),function(){return t._remove(e,t.copyCallbacks)}}},{key:"onPlayMode",value:function(e){var t=this;return this.playModeCallbacks.push(e),function(){return t._remove(e,t.playModeCallbacks)}}},{key:"onHideSubtitlePlayerToggle",value:function(e){var t=this;return this.hideSubtitlePlayerToggleCallbacks.push(e),function(){return t._remove(e,t.hideSubtitlePlayerToggleCallbacks)}}},{key:"onAppBarToggle",value:function(e){var t=this;return this.appBarToggleCallbacks.push(e),function(){return t._remove(e,t.appBarToggleCallbacks)}}},{key:"onFullscreenToggle",value:function(e){var t=this;return this.fullscreenToggleCallbacks.push(e),function(){return t._remove(e,t.fullscreenToggleCallbacks)}}},{key:"onAnkiDialogRequest",value:function(e){var t=this;return this.ankiDialogRequestCallbacks.push(e),function(){return t._remove(e,t.ankiDialogRequestCallbacks)}}},{key:"onToggleSubtitleTrackInList",value:function(e){var t=this;return this.toggleSubtitleTrackInListCallbacks.push(e),function(){return t._remove(e,t.toggleSubtitleTrackInListCallbacks)}}},{key:"ready",value:function(e,t){var n={command:"ready",duration:e,videoFileName:t};this.protocol.postMessage(n)}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){return this.protocol.postMessage({command:"play"}),new Promise((function(e,t){return e()}))}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){var t={command:"audioTrackSelected",id:e};this.protocol.postMessage(t)}},{key:"subtitles",value:function(e,t){this.protocol.postMessage({command:"subtitles",value:e,name:t.length>0?t[0]:null,names:t})}},{key:"offset",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t={command:"offset",value:e};this.protocol.postMessage(t)}))},{key:"subtitleSettings",value:function(e){var t={command:"subtitleSettings",value:e};this.protocol.postMessage(t)}},{key:"playMode",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t={command:"playMode",playMode:e};this.protocol.postMessage(t)}))},{key:"hideSubtitlePlayerToggle",value:function(e){var t={command:"hideSubtitlePlayerToggle",value:e};this.protocol.postMessage(t)}},{key:"appBarToggle",value:function(e){var t={command:"appBarToggle",value:e};this.protocol.postMessage(t)}},{key:"fullscreenToggle",value:function(e){var t={command:"fullscreenToggle",value:e};this.protocol.postMessage(t)}},{key:"ankiSettings",value:function(e){var t={command:"ankiSettings",value:e};this.protocol.postMessage(t)}},{key:"miscSettings",value:function(e){var t={command:"miscSettings",value:e};this.protocol.postMessage(t)}},{key:"alert",value:function(e,t){var n={command:"alert",message:e,severity:t};this.protocol.postMessage(n)}},{key:"copy",value:function(e){var t={command:"copy",postMineAction:e};this.protocol.postMessage(t)}},{key:"takeScreenshot",value:function(){this.protocol.postMessage({command:"takeScreenshot"})}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close(),this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.fullscreenToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[]}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}}]),e}(),Na=n(101),Da=n.n(Na),La=n(102),Ha=n.n(La),Wa=Object(x.a)({root:function(e){return{height:e.appBarHidden?"100vh":"calc(100vh - 64px)",position:"relative",overflowX:"hidden"}},container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0,display:"block"}});function Ua(e,t,n,a){var i;i=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var r=e&&e.duration?1e3*e.duration:0,s=t&&t.duration?1e3*t.duration:0;return Math.max(s,Math.max(i,r))}function za(e){var t,n=e.sources,a=n.subtitleFiles,i=n.flattenSubtitleFiles,r=n.audioFile,o=n.audioFileUrl,u=n.videoFile,d=n.videoFileUrl,h=e.subtitleReader,v=e.settingsProvider,p=e.playbackPreferences,g=e.keyBinder,j=e.extension,m=e.videoFrameRef,k=e.videoChannelRef,O=e.drawerOpen,y=e.appBarHidden,x=e.videoFullscreen,S=e.hideSubtitlePlayer,C=e.videoPopOut,w=e.tab,T=e.availableTabs,F=e.ankiDialogRequested,_=e.ankiDialogFinishedRequest,P=e.ankiDialogOpen,E=e.onError,R=e.onUnloadAudio,M=e.onUnloadVideo,A=e.onCopy,B=e.onLoaded,I=e.onTabSelected,N=e.onAnkiDialogRequest,D=e.onAnkiDialogRewind,L=e.onAppBarToggle,H=e.onFullscreenToggle,W=e.onHideSubtitlePlayer,U=e.onVideoPopOut,z=e.onPlayModeChangedViaBind,V=e.onTakeScreenshot,K=e.disableKeyEvents,q=e.jumpToSubtitle,G=e.rewindSubtitle,X=Object(f.useState)(oe.normal),J=Object(l.a)(X,2),Y=J[0],Q=J[1],Z=Object(f.useState)(),$=Object(l.a)(Z,2),ee=$[0],te=$[1],ne=Object(f.useState)(),ae=Object(l.a)(ne,2),ie=ae[0],re=ae[1],ce=Object(f.useRef)();ce.current=ee;var le=Object(f.useMemo)((function(){return new On(null!==ee&&void 0!==ee?ee:[],{returnLastShown:!0,returnNextToShow:Y===oe.condensed,showingCheckRadiusMs:100})}),[ee,Y]),de=ee&&ee.length>0&&Boolean(d||o),fe=Object(f.useState)(!1),he=Object(l.a)(fe,2),ve=he[0],ge=he[1],je=Object(f.useState)(!1),me=Object(l.a)(je,2),ke=me[0],Oe=me[1],ye=Object(f.useState)(0),xe=Object(l.a)(ye,2),Se=xe[0],Ce=xe[1],we=Object(f.useState)(0),Te=Object(l.a)(we,2),Fe=Te[0],_e=Te[1],Pe=Object(f.useState)(1),Ee=Object(l.a)(Pe,2),Re=Ee[0],Me=Ee[1],Ae=Object(f.useState)(),Be=Object(l.a)(Ae,2)[1],Ie=Object(f.useState)(),Ne=Object(l.a)(Ie,2),De=Ne[0],Le=Ne[1],He=Object(f.useState)(),Ue=Object(l.a)(He,2),ze=Ue[0],Ve=Ue[1],Ke=Object(f.useState)(),qe=Object(l.a)(Ke,2),Ge=qe[0],Xe=qe[1],Je=Object(f.useState)(),Ye=Object(l.a)(Je,2),Qe=Ye[0],Ze=Ye[1],$e=Object(f.useRef)();$e.current=Qe;var et=Object(f.useState)(!1),tt=Object(l.a)(et,2)[1];Object(f.useRef)().current=S;var nt=Object(f.useState)({}),at=Object(l.a)(nt,2),it=at[0],rt=at[1],st=Object(f.useCallback)((function(){return Be({})}),[]),ot=Object(f.useRef)({x:0,y:0}),ct=Object(f.useRef)(null),ut=Object(f.useMemo)((function(){return new Ca(o?ct:d||w?{current:Qe}:{current:null})}),[Qe,o,d,w]),lt=Object(f.useMemo)((function(){return new Cn}),[]),dt=Wa({appBarHidden:y}),bt=function(){return Ua(ct.current,$e.current,ce.current)},ft=Object(f.useCallback)((function(){Y!==oe.autoPause||v.autoPausePreference!==se.atStart||d||Ot(lt,ut,!0)}),[Y,lt,ut,d,v]),ht=Object(f.useCallback)((function(){Y!==oe.autoPause||v.autoPausePreference!==se.atEnd||d||Ot(lt,ut,!0)}),[Y,lt,ut,d,v]),vt=Object(f.useMemo)((function(){var e=new ue;return e.onStartedShowing=ft,e.onWillStopShowing=ht,e}),[ft,ht]),pt=Object(f.useRef)();pt.current=vt;var gt=Object(f.useCallback)(function(){var e=Object(s.a)(b.a.mark((function e(t,n,a){var i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setTime(t),st(),!a){e.next=5;break}return e.next=5,ut.seek(t/1e3);case 5:null===(i=pt.current)||void 0===i||i.clear();case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[st,ut]),jt=Object(f.useCallback)((function(e,t){lt.rate=e,Me(e),t&&ut.playbackRate(e)}),[lt,ut]),mt=Object(f.useCallback)((function(e,t){_e(e),te((function(n){if(n){var i=n.length>0?n[n.length-1].end+e:0,r=n.map((function(t,n){return{text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,displayTime:Jt(t.originalStart+e,i),track:t.track,index:n}}));return t&&void 0!==Qe&&(Qe.offset(e),void 0!==w&&j.installed&&Da()(j.version,"0.22.0")&&Qe.subtitles(r,a.map((function(e){return e.name})))),r}})),p.offset=e}),[a,j,p,w,Qe]);function kt(e,t,n){Oe(!0),e.start(),n&&t.play()}function Ot(e,t,n){Oe(!1),e.stop(),n&&t.pause()}Object(f.useEffect)((function(){if(u||w){var e;if(u){var t=Object(be.a)();e=new Ia(new xn(t)),Xe(t),B([u])}else(e=new Ia(new Sn(w.id,w.src,j))).init();return k.current=e,Ze(e),function(){lt.setTime(0),lt.stop(),Oe(!1),e.close()}}}),[lt,C,u,w,j,k,B]),Object(f.useEffect)((function(){function e(){return e=Object(s.a)(b.a.mark((function e(){var t,n,r,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p.offset,_e(t),!(a.length>0)){e.next=24;break}return ge(!0),e.prev=4,e.next=7,h.subtitles(a,i);case 7:r=e.sent,s=r.length>0?r[r.length-1].end+t:0,n=r.map((function(e,n){return{text:e.text,textImage:e.textImage,start:e.start+t,originalStart:e.start,end:e.end+t,originalEnd:e.end,displayTime:Jt(e.start+t,s),track:e.track,index:n}})),re(!1),te(n),Q((function(e){return n&&0!==n.length?e:oe.normal})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(4),E(e.t0),te([]);case 19:return e.prev=19,ge(!1),e.finish(19);case 22:e.next=26;break;case 24:n=void 0,Q(oe.normal);case 26:case"end":return e.stop()}}),e,null,[[4,15,19,22]])}))),e.apply(this,arguments)}(function(){return e.apply(this,arguments)})().then((function(){return B(a)}))}),[h,p,B,E,a,i]),Object(f.useEffect)((function(){re(!1)}),[Qe]),Object(f.useEffect)((function(){Oe(!1),lt.setTime(0),lt.stop(),ct.current&&(ct.current.pause(),ct.current.currentTime=0),r&&B([r])}),[lt,B,r]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onExit((function(){return d&&M(d)}))}),[Qe,M,d]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onPopOutToggle((function(){return U()}))}),[Qe,U]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onHideSubtitlePlayerToggle(W)}),[Qe,W]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onAppBarToggle(L)}),[Qe,L]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onFullscreenToggle(H)}),[Qe,H]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onReady((function(){return null===Qe||void 0===Qe?void 0:Qe.ready(Ua(ct.current,Qe,ee))}))}),[Qe,ee]),Object(f.useEffect)((function(){if(void 0!==Qe&&void 0!==ee&&!ie)return Qe.onReady((function(){re(!0),Qe.subtitles(ee,i?[a[0].name]:a.map((function(e){return e.name})))}))}),[ee,Qe,i,a,ie]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onReady((function(){return null===Qe||void 0===Qe?void 0:Qe.subtitleSettings(v.subtitleSettings)}))}),[Qe,v]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.ankiSettings(v.ankiSettings)}),[Qe,v]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.miscSettings(v.miscSettings)}),[Qe,v]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.playMode(Y)}),[Qe,Y]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.hideSubtitlePlayerToggle(S)}),[Qe,S]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onReady((function(){var e;null!==Qe&&void 0!==Qe&&Qe.audioTracks&&(null===Qe||void 0===Qe||null===(e=Qe.audioTracks)||void 0===e?void 0:e.length)>1?(Le(null===Qe||void 0===Qe?void 0:Qe.audioTracks),Ve(null===Qe||void 0===Qe?void 0:Qe.selectedAudioTrack)):(Le(void 0),Ve(void 0))}))}),[Qe]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onReady((function(e){Qe&&lt.setTime(1e3*Qe.currentTime),e?lt.stop():lt.start(),Oe(!e),null!==Qe&&void 0!==Qe&&Qe.playbackRate&&(lt.rate=Qe.playbackRate,Me(Qe.playbackRate))}))}),[Qe,lt]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onPlay((function(e){return kt(lt,ut,e)}))}),[Qe,ut,lt]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onPause((function(e){return Ot(lt,ut,e)}))}),[Qe,ut,lt]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onOffset((function(e){var t;return mt(Math.max(null!==(t=-bt())&&void 0!==t?t:0,e),!1)}))}),[Qe,mt]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onPlaybackRate(jt)}),[Qe,jt]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onCopy((function(e,t,n,i,s,o,c,l){return A(e,t,r,u,e?a[e.track]:void 0,l,null===Qe||void 0===Qe?void 0:Qe.selectedAudioTrack,null===Qe||void 0===Qe?void 0:Qe.playbackRate,n,i,s,o,c)}))}),[Qe,A,r,u,a]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onPlayMode((function(e){Q(e),null===Qe||void 0===Qe||Qe.playMode(e)}))}),[Qe,Y]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onCurrentTime(function(){var e=Object(s.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ke&&lt.stop(),e.next=3,gt(1e3*t,lt,n);case 3:ke&&lt.start();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}),[Qe,lt,ke,gt]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onAudioTrackSelected(function(){var e=Object(s.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ke&&lt.stop(),e.next=3,ut.onReady();case 3:ke&&lt.start(),Ve(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[Qe,lt,ut,ke]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onAnkiDialogRequest((function(){return N()}))}),[Qe,N]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.onToggleSubtitleTrackInList((function(e){return rt((function(t){var n=Object(c.a)({},t);return n[e]=!t[e],n}))}))}),[Qe]),Object(f.useEffect)((function(){_&&_.timestamp>0&&tt((function(e){return e&&_.resume&&kt(lt,ut,!0),!1}))}),[_,lt,ut]),Object(f.useEffect)((function(){F&&ke&&(Ot(lt,ut,!0),tt(!0))}),[F,lt,ut,ke]),Object(f.useEffect)((function(){if(Y===oe.condensed&&ee&&0!==ee.length){var e=!1,t=1e3,n=setInterval(Object(s.a)(b.a.mark((function n(){var a,i,r,s;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=lt.time(bt()),!((i=le.subtitlesAt(a)).nextToShow&&i.nextToShow.length>0)){n.next=15;break}if(!((r=i.nextToShow[0]).start-a<t+500)){n.next=6;break}return n.abrupt("return");case 6:if(ke&&lt.stop(),e){n.next=14;break}return e=!0,s=Date.now(),n.next=12,gt(r.start,lt,!0);case 12:t=Date.now()-s,e=!1;case 14:ke&&lt.start();case 15:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[ee,le,Y,lt,gt,ke]),Object(f.useEffect)((function(){C&&d&&Ge&&window.open("/asbplayer/?video="+encodeURIComponent(d)+"&channel="+Ge+"&popout=true","asbplayer-video-"+d,"resizable,width=800,height=450"),Ce(Date.now())}),[C,Ge,d,m,k]);var yt=Object(f.useCallback)((function(){return kt(lt,ut,!0)}),[lt,ut]),xt=Object(f.useCallback)((function(){return Ot(lt,ut,!0)}),[lt,ut]),St=Object(f.useCallback)(function(){var e=Object(s.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ke&&lt.stop(),e.next=3,gt(t*bt(),lt,!0);case 3:ke&&lt.start();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[lt,gt,ke]),Ct=Object(f.useCallback)(function(){var e=Object(s.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||Ot(lt,ut,!0),e.next=3,gt(t,lt,!0);case 3:n&&!ke&&kt(lt,ut,!0);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[lt,gt,ut,ke]),wt=Object(f.useCallback)((function(e,t,n,i){!d||i?A(e,t,r,u,a[e.track],lt.time(bt()),ze,Re,void 0,void 0,void 0,n,void 0):null===Qe||void 0===Qe||Qe.copy(n)}),[Qe,A,lt,r,u,d,a,ze,Re]),Tt=Object(f.useCallback)((function(e){ot.current.x=e.screenX,ot.current.y=e.screenY}),[]),Ft=Object(f.useCallback)(function(){var e=Object(s.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===Qe||void 0===Qe||Qe.audioTrackSelected(t),Ot(lt,ut,!0),e.next=4,gt(0,lt,!0);case 4:ke&&kt(lt,ut,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Qe,lt,ut,gt,ke]),_t=Object(f.useCallback)((function(e){var t,n=bt();mt(Math.max(null!==(t=-n)&&void 0!==t?t:0,e),!0)}),[mt]),Pt=Object(f.useCallback)((function(e){ct.current instanceof HTMLMediaElement&&(ct.current.volume=e)}),[]),Et=Object(f.useCallback)((function(e){jt(e,!0)}),[jt]),Rt=Object(f.useCallback)((function(e){return Q(e)}),[]),Mt=Object(f.useCallback)((function(e){return rt((function(t){var n=Object(c.a)({},t);return n[e]=!t[e],n}))}),[]),At=Object(f.useCallback)((function(e){0!==e.length&&v.autoCopyCurrentSubtitle&&document.hasFocus()&&navigator.clipboard.writeText(e.map((function(e){return e.text})).join("\n")).catch((function(e){}))}),[v.autoCopyCurrentSubtitle]);Object(f.useEffect)((function(){if(!w){var e=setInterval(Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(lt.progress(bt())>=1)){e.next=6;break}return Ot(lt,ut,!0),e.next=5,gt(0,lt,!0);case 5:Ce(Date.now());case 6:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearInterval(e)}}}),[lt,ut,gt,w]),Object(f.useEffect)((function(){var e=g.bindPlay((function(e){e.preventDefault(),ke?Ot(lt,ut,!0):kt(lt,ut,!0)}),(function(){return K}));return function(){return e()}}),[g,ke,lt,ut,K]),Object(f.useEffect)((function(){return g.bindAdjustPlaybackRate((function(e,t){e.preventDefault(),jt(t?Math.min(5,Re+.1):Math.max(.1,Re-.1),!0)}),(function(){return K}))}),[jt,Re,K,g]);var Bt=Object(f.useCallback)((function(e,t){if(de){e.preventDefault();var n=Y===t?oe.normal:t;Q(n),z(Y,n),null===Qe||void 0===Qe||Qe.playMode(n)}}),[Qe,Y,de,z]);Object(f.useEffect)((function(){return g.bindAutoPause((function(e){return Bt(e,oe.autoPause)}),(function(){return K}))}),[Bt,g,K]),Object(f.useEffect)((function(){return g.bindCondensedPlayback((function(e){return Bt(e,oe.condensed)}),(function(){return K}))}),[Bt,g,K]),Object(f.useEffect)((function(){if(d)return g.bindTakeScreenshot((function(e){e.preventDefault(),P?D():V(lt.time(bt()))}),(function(){return!1}))}),[d,lt,V,D,g,K,P]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.appBarToggle(y)}),[Qe,y]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.hideSubtitlePlayerToggle(S)}),[Qe,S]),Object(f.useEffect)((function(){return null===Qe||void 0===Qe?void 0:Qe.fullscreenToggle(x)}),[Qe,x]),Object(f.useEffect)((function(){void 0!==(null===G||void 0===G?void 0:G.start)&&(Ot(lt,ut,!0),gt(G.start,lt,!0))}),[lt,null===G||void 0===G?void 0:G.start,ut,gt]);var It=o||d||ee,Nt=Boolean(It&&d&&!C);return Object(pe.jsxs)("div",{onMouseMove:Tt,className:dt.root,children:[Object(pe.jsxs)(We.a,{container:!0,direction:"row",wrap:"nowrap",className:dt.container,children:[Nt&&Object(pe.jsx)(We.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(pe.jsx)("iframe",{ref:m,className:dt.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(d)+"&channel="+Ge+"&popout=false",title:"asbplayer"})}),Object(pe.jsxs)(We.a,{item:!0,style:{flexGrow:Nt?0:1,width:!Nt||!S&&ee&&0!==(null===(t=ee)||void 0===t?void 0:t.length)?"auto":0},children:[It&&!(d&&!C)&&Object(pe.jsx)(Sa,{mousePositionRef:ot,playing:ke,clock:lt,length:bt(),displayLength:Ua(ct.current,Qe,ee,!1),audioTracks:De,selectedAudioTrack:ze,tabs:!d&&!o&&T||void 0,selectedTab:w,audioFile:null===r||void 0===r?void 0:r.name,videoFile:null===u||void 0===u?void 0:u.name,offsetEnabled:!0,offset:Fe,playbackRate:Re,playbackRateEnabled:!w||j.installed&&Ha()(j.version,"0.24.0"),onPlaybackRateChange:Et,volumeEnabled:Boolean(o),playModeEnabled:de,playMode:Y,onPlay:yt,onPause:xt,onSeek:St,onAudioTrackSelected:Ft,onTabSelected:I,onUnloadAudio:function(){return o&&R(o)},onUnloadVideo:function(){return d&&M(d)},onOffsetChange:_t,onVolumeChange:Pt,onPlayMode:Rt,disableKeyEvents:K,playbackPreferences:p,showOnMouseMovement:!0}),Object(pe.jsx)(Ba,{playing:ke,subtitles:ee,subtitleCollection:le,clock:lt,length:bt(),jumpToSubtitle:q,drawerOpen:O,appBarHidden:y,compressed:Boolean(d&&!C),copyButtonEnabled:void 0===w,loading:ve,displayHelp:(null===r||void 0===r?void 0:r.name)||C&&(null===u||void 0===u?void 0:u.name)||void 0,disableKeyEvents:K,lastJumpToTopTimestamp:Se,hidden:Nt&&S,disabledSubtitleTracks:it,onSeek:Ct,onCopy:wt,onOffsetChange:_t,onToggleSubtitleTrack:Mt,onSubtitlesSelected:At,autoPauseContext:vt,settingsProvider:v,keyBinder:g})]})]}),Object(pe.jsx)("audio",{ref:ct,src:o})]})}var Va=n(166),Ka=n.n(Va),qa=n(486),Ga=n(252),Xa=n.n(Ga),Ja=n(167),Ya=n.n(Ja),Qa=n(409),Za=n(487),$a=n(417),ei=n(413),ti=n(411),ni=n(410),ai=n(485),ii=n(165),ri=n.n(ii),si=n(495),oi=n(253),ci=n.n(oi),ui=n(418),li=n(74),di=n(30),bi=n(488),fi=n(489),hi=n(492),vi=Object(ye.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitlePreview:{backgroundImage:"linear-gradient(45deg, ".concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(-45deg, ").concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(45deg, transparent 75%, ").concat(e.palette.action.disabledBackground," 75%), linear-gradient(-45deg, transparent 75%,").concat(e.palette.action.disabledBackground," 75%)"),backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",marginTop:e.spacing(1),marginBottom:e.spacing(1),maxWidth:"100%",padding:10},subtitlePreviewInput:{border:"none",width:"100%",textAlign:"center",backgroundColor:"rgba(0,0,0,0)","&:focus":{outline:"none"}},switchLabel:{justifyContent:"space-between",marginLeft:0},verticallyCentered:{display:"flex",flexDirection:"column",justifyContent:"center"}}})),pi=Object(ye.a)((function(e){return{formControl:{marginLeft:e.spacing(1),marginBottom:e.spacing(1),minWidth:120},root:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"flex-end"}}}));function gi(e){var t=e.label,n=e.value,a=e.selections,i=e.removable,r=e.onChange,s=e.onSelectionChange,o=e.onRemoval,c=pi();return Object(pe.jsxs)("div",{className:c.root,children:[Object(pe.jsx)(me.a,{label:t,value:n,onChange:r,fullWidth:!0,color:"secondary",InputProps:{endAdornment:i&&Object(pe.jsx)(ze.a,{position:"end",children:Object(pe.jsx)(Ue.a,{onClick:function(e){return null===o||void 0===o?void 0:o()},children:Object(pe.jsx)(ri.a,{fontSize:"small"})})})}}),Object(pe.jsxs)(Qa.a,{className:c.formControl,children:[Object(pe.jsx)(ni.a,{}),Object(pe.jsx)(ui.a,{value:n,disabled:!a,color:"secondary",onChange:s,children:a&&a.map((function(e){return Object(pe.jsx)(ai.a,{value:e,children:e},e)}))})]})]})}var ji=di.isMacOs?{}:{"\u2303":"ctrl","\u21e7":"shift","\u2325":"alt"},mi=["\u2303","\u21e7","\u2325","ctrl","shift","alt","option","control","command","\u2318"],ki=Object(ye.a)((function(e){return{container:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},labelItem:{}}}));function Oi(e){var t=e.label,n=e.keys,a=e.extensionOverridden,i=e.onKeysChange,r=e.onOpenExtensionShortcuts,s=Object(p.c)().t,o=ki(),c=Object(f.useState)(n),u=Object(l.a)(c,2),d=u[0],b=u[1],h=Object(f.useRef)();h.current=d;var v=Object(f.useRef)();v.current=i;var g=Object(f.useState)(!1),j=Object(l.a)(g,2),m=j[0],k=j[1];Object(f.useEffect)((function(){return b(n)}),[n]);var O,y=Object(f.useCallback)((function(e){0!==e.nativeEvent.detail&&(a?r():(b(""),k(!0)))}),[r,a]),x=Object(f.useRef)(null);return Object(f.useEffect)((function(){if(m){var e=function(e){if("keydown"===e.type){var t=li.a.getPressedKeyString();b(t.map((function(e){var t;return null!==(t=ji[e])&&void 0!==t?t:e})).sort((function(e,t){var n=mi.includes(e),a=mi.includes(t);return n&&!a?-1:!n&&a?1:0})).join("+"))}else"keyup"===e.type&&(k(!1),h.current&&v.current(h.current))};return Object(li.a)("*",{keyup:!0},e),function(){return li.a.unbind("*",e)}}}),[m]),function(e,t){Object(f.useEffect)((function(){var n=function(n){var a;null!==(a=e.current)&&void 0!==a&&a.contains(n.target)||t(n)};return window.document.addEventListener("click",n),function(){return window.document.removeEventListener("click",n)}}),[e,t])}(x,Object(f.useCallback)((function(){m&&(k(!1),b(""),i(""))}),[m,i])),O=s(m?"settings.recordingBind":a?"settings.extensionOverriddenBind":"settings.unboundBind"),Object(pe.jsxs)(We.a,{container:!0,className:o.container,wrap:"nowrap",spacing:1,children:[Object(pe.jsx)(We.a,{item:!0,className:o.labelItem,xs:6,children:Object(pe.jsx)(nt.a,{children:t})}),Object(pe.jsx)(We.a,{item:!0,xs:6,children:Object(pe.jsx)(me.a,{placeholder:O,size:"small",contentEditable:!1,disabled:a,helperText:a?s("settings.extensionShortcut"):void 0,value:d,color:"secondary",InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:Object(pe.jsx)(Ue.a,{ref:x,onClick:y,children:Object(pe.jsx)(Xa.a,{fontSize:"small"})})})}})})]})}function yi(e){var t=e.onAddCustomField,n=Object(p.c)().t,a=Object(f.useState)(""),i=Object(l.a)(a,2),r=i[0],s=i[1];return Object(pe.jsx)(me.a,{label:n("settings.addCustomField"),fullWidth:!0,value:r,color:"secondary",onChange:function(e){return s(e.target.value)},InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:Object(pe.jsx)(Ue.a,{disabled:""===r.trim(),onClick:function(){t(r.trim()),s("")},children:Object(pe.jsx)(Ka.a,{fontSize:"small"})})})}})}function xi(e){var t=e.styleKey,n=e.onStyleKey,a=e.onAddCustomStyle,i=Object(p.c)().t;return Object(pe.jsx)(hi.a,{options:Ci,value:t,fullWidth:!0,disableClearable:!0,clearOnEscape:!0,clearOnBlur:!0,forcePopupIcon:!1,onReset:function(){return n("")},onChange:function(e,t){n(null!==t&&void 0!==t?t:"")},renderInput:function(e){return Object(pe.jsx)(me.a,Object(c.a)(Object(c.a)({placeholder:i("settings.styleKey"),label:i("settings.addCustomCss"),color:"secondary"},e),{},{InputProps:Object(c.a)(Object(c.a)({},e.InputProps),{},{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:Object(pe.jsx)(Ue.a,{disabled:void 0===Ci.find((function(e){return e===t})),onClick:function(){a(t),n(Ci[0])},children:Object(pe.jsx)(Ka.a,{fontSize:"small"})})})})}))}})}function Si(e){var t=e.customStyle,n=e.onCustomStyle,a=e.onDelete,i=Object(p.c)().t;return Object(pe.jsx)(me.a,{color:"secondary",label:i("settings.customCssField",{styleKey:t.key}),placeholder:i("settings.styleValue"),value:t.value,onChange:function(e){return n({key:t.key,value:e.target.value})},InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:Object(pe.jsx)(Ue.a,{onClick:a,children:Object(pe.jsx)(ri.a,{fontSize:"small"})})})}})}var Ci=Object.keys(document.body.style);function wi(e){var t=e.anki,n=e.extension,a=e.open,i=e.settings,o=e.scrollToId,u=e.onClose,d=vi(),v=Object(p.c)(),g=v.t,j=Object(f.useMemo)((function(){return{copySubtitle:{label:g("binds.copySubtitle"),extensionOverridden:!0},ankiExport:{label:g("binds.ankiExport"),extensionOverridden:!0},updateLastCard:{label:g("binds.updateLastCard"),extensionOverridden:!0},takeScreenshot:{label:g("binds.takeScreenshot"),extensionOverridden:!0},togglePlay:{label:g("binds.togglePlay"),extensionOverridden:!1},toggleAutoPause:{label:g("binds.toggleAutoPause"),extensionOverridden:!1},toggleCondensedPlayback:{label:g("binds.toggleCondensedPlayback"),extensionOverridden:!1},toggleSubtitles:{label:g("binds.toggleSubtitles"),extensionOverridden:!1},toggleVideoSubtitleTrack1:{label:g("binds.toggleVideoSubtitleTrack1"),extensionOverridden:!1},toggleVideoSubtitleTrack2:{label:g("binds.toggleVideoSubtitleTrack2"),extensionOverridden:!1},toggleAsbplayerSubtitleTrack1:{label:g("binds.toggleAsbplayerSubtitleTrack1"),extensionOverridden:!1},toggleAsbplayerSubtitleTrack2:{label:g("binds.toggleAsbplayerSubtitleTrack2"),extensionOverridden:!1},seekBackward:{label:g("binds.seekBackward"),extensionOverridden:!1},seekForward:{label:g("binds.seekForward"),extensionOverridden:!1},seekToPreviousSubtitle:{label:g("binds.seekToPreviousSubtitle"),extensionOverridden:!1},seekToNextSubtitle:{label:g("binds.seekToNextSubtitle"),extensionOverridden:!1},seekToBeginningOfCurrentSubtitle:{label:g("binds.seekToBeginningOfCurrentSubtitle"),extensionOverridden:!1},adjustOffsetToPreviousSubtitle:{label:g("binds.adjustOffsetToPreviousSubtitle"),extensionOverridden:!1},adjustOffsetToNextSubtitle:{label:g("binds.adjustOffsetToNextSubtitle"),extensionOverridden:!1},increaseOffset:{label:g("binds.increaseOffset"),extensionOverridden:!1},decreaseOffset:{label:g("binds.decreaseOffset"),extensionOverridden:!1},resetOffset:{label:g("binds.resetOffset"),extensionOverridden:!1},increasePlaybackRate:{label:g("binds.increasePlaybackRate"),extensionOverridden:!1},decreasePlaybackRate:{label:g("binds.decreasePlaybackRate"),extensionOverridden:!1}}}),[g]),m=Object(f.useState)(i.ankiConnectUrl),k=Object(l.a)(m,2),O=k[0],y=k[1],x=Object(f.useState)(),S=Object(l.a)(x,2),C=S[0],w=S[1],T=Object(f.useState)(0),F=Object(l.a)(T,2),_=F[0],P=F[1],E=Object(f.useState)(i.deck||""),R=Object(l.a)(E,2),M=R[0],A=R[1],B=Object(f.useState)(),I=Object(l.a)(B,2),N=I[0],D=I[1],L=Object(f.useState)(i.noteType||""),H=Object(l.a)(L,2),W=H[0],U=H[1],V=Object(f.useState)(),K=Object(l.a)(V,2),q=K[0],G=K[1],X=Object(f.useState)(i.sentenceField||""),J=Object(l.a)(X,2),Y=J[0],Q=J[1],Z=Object(f.useState)(i.definitionField||""),$=Object(l.a)(Z,2),ee=$[0],te=$[1],ne=Object(f.useState)(i.audioField||""),ae=Object(l.a)(ne,2),ie=ae[0],re=ae[1],oe=Object(f.useState)(i.imageField||""),ce=Object(l.a)(oe,2),ue=ce[0],le=ce[1],be=Object(f.useState)(i.wordField||""),fe=Object(l.a)(be,2),he=fe[0],ve=fe[1],ge=Object(f.useState)(i.sourceField||""),je=Object(l.a)(ge,2),ke=je[0],ye=je[1],xe=Object(f.useState)(i.urlField||""),Se=Object(l.a)(xe,2),we=Se[0],Te=Se[1],Fe=Object(f.useState)(i.customAnkiFields),_e=Object(l.a)(Fe,2),Pe=_e[0],Ee=_e[1],Me=Object(f.useState)(i.tags),Ae=Object(l.a)(Me,2),Ne=Ae[0],De=Ae[1],Le=Object(f.useState)(i.preferMp3),He=Object(l.a)(Le,2),Ve=He[0],Ke=He[1],qe=Object(f.useState)(),Ge=Object(l.a)(qe,2),Xe=Ge[0],Je=Ge[1],Ye=Object(f.useState)(i.audioPaddingStart),Qe=Object(l.a)(Ye,2),Ze=Qe[0],et=Qe[1],at=Object(f.useState)(i.audioPaddingEnd),it=Object(l.a)(at,2),rt=it[0],st=it[1],ot=Object(f.useState)(i.maxImageWidth),ct=Object(l.a)(ot,2),ut=ct[0],lt=ct[1],dt=Object(f.useState)(i.maxImageHeight),bt=Object(l.a)(dt,2),ft=bt[0],ht=bt[1],vt=Object(f.useState)(i.surroundingSubtitlesCountRadius),pt=Object(l.a)(vt,2),gt=pt[0],jt=pt[1],mt=Object(f.useState)(i.surroundingSubtitlesTimeRadius),kt=Object(l.a)(mt,2),Ot=kt[0],yt=kt[1],xt=Object(f.useState)(i.subtitleColor),St=Object(l.a)(xt,2),Ct=St[0],wt=St[1],Tt=Object(f.useState)(i.subtitleSize),Ft=Object(l.a)(Tt,2),_t=Ft[0],Pt=Ft[1],Et=Object(f.useState)(i.subtitleThickness),Rt=Object(l.a)(Et,2),Mt=Rt[0],At=Rt[1],Bt=Object(f.useState)(i.subtitleOutlineColor),It=Object(l.a)(Bt,2),Nt=It[0],Dt=It[1],Lt=Object(f.useState)(i.subtitleOutlineThickness),Ht=Object(l.a)(Lt,2),Wt=Ht[0],Ut=Ht[1],zt=Object(f.useState)(i.subtitleBackgroundColor),Vt=Object(l.a)(zt,2),Kt=Vt[0],qt=Vt[1],Gt=Object(f.useState)(i.subtitleBackgroundOpacity),Xt=Object(l.a)(Gt,2),Jt=Xt[0],Yt=Xt[1],Qt=Object(f.useState)(i.subtitleFontFamily),Zt=Object(l.a)(Qt,2),$t=Zt[0],en=Zt[1],tn=Object(f.useState)(i.subtitleCustomStyles),nn=Object(l.a)(tn,2),an=nn[0],rn=nn[1],sn=Object(f.useState)(Ci[0]),on=Object(l.a)(sn,2),cn=on[0],un=on[1],ln=Object(f.useState)(i.preCacheSubtitleDom),dn=Object(l.a)(ln,2),bn=dn[0],fn=dn[1],hn=Object(f.useState)(i.imageBasedSubtitleScaleFactor),vn=Object(l.a)(hn,2),pn=vn[0],jn=vn[1],mn=Object(f.useState)(i.subtitlePreview),kn=Object(l.a)(mn,2),On=kn[0],yn=kn[1],xn=Object(f.useState)(i.themeType),Sn=Object(l.a)(xn,2),Cn=Sn[0],wn=Sn[1],Tn=Object(f.useState)(i.copyToClipboardOnMine),Fn=Object(l.a)(Tn,2),_n=Fn[0],Pn=Fn[1],En=Object(f.useState)(i.autoPausePreference),Rn=Object(l.a)(En,2),Mn=Rn[0],An=Rn[1],Bn=Object(f.useState)(i.keyBindSet),In=Object(l.a)(Bn,2),Nn=In[0],Dn=In[1],Ln=Object(f.useState)(i.rememberSubtitleOffset),Hn=Object(l.a)(Ln,2),Wn=Hn[0],Un=Hn[1],zn=Object(f.useState)(i.miningHistoryStorageLimit),Vn=Object(l.a)(zn,2),Kn=Vn[0],qn=Vn[1],Gn=Object(f.useState)(i.autoCopyCurrentSubtitle),Xn=Object(l.a)(Gn,2),Jn=Xn[0],Yn=Xn[1],Qn=Object(f.useState)(i.subtitleRegexFilter),Zn=Object(l.a)(Qn,2),$n=Zn[0],ea=Zn[1],ta=Object(f.useState)(i.subtitleRegexFilterTextReplacement),na=Object(l.a)(ta,2),aa=na[0],ia=na[1],ra=Object(f.useState)(i.language),sa=Object(l.a)(ra,2),oa=sa[0],ca=sa[1],ua=Object(f.useCallback)((function(e){y(e.target.value),P(Date.now())}),[]),la=Object(f.useCallback)((function(e){return P(Date.now())}),[]),da=Object(f.useCallback)((function(e){return A(e.target.value)}),[]),ba=Object(f.useCallback)((function(e){return A(e.target.value)}),[]),fa=Object(f.useCallback)((function(e){return U(e.target.value)}),[]),ha=Object(f.useCallback)((function(e){return U(e.target.value)}),[]),va=Object(f.useCallback)((function(e){return Q(e.target.value)}),[]),pa=Object(f.useCallback)((function(e){return Q(e.target.value)}),[]),ga=Object(f.useCallback)((function(e){return te(e.target.value)}),[]),ja=Object(f.useCallback)((function(e){return te(e.target.value)}),[]),ma=Object(f.useCallback)((function(e){return re(e.target.value)}),[]),ka=Object(f.useCallback)((function(e){return re(e.target.value)}),[]),Oa=Object(f.useCallback)((function(e){return le(e.target.value)}),[]),ya=Object(f.useCallback)((function(e){return le(e.target.value)}),[]),xa=Object(f.useCallback)((function(e){return ve(e.target.value)}),[]),Sa=Object(f.useCallback)((function(e){return ve(e.target.value)}),[]),Ca=Object(f.useCallback)((function(e){return ye(e.target.value)}),[]),wa=Object(f.useCallback)((function(e){return ye(e.target.value)}),[]),Ta=Object(f.useCallback)((function(e){return Te(e.target.value)}),[]),Fa=Object(f.useCallback)((function(e){return Te(e.target.value)}),[]),_a=Object(f.useCallback)((function(e){return et(Number(e.target.value))}),[]),Pa=Object(f.useCallback)((function(e){return st(Number(e.target.value))}),[]),Ea=Object(f.useCallback)((function(e){return lt(Number(e.target.value))}),[]),Ra=Object(f.useCallback)((function(e){return ht(Number(e.target.value))}),[]),Ma=Object(f.useCallback)((function(e){return jt(Number(e.target.value))}),[]),Aa=Object(f.useCallback)((function(e){return yt(Number(e.target.value))}),[]),Ba=Object(f.useCallback)((function(e){return wt(e.target.value)}),[]),Ia=Object(f.useCallback)((function(e){return Pt(Number(e.target.value))}),[]),Na=Object(f.useCallback)((function(e){return Dt(e.target.value)}),[]),Da=Object(f.useCallback)((function(e){return Ut(Number(e.target.value))}),[]),La=Object(f.useCallback)((function(e){return qt(e.target.value)}),[]),Ha=Object(f.useCallback)((function(e){return Yt(Number(e.target.value))}),[]),Wa=Object(f.useCallback)((function(e){return en(e.target.value)}),[]),Ua=Object(f.useCallback)((function(e){return yn(e.target.value)}),[]),za=Object(f.useCallback)((function(e,t){return At(t)}),[]),Va=Object(f.useCallback)((function(e){rn((function(t){return[].concat(Object(r.a)(t),[{key:e,value:""}])}))}),[]),Ka=Object(f.useCallback)((function(e){return fn(e.target.checked)}),[]),Ga=Object(f.useCallback)((function(e){return jn(Number(e.target.value))}),[]),Xa=Object(f.useCallback)((function(e){Ee((function(t){var n={};return Object.assign(n,t),n[e]="",n}))}),[]),Ja=Object(f.useCallback)((function(e,t){Ee((function(n){var a={};return Object.assign(a,n),a[e]=t,a}))}),[]),Qa=Object(f.useCallback)((function(e){return Ee((function(t){var n={};return Object.assign(n,t),delete n[e],n}))}),[]),ni=Object(f.useCallback)((function(e){De(e)}),[]),ii=Object(f.useCallback)((function(e){return Ke(e.target.checked)}),[]),ri=Object(f.useCallback)((function(e){if("dark"!==e.target.value&&"light"!==e.target.value)throw new Error("Invalid theme type ".concat(e.target.value));wn(e.target.value)}),[]),oi=Object(f.useCallback)((function(e){return Pn(e.target.checked)}),[]),ui=Object(f.useCallback)((function(e){An(Number(e.target.value))}),[]),li=Object(f.useCallback)((function(e,t){Dn((function(n){var a=Object(c.a)({},n);return a[t]={keys:e},a}))}),[]),di=Object(f.useCallback)((function(e){return Un(e.target.checked)}),[]),hi=Object(f.useCallback)((function(e){return Yn(e.target.checked)}),[]),pi=Object(f.useCallback)((function(e){return qn(Number(e.target.value))}),[]),ji=Object(f.useCallback)((function(e){return ea(e.target.value.trim())}),[]),mi=Object(f.useCallback)((function(e){return ia(e.target.value)}),[]),ki=Object(f.useCallback)((function(e){return ca(e.target.value)}),[]),wi=Object(f.useMemo)((function(){return z({subtitleColor:Ct,subtitleSize:_t,subtitleThickness:Mt,subtitleOutlineThickness:Wt,subtitleOutlineColor:Nt,subtitleBackgroundOpacity:Jt,subtitleBackgroundColor:Kt,subtitleFontFamily:$t,subtitleCustomStyles:an})}),[Ct,_t,Mt,Wt,Nt,Jt,Kt,$t,an]);Object(f.useEffect)((function(){var e=!1,n=setTimeout(Object(s.a)(b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,t.requestPermission(O);case 5:return n.t0=D,n.next=8,t.deckNames(O);case 8:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=G,n.next=13,t.modelNames(O);case 13:n.t3=n.sent,(0,n.t2)(n.t3),w(void 0),n.next=26;break;case 18:if(n.prev=18,n.t4=n.catch(0),!e){n.next=22;break}return n.abrupt("return");case 22:console.error(n.t4),D(void 0),G(void 0),n.t4 instanceof Error?w(n.t4.message):"string"===typeof n.t4?w(n.t4):w(String(n.t4));case 26:case"end":return n.stop()}}),n,null,[[0,18]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,O,_]),Object(f.useEffect)((function(){if(W&&!C){var e=!1;return function(){n.apply(this,arguments)}(),function(){e=!0}}function n(){return(n=Object(s.a)(b.a.mark((function n(){return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=Je,n.t1=[""],n.t2=r.a,n.next=8,t.modelFieldNames(W,O);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),w(void 0),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),Je(void 0),n.t6 instanceof Error?w(n.t6.message):"string"===typeof n.t6?w(n.t6):w(String(n.t6));case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,W,O,C,_]);var Ti=Object(f.useCallback)((function(){u({ankiConnectUrl:O,deck:M,noteType:W,sentenceField:Y,definitionField:ee,audioField:ie,imageField:ue,wordField:he,sourceField:ke,urlField:we,tags:Ne.filter((function(e){return""!==e})),subtitleSize:Number(_t),subtitleColor:Ct,subtitleThickness:Mt,subtitleOutlineThickness:Number(Wt),subtitleOutlineColor:Nt,subtitleBackgroundColor:Kt,subtitleBackgroundOpacity:Number(Jt),subtitleFontFamily:$t,subtitlePreview:On,subtitleCustomStyles:an,preCacheSubtitleDom:bn,imageBasedSubtitleScaleFactor:pn,customAnkiFields:Pe,preferMp3:Ve,themeType:Cn,audioPaddingStart:Ze,audioPaddingEnd:rt,maxImageWidth:ut,maxImageHeight:ft,surroundingSubtitlesCountRadius:gt,surroundingSubtitlesTimeRadius:Ot,copyToClipboardOnMine:_n,autoPausePreference:Mn,keyBindSet:Nn,rememberSubtitleOffset:Wn,autoCopyCurrentSubtitle:Jn,miningHistoryStorageLimit:Kn,subtitleRegexFilter:$n,subtitleRegexFilterTextReplacement:aa,language:oa})}),[u,O,M,W,Y,ee,ie,ue,he,ke,we,Pe,Ne,Ve,_t,Ct,Mt,Wt,Nt,Kt,Jt,$t,On,an,bn,pn,Cn,Ze,rt,ut,ft,gt,Ot,_n,Mn,Nn,Wn,Jn,Kn,$n,aa,oa]),Fi=Object.keys(Pe).map((function(e){return Object(pe.jsx)(gi,{label:"".concat(e," Field"),value:Pe[e],selections:Xe,onChange:function(t){return Ja(e,t.target.value)},onSelectionChange:function(t){return Ja(e,t.target.value)},onRemoval:function(){return Qa(e)},removable:!0},e)}));Object(f.useEffect)((function(){o&&setTimeout((function(){var e;return null===(e=document.getElementById(o))||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})}),0)}),[o]);var _i=function(e){try{return new RegExp(e.trim()),!0}catch(t){return!1}}($n),Pi="".concat(window.location.protocol,"//").concat(window.location.hostname);return Object(pe.jsx)(h.a.Fragment,{children:Object(pe.jsxs)(Ce.a,{open:a,maxWidth:"xs",fullWidth:!0,onClose:Ti,children:[Object(pe.jsx)(qa.a,{children:g("settings.title")}),Object(pe.jsx)(Ie.a,{children:Object(pe.jsxs)(We.a,{container:!0,direction:"column",spacing:3,children:[Object(pe.jsxs)(We.a,{item:!0,id:"anki-settings",children:[Object(pe.jsx)(ti.a,{children:g("settings.anki")}),Object(pe.jsxs)($a.a,{className:d.root,children:[Object(pe.jsx)(me.a,{label:g("settings.ankiConnectUrl"),value:O,error:Boolean(C),helperText:C,color:"secondary",onChange:ua,InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:Object(pe.jsx)(Ue.a,{onClick:la,children:Object(pe.jsx)(ci.a,{})})})}}),Object(pe.jsx)(ei.a,{children:Object(pe.jsx)(p.a,{i18nKey:"settings.corsHelperText",values:{origin:Pi},components:[Object(pe.jsx)(gn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"})]})}),Object(pe.jsx)(gi,{label:g("settings.deck"),value:M,selections:N,onChange:da,onSelectionChange:ba}),Object(pe.jsx)(gi,{label:g("settings.noteType"),value:W,selections:q,onChange:fa,onSelectionChange:ha}),Object(pe.jsx)(gi,{label:g("settings.sentenceField"),value:Y,selections:Xe,onChange:va,onSelectionChange:pa}),Object(pe.jsx)(gi,{label:g("settings.definitionField"),value:ee,selections:Xe,onChange:ga,onSelectionChange:ja}),Object(pe.jsx)(gi,{label:g("settings.wordField"),value:he,selections:Xe,onChange:xa,onSelectionChange:Sa}),Object(pe.jsx)(gi,{label:g("settings.audioField"),value:ie,selections:Xe,onChange:ma,onSelectionChange:ka}),Object(pe.jsx)(gi,{label:g("settings.imageField"),value:ue,selections:Xe,onChange:Oa,onSelectionChange:ya}),Object(pe.jsx)(gi,{label:g("settings.sourceField"),value:ke,selections:Xe,onChange:Ca,onSelectionChange:wa}),Object(pe.jsx)(gi,{label:g("settings.urlField"),value:we,selections:Xe,onChange:Ta,onSelectionChange:Fa}),Fi,Object(pe.jsx)(yi,{onAddCustomField:Xa}),Object(pe.jsx)(Oe,{label:g("settings.tags"),helperText:g("settings.tagsHelperText"),fullWidth:!0,color:"secondary",tags:Ne,onTagsChange:ni})]})]}),Object(pe.jsxs)(We.a,{item:!0,id:"mining-settings",children:[Object(pe.jsx)(ti.a,{children:g("settings.mining")}),Object(pe.jsxs)($a.a,{className:d.root,children:[Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(bi.a,{checked:Ve,onChange:ii}),label:g("settings.mp3Preference"),labelPlacement:"start",className:d.switchLabel}),Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(bi.a,{checked:_n,onChange:oi}),label:g("settings.copyOnMine"),labelPlacement:"start",className:d.switchLabel}),Object(pe.jsx)(me.a,{type:"number",label:g("settings.audioPaddingStart"),fullWidth:!0,value:Ze,color:"secondary",onChange:_a,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:"ms"})}}),Object(pe.jsx)(me.a,{type:"number",label:g("settings.audioPaddingEnd"),fullWidth:!0,value:rt,color:"secondary",onChange:Pa,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:"ms"})}}),Object(pe.jsx)(me.a,{type:"number",label:g("settings.maxImageWidth"),fullWidth:!0,value:ut,color:"secondary",onChange:Ea,inputProps:{min:0,step:1}}),Object(pe.jsx)(me.a,{type:"number",label:g("settings.maxImageHeight"),fullWidth:!0,value:ft,color:"secondary",onChange:Ra,inputProps:{min:0,step:1}}),Object(pe.jsx)(me.a,{type:"number",label:g("settings.surroundingSubtitlesCountRadius"),fullWidth:!0,value:gt,color:"secondary",onChange:Ma,inputProps:{min:1,step:1}}),Object(pe.jsx)(me.a,{type:"number",label:g("settings.surroundingSubtitlesTimeRadius"),fullWidth:!0,value:Ot,color:"secondary",onChange:Aa,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(pe.jsx)(ze.a,{position:"end",children:"ms"})}}),Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(bi.a,{checked:bn,onChange:Ka}),label:Object(pe.jsxs)(We.a,{container:!0,direction:"row",spacing:1,children:[Object(pe.jsx)(We.a,{item:!0,className:d.verticallyCentered,children:g("settings.preCacheSubtitleDom")}),Object(pe.jsx)(We.a,{item:!0,className:d.verticallyCentered,children:Object(pe.jsx)(tt.a,{title:g("settings.preCacheSubtitleDomHelperText"),placement:"top",children:Object(pe.jsx)(Ya.a,{})})})]}),labelPlacement:"start",className:d.switchLabel})]})]}),Object(pe.jsxs)(We.a,{item:!0,id:"misc-settings",children:[Object(pe.jsx)(ti.a,{children:g("settings.misc")}),Object(pe.jsxs)($a.a,{className:d.root,children:[Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(bi.a,{checked:Wn,onChange:di}),label:g("settings.rememberSubtitleOffset"),labelPlacement:"start",className:d.switchLabel}),Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(bi.a,{checked:Jn,onChange:hi}),label:g("settings.autoCopy"),labelPlacement:"start",className:d.switchLabel}),Object(pe.jsx)(me.a,{type:"number",label:g("settings.miningHistoryStorageLimit"),fullWidth:!0,value:Kn,color:"secondary",onChange:pi,inputProps:{min:0,step:1}}),Object(pe.jsx)(me.a,{label:g("settings.subtitleRegexFilter"),fullWidth:!0,value:$n,color:"secondary",error:!_i,helperText:_i?void 0:"Invalid regular expression",onChange:ji}),Object(pe.jsx)(me.a,{label:g("settings.subtitleRegexFilterTextReplacement"),fullWidth:!0,value:aa,color:"secondary",onChange:mi}),Object(pe.jsx)(me.a,{select:!0,label:g("settings.language"),value:oa,color:"secondary",onChange:ki,children:de.map((function(e){return Object(pe.jsx)(ai.a,{value:e,children:e},e)}))})]})]}),Object(pe.jsxs)(We.a,{item:!0,id:"auto-pause-settings",children:[Object(pe.jsxs)(We.a,{container:!0,direction:"row",spacing:1,children:[Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(ti.a,{children:g("settings.autoPausePreference")})}),Object(pe.jsx)(We.a,{item:!0,children:Object(pe.jsx)(tt.a,{title:g("settings.autoPausePreferenceHelperText"),placement:"top",children:Object(pe.jsx)(Ya.a,{fontSize:"small"})})})]}),Object(pe.jsxs)(fi.a,{row:!0,children:[Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(si.a,{checked:Mn===se.atStart,value:se.atStart,onChange:ui}),label:g("settings.autoPauseAtSubtitleStart")}),Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(si.a,{checked:Mn===se.atEnd,value:se.atEnd,onChange:ui}),label:g("settings.autoPauseAtSubtitleEnd")})]})]}),Object(pe.jsxs)(We.a,{item:!0,id:"video-subtitle-appearance",children:[Object(pe.jsx)(ti.a,{children:g("settings.subtitleAppearance")}),Object(pe.jsxs)($a.a,{className:d.root,children:[Object(pe.jsx)("div",{className:d.subtitleSetting,children:Object(pe.jsx)(me.a,{type:"color",label:g("settings.subtitleColor"),fullWidth:!0,value:Ct,color:"secondary",onChange:Ba})}),Object(pe.jsx)("div",{className:d.subtitleSetting,children:Object(pe.jsx)(me.a,{type:"number",label:g("settings.subtitleSize"),fullWidth:!0,value:_t,color:"secondary",onChange:Ia,inputProps:{min:1,step:1}})}),Object(pe.jsxs)("div",{children:[Object(pe.jsx)(nt.a,{variant:"subtitle2",color:"textSecondary",children:g("settings.subtitleThickness")}),Object(pe.jsx)($e.a,{color:"secondary",value:Mt,onChange:za,min:100,max:900,step:100,marks:!0,valueLabelDisplay:"auto"})]}),Object(pe.jsx)("div",{className:d.subtitleSetting,children:Object(pe.jsx)(me.a,{type:"color",label:g("settings.subtitleOutlineColor"),fullWidth:!0,value:Nt,color:"secondary",onChange:Na})}),Object(pe.jsx)("div",{className:d.subtitleSetting,children:Object(pe.jsx)(me.a,{type:"number",label:g("settings.subtitleOutlineThickness"),helperText:g("settings.subtitleOutlineThicknessHelperText"),fullWidth:!0,value:Wt,onChange:Da,inputProps:{min:0,step:.1},color:"secondary"})}),Object(pe.jsx)("div",{className:d.subtitleSetting,children:Object(pe.jsx)(me.a,{type:"color",label:g("settings.subtitleBackgroundColor"),fullWidth:!0,value:Kt,color:"secondary",onChange:La})}),Object(pe.jsx)("div",{className:d.subtitleSetting,children:Object(pe.jsx)(me.a,{type:"number",label:g("settings.subtitleBackgroundOpacity"),fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:Jt,color:"secondary",onChange:Ha})}),Object(pe.jsx)("div",{className:d.subtitleSetting,children:Object(pe.jsx)(me.a,{type:"text",label:g("settings.subtitleFontFamily"),placeholder:"Inherited",fullWidth:!0,value:$t,color:"secondary",onChange:Wa})}),Object(pe.jsx)("div",{className:d.subtitleSetting,children:Object(pe.jsx)(me.a,{type:"number",label:g("settings.imageBasedSubtitleScaleFactor"),placeholder:"Inherited",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:pn,color:"secondary",onChange:Ga})}),an.map((function(e,t){return Object(pe.jsx)(Si,{customStyle:e,onCustomStyle:function(e){rn((function(n){var a=Object(r.a)(n);return a[t]=Object(c.a)({},e),a}))},onDelete:function(){rn((function(e){for(var n=[],a=0;a<e.length;++a)a!==t&&n.push(e[a]);return n}))}},t)})),Object(pe.jsx)(xi,{styleKey:cn,onStyleKey:un,onAddCustomStyle:Va}),Object(pe.jsx)("div",{className:d.subtitlePreview,children:Object(pe.jsx)("input",{value:On,className:d.subtitlePreviewInput,onChange:Ua,style:wi})})]})]}),Object(pe.jsxs)(We.a,{item:!0,id:"theme-settings",children:[Object(pe.jsx)(ti.a,{children:g("settings.theme")}),Object(pe.jsxs)("div",{children:[Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(si.a,{checked:"light"===Cn,value:"light",onChange:ri}),label:g("settings.themeLight")}),Object(pe.jsx)(Za.a,{control:Object(pe.jsx)(si.a,{checked:"dark"===Cn,value:"dark",onChange:ri}),label:g("settings.themeDark")})]})]}),Object(pe.jsxs)(We.a,{item:!0,id:"keyboard-shortcuts",children:[Object(pe.jsx)(ti.a,{children:g("settings.keyboardShortcuts")}),Object(pe.jsx)($a.a,{children:Object.keys(j).map((function(e){var t,a=e,i=j[a];return Object(pe.jsx)(Oi,{label:i.label,keys:n.installed&&i.extensionOverridden?null!==(t=n.extensionCommands[a])&&void 0!==t?t:"":Nn[a].keys,extensionOverridden:n.installed&&i.extensionOverridden,onKeysChange:function(e){return li(e,a)},onOpenExtensionShortcuts:n.openShortcuts},e)}))})]})]})}),Object(pe.jsx)(Be.a,{children:Object(pe.jsx)(Re.a,{onClick:Ti,children:g("action.ok")})})]})})}var Ti=se.atEnd,Fi={togglePlay:{keys:"space"},toggleAutoPause:{keys:di.isMacOs?"\u21e7+P":"shift+P"},toggleCondensedPlayback:{keys:di.isMacOs?"\u21e7+O":"shift+O"},toggleSubtitles:{keys:"S"},toggleVideoSubtitleTrack1:{keys:"1"},toggleVideoSubtitleTrack2:{keys:"2"},toggleAsbplayerSubtitleTrack1:{keys:"W+1"},toggleAsbplayerSubtitleTrack2:{keys:"W+2"},seekBackward:{keys:"A"},seekForward:{keys:"D"},seekToPreviousSubtitle:{keys:"left"},seekToNextSubtitle:{keys:"right"},seekToBeginningOfCurrentSubtitle:{keys:"down"},adjustOffsetToPreviousSubtitle:{keys:di.isMacOs?"\u21e7+left":"ctrl+left"},adjustOffsetToNextSubtitle:{keys:di.isMacOs?"\u21e7+right":"ctrl+right"},decreaseOffset:{keys:di.isMacOs?"\u21e7+\u2303+right":"ctrl+shift+right"},increaseOffset:{keys:di.isMacOs?"\u21e7+\u2303+left":"ctrl+shift+left"},resetOffset:{keys:di.isMacOs?"\u21e7+\u2303+down":"ctrl+shift+down"},copySubtitle:{keys:di.isMacOs?"\u21e7+\u2303+Z":"ctrl+shift+Z"},ankiExport:{keys:di.isMacOs?"\u21e7+\u2303+X":"ctrl+shift+X"},updateLastCard:{keys:di.isMacOs?"\u21e7+\u2303+U":"ctrl+shift+U"},takeScreenshot:{keys:di.isMacOs?"\u21e7+\u2303+V":"ctrl+shift+V"},decreasePlaybackRate:{keys:di.isMacOs?"\u21e7+\u2303+[":"ctrl+shift+["},increasePlaybackRate:{keys:di.isMacOs?"\u21e7+\u2303+]":"ctrl+shift+]"}},_i="ankiConnectUrl",Pi="deck",Ei="noteType",Ri="sentenceField",Mi="definitionField",Ai="audioField",Bi="imageField",Ii="wordField",Ni="sourceField",Di="urlField",Li="customAnkiFields",Hi="tags",Wi="subtitleSize",Ui="subtitleColor",zi="subtitleThickness",Vi="subtitleOutlineThickness",Ki="subtitleOutlineColor",qi="subtitleBackgroundColor",Gi="subtitleBackgroundOpacity",Xi="subtitleFontFamily",Ji="subtitlePreview",Yi="subtitleCustomStyles",Qi="preCacheSubtitleDom2",Zi="imageBasedSubtitleScaleFactor",$i="audioPaddingStart",er="audioPaddingEnd",tr="maxImageWidth",nr="maxImageHeight",ar="surroundingSubtitlesCountRadius",ir="surroundingSubtitlesTimeRadius",rr="preferMp3",sr="themeType",or="copyToClipboardOnMine",cr="autoPausePreference",ur="keyBindSet",lr="rememberSubtitleOffset",dr="autoCopyCurrentSubtitle",br="subtitleRegexFilter",fr="subtitleRegexFilterTextReplacement",hr="miningHistoryStorageLimit",vr="i18nextLng",pr=function(){function e(){Object(F.a)(this,e),this._tags=void 0,this._keyBindSet=void 0,this._storage=new ca,this._tags=this.tags,this._keyBindSet=this.keyBindSet}return Object(_.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,sourceField:this.sourceField,subtitleSize:this.subtitleSize,subtitleThickness:this.subtitleThickness,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,subtitlePreview:this.subtitlePreview,subtitleCustomStyles:this.subtitleCustomStyles,preCacheSubtitleDom:this.preCacheSubtitleDom,imageBasedSubtitleScaleFactor:this.imageBasedSubtitleScaleFactor,preferMp3:this.preferMp3,themeType:this.themeType,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius,copyToClipboardOnMine:this.copyToClipboardOnMine,autoPausePreference:this.autoPausePreference,keyBindSet:this.keyBindSet,rememberSubtitleOffset:this.rememberSubtitleOffset,autoCopyCurrentSubtitle:this.autoCopyCurrentSubtitle,subtitleRegexFilter:this.subtitleRegexFilter,subtitleRegexFilterTextReplacement:this.subtitleRegexFilterTextReplacement,miningHistoryStorageLimit:this.miningHistoryStorageLimit,language:this.language}},set:function(e){this.ankiConnectUrl=e.ankiConnectUrl,this.deck=e.deck,this.noteType=e.noteType,this.sentenceField=e.sentenceField,this.definitionField=e.definitionField,this.audioField=e.audioField,this.imageField=e.imageField,this.wordField=e.wordField,this.sourceField=e.sourceField,this.urlField=e.urlField,this.tags=e.tags,this.subtitleSize=e.subtitleSize,this.subtitleThickness=e.subtitleThickness,this.subtitleColor=e.subtitleColor,this.subtitleOutlineThickness=e.subtitleOutlineThickness,this.subtitleOutlineColor=e.subtitleOutlineColor,this.subtitleBackgroundColor=e.subtitleBackgroundColor,this.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,this.subtitleFontFamily=e.subtitleFontFamily,this.subtitlePreview=e.subtitlePreview,this.subtitleCustomStyles=e.subtitleCustomStyles,this.preCacheSubtitleDom=e.preCacheSubtitleDom,this.imageBasedSubtitleScaleFactor=e.imageBasedSubtitleScaleFactor,this.customAnkiFields=e.customAnkiFields,this.preferMp3=e.preferMp3,this.themeType=e.themeType,this.audioPaddingStart=e.audioPaddingStart,this.audioPaddingEnd=e.audioPaddingEnd,this.maxImageWidth=e.maxImageWidth,this.maxImageHeight=e.maxImageHeight,this.surroundingSubtitlesCountRadius=e.surroundingSubtitlesCountRadius,this.surroundingSubtitlesTimeRadius=e.surroundingSubtitlesTimeRadius,this.copyToClipboardOnMine=e.copyToClipboardOnMine,this.autoPausePreference=e.autoPausePreference,this.keyBindSet=e.keyBindSet,this.rememberSubtitleOffset=e.rememberSubtitleOffset,this.autoCopyCurrentSubtitle=e.autoCopyCurrentSubtitle,this.miningHistoryStorageLimit=e.miningHistoryStorageLimit,this.subtitleRegexFilter=e.subtitleRegexFilter,this.subtitleRegexFilterTextReplacement=e.subtitleRegexFilterTextReplacement,this.language=e.language}},{key:"subtitleSettings",get:function(){return{subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleThickness:this.subtitleThickness,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,imageBasedSubtitleScaleFactor:this.imageBasedSubtitleScaleFactor,subtitleCustomStyles:this.subtitleCustomStyles}}},{key:"ankiSettings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,sourceField:this.sourceField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,preferMp3:this.preferMp3,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius}}},{key:"miscSettings",get:function(){return{themeType:this.themeType,copyToClipboardOnMine:this.copyToClipboardOnMine,autoPausePreference:this.autoPausePreference,keyBindSet:this.keyBindSet,rememberSubtitleOffset:this.rememberSubtitleOffset,autoCopyCurrentSubtitle:this.autoCopyCurrentSubtitle,subtitleRegexFilter:this.subtitleRegexFilter,subtitleRegexFilterTextReplacement:this.subtitleRegexFilterTextReplacement,miningHistoryStorageLimit:this.miningHistoryStorageLimit,language:this.language,preCacheSubtitleDom:this.preCacheSubtitleDom}}},{key:"_getNumberItem",value:function(e,t){var n=this._storage.get(e);return null===n?t:Number(n)}},{key:"_setOptionalItem",value:function(e,t){"undefined"===typeof t?this._storage.delete(e):this._storage.set(e,t)}},{key:"ankiConnectUrl",get:function(){return this._storage.get(_i)||"http://127.0.0.1:8765"},set:function(e){this._storage.set(_i,e)}},{key:"deck",get:function(){var e;return null!==(e=this._storage.get(Pi))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Pi,e)}},{key:"noteType",get:function(){var e;return null!==(e=this._storage.get(Ei))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ei,e)}},{key:"sentenceField",get:function(){var e;return null!==(e=this._storage.get(Ri))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ri,e)}},{key:"definitionField",get:function(){var e;return null!==(e=this._storage.get(Mi))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Mi,e)}},{key:"audioField",get:function(){var e;return null!==(e=this._storage.get(Ai))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ai,e)}},{key:"imageField",get:function(){var e;return null!==(e=this._storage.get(Bi))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Bi,e)}},{key:"wordField",get:function(){var e;return null!==(e=this._storage.get(Ii))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ii,e)}},{key:"sourceField",get:function(){var e;return null!==(e=this._storage.get(Ni))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ni,e)}},{key:"urlField",get:function(){var e;return null!==(e=this._storage.get(Di))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Di,e)}},{key:"customAnkiFields",get:function(){var e=this._storage.get(Li);return e?JSON.parse(e):{}},set:function(e){this._storage.set(Li,JSON.stringify(e))}},{key:"tags",get:function(){if("undefined"!==typeof this._tags)return this._tags;var e=this._storage.get(Hi);return e?(this._tags=JSON.parse(e),this._tags):[]},set:function(e){this._storage.set(Hi,JSON.stringify(e)),this._tags=void 0}},{key:"subtitleColor",get:function(){return this._storage.get(Ui)||"#ffffff"},set:function(e){this._storage.set(Ui,e)}},{key:"subtitleSize",get:function(){return this._getNumberItem(Wi,36)},set:function(e){this._storage.set(Wi,String(e))}},{key:"subtitleThickness",get:function(){return this._getNumberItem(zi,700)},set:function(e){this._storage.set(zi,String(e))}},{key:"subtitleOutlineColor",get:function(){return this._storage.get(Ki)||"#000000"},set:function(e){this._storage.set(Ki,e)}},{key:"subtitleOutlineThickness",get:function(){return this._getNumberItem(Vi,1)},set:function(e){this._storage.set(Vi,String(e))}},{key:"subtitleBackgroundColor",get:function(){return this._storage.get(qi)||"#000000"},set:function(e){this._storage.set(qi,e)}},{key:"subtitleBackgroundOpacity",get:function(){return this._getNumberItem(Gi,.5)},set:function(e){this._storage.set(Gi,String(e))}},{key:"subtitleFontFamily",get:function(){return this._storage.get(Xi)||""},set:function(e){this._storage.set(Xi,e)}},{key:"subtitlePreview",get:function(){return this._storage.get(Ji)||"\u30a2\u3042\u5b89"},set:function(e){this._storage.set(Ji,e)}},{key:"subtitleCustomStyles",get:function(){var e=this._storage.get(Yi);return null===e?[]:JSON.parse(e)},set:function(e){this._storage.set(Yi,JSON.stringify(e))}},{key:"preCacheSubtitleDom",get:function(){return"true"===this._storage.get(Qi)||true},set:function(e){this._storage.set(Qi,String(e))}},{key:"imageBasedSubtitleScaleFactor",get:function(){return this._getNumberItem(Zi,1)},set:function(e){this._storage.set(Zi,String(e))}},{key:"preferMp3",get:function(){var e=this._storage.get(rr);return null===e||"true"===e},set:function(e){this._storage.set(rr,String(e))}},{key:"themeType",get:function(){var e=this._storage.get(sr);return null===e?"dark":e},set:function(e){this._storage.set(sr,e)}},{key:"audioPaddingStart",get:function(){var e=this._storage.get($i);return e?Number(e):0},set:function(e){this._storage.set($i,String(e))}},{key:"audioPaddingEnd",get:function(){return this._getNumberItem(er,500)},set:function(e){this._storage.set(er,String(e))}},{key:"maxImageWidth",get:function(){var e=this._storage.get(tr);return e?Number(e):0},set:function(e){this._storage.set(tr,String(e))}},{key:"maxImageHeight",get:function(){return this._getNumberItem(nr,0)},set:function(e){this._storage.set(nr,String(e))}},{key:"surroundingSubtitlesCountRadius",get:function(){return this._getNumberItem(ar,2)},set:function(e){this._storage.set(ar,String(e))}},{key:"surroundingSubtitlesTimeRadius",get:function(){return this._getNumberItem(ir,1e4)},set:function(e){this._storage.set(ir,String(e))}},{key:"copyToClipboardOnMine",get:function(){return"true"===this._storage.get(or)||!1},set:function(e){this._storage.set(or,String(e))}},{key:"autoPausePreference",get:function(){return this._getNumberItem(cr,Ti)},set:function(e){this._storage.set(cr,String(e))}},{key:"keyBindSet",get:function(){if(void 0!==this._keyBindSet)return this._keyBindSet;var e=this._storage.get(ur);if(null===e)return this._keyBindSet=Fi,Fi;for(var t=JSON.parse(e),n=0,a=Object.keys(Fi);n<a.length;n++){var i=a[n];void 0===t[i]&&(t[i]=Fi[i])}return this._keyBindSet=t,t},set:function(e){this._storage.set(ur,JSON.stringify(e)),this._keyBindSet=void 0}},{key:"rememberSubtitleOffset",get:function(){return"true"===this._storage.get(lr)||!1},set:function(e){this._storage.set(lr,String(e))}},{key:"autoCopyCurrentSubtitle",get:function(){return"true"===this._storage.get(dr)||!1},set:function(e){this._storage.set(dr,String(e))}},{key:"subtitleRegexFilter",get:function(){var e;return null!==(e=this._storage.get(br))&&void 0!==e?e:""},set:function(e){this._storage.set(br,e)}},{key:"subtitleRegexFilterTextReplacement",get:function(){var e;return null!==(e=this._storage.get(fr))&&void 0!==e?e:""},set:function(e){this._storage.set(fr,e)}},{key:"miningHistoryStorageLimit",get:function(){return this._getNumberItem(hr,25)},set:function(e){this._storage.set(hr,String(e))}},{key:"language",get:function(){var e;return null!==(e=this._storage.get(vr))&&void 0!==e?e:"en"},set:function(e){this._storage.set(vr,e)}}]),e}(),gr=function(){function e(t){Object(F.a)(this,e),this.keyBindSet=void 0,this.keyBindSet=t}return Object(_.a)(e,[{key:"bindCopy",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.keyBindSet.copySubtitle.keys;if(!i)return function(){};var r=this.copyHandler(e,t,n);return this._bind(i,a,r)}},{key:"copyHandler",value:function(e,t,n){return function(a){if(!t()){var i=n();i&&e(a,i)}}}},{key:"bindAnkiExport",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.ankiExport.keys;if(!a)return function(){};var i=this.ankiExportHandler(e,t);return this._bind(a,n,i)}},{key:"ankiExportHandler",value:function(e,t){return function(n){t()||e(n)}}},{key:"bindUpdateLastCard",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.updateLastCard.keys;if(!a)return function(){};var i=this.updateLastCardHandler(e,t);return this._bind(a,n,i)}},{key:"updateLastCardHandler",value:function(e,t){return function(n){t()||e(n)}}},{key:"bindTakeScreenshot",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.takeScreenshot.keys;if(!a)return function(){};var i=this.updateLastCardHandler(e,t);return this._bind(a,n,i)}},{key:"takeScreenshotHandler",value:function(e,t){return function(n){t()||e(n)}}},{key:"bindSeekToSubtitle",value:function(e,t,n,a){var i,r,s=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=function(i,r){if(!t()){var o=a();if(o&&0!==o.length){var c=s._adjacentSubtitle(r,n(),o);null!==c&&c.start>=0&&c.end>=0&&e(i,c)}}},u=this.keyBindSet.seekToPreviousSubtitle.keys,l=this.keyBindSet.seekToNextSubtitle.keys,d=function(e){return c(e,!1)},b=function(e){return c(e,!0)};return u&&(i=this._bind(u,o,d)),l&&(r=this._bind(l,o,b)),function(){var e,t;null===(e=i)||void 0===e||e(),null===(t=r)||void 0===t||t()}}},{key:"bindSeekToBeginningOfCurrentSubtitle",value:function(e,t,n,a){var i=this,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=this.keyBindSet.seekToBeginningOfCurrentSubtitle.keys;if(!s)return function(){};var o=function(r){if(!t()){var s=a();if(s&&0!==s.length){var o=i._currentSubtitle(n(),s);void 0!==o&&o.start>=0&&o.end>=0&&e(r,o)}}};return this._bind(s,r,o)}},{key:"_currentSubtitle",value:function(e,t){for(var n,a=e,i=Number.MAX_SAFE_INTEGER,r=0;r<t.length;++r){var s=t[r];if(!(s.start<0||s.end<0)){var o=a-s.start;a>=s.start&&a<s.end&&o<i&&(n=s,i=o)}}return n}},{key:"bindSeekBackwardOrForward",value:function(e,t){var n,a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=function(n,a){t()||e(n,a)},s=this.keyBindSet.seekBackward.keys,o=this.keyBindSet.seekForward.keys,c=function(e){return r(e,!1)},u=function(e){return r(e,!0)};return s&&(n=this._bind(s,i,c)),o&&(a=this._bind(o,i,u)),function(){var e,t;null===(e=n)||void 0===e||e(),null===(t=a)||void 0===t||t()}}},{key:"bindOffsetToSubtitle",value:function(e,t,n,a){var i,r,s=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=function(i,r){if(!t()){var o=a();if(o&&0!==o.length){var c=n(),u=s._adjacentSubtitle(r,c,o);if(null!==u){var l=u.originalStart;e(i,c-l)}}}},u=this.keyBindSet.adjustOffsetToPreviousSubtitle.keys,l=this.keyBindSet.adjustOffsetToNextSubtitle.keys,d=function(e){return c(e,!1)},b=function(e){return c(e,!0)};return u&&(i=this._bind(u,o,d)),l&&(r=this._bind(l,o,b)),function(){var e,t;null===(e=i)||void 0===e||e(),null===(t=r)||void 0===t||t()}}},{key:"_adjacentSubtitle",value:function(e,t,n){for(var a=t,i=-1,r=Number.MAX_SAFE_INTEGER,s=0;s<n.length;++s){var o=n[s],c=e?o.start-a:a-o.start;r<=c||(e&&a<o.start?(r=c,i=s):!e&&a>o.start&&(r=c,i=a<o.end?Math.max(0,s-1):s))}return-1!==i?n[i]:null}},{key:"bindAdjustOffset",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=function(a,i){if(!t()){var r=n();if(r&&0!==r.length){var s=r[0].start-r[0].originalStart;e(a,s+(i?100:-100))}}},r=this.keyBindSet.decreaseOffset.keys,s=this.keyBindSet.increaseOffset.keys,o=function(e){return i(e,!1)},c=function(e){return i(e,!0)},u=this._bind(r,a,o),l=this._bind(s,a,c);return function(){u(),l()}}},{key:"bindResetOffet",value:function(e,t,n){var a=this.keyBindSet.resetOffset.keys;if(!a)return function(){};return this._bind(a,null!==n&&void 0!==n&&n,(function(n){t()||e(n)}))}},{key:"bindAdjustPlaybackRate",value:function(e,t){var n,a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=function(n,a){t()||e(n,a)},s=this.keyBindSet.increasePlaybackRate.keys,o=this.keyBindSet.decreasePlaybackRate.keys,c=function(e){return r(e,!1)},u=function(e){return r(e,!0)};return o&&(n=this._bind(o,i,c)),s&&(a=this._bind(s,i,u)),function(){var e,t;null===(e=n)||void 0===e||e(),null===(t=a)||void 0===t||t()}}},{key:"bindToggleSubtitles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleSubtitles.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return this._bind(a,n,i)}},{key:"bindToggleSubtitleTrackInVideo",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[this.keyBindSet.toggleVideoSubtitleTrack1.keys,this.keyBindSet.toggleVideoSubtitleTrack2.keys].filter((function(e){return e}));if(0===i.length)return function(){};for(var r=function(n,a){t()||e(n,a)},s=[],o=function(e){s.push(n._bind(i[e],a,(function(t){return r(t,e)})))},c=0;c<i.length;++c)o(c);return function(){for(var e=0;e<i.length;++e){(0,s[e])()}}}},{key:"bindToggleSubtitleTrackInList",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[this.keyBindSet.toggleAsbplayerSubtitleTrack1.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack2.keys].filter((function(e){return e}));if(0===i.length)return function(){};for(var r=function(n,a){t()||e(n,a)},s=[],o=function(e){var t=n._bind(i[e],a,(function(t){return r(t,e)}));s.push(t)},c=0;c<9;++c)o(c);return function(){for(var e=0;e<9;++e){(0,s[e])()}}}},{key:"bindPlay",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.togglePlay.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return this._bind(a,n,i)}},{key:"bindAutoPause",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleAutoPause.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return this._bind(a,n,i)}},{key:"bindCondensedPlayback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleCondensedPlayback.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return this._bind(a,n,i)}},{key:"_bind",value:function(e,t,n){var a=function(e){"keydown"===e.type?n(e):"keyup"===e.type&&(e.preventDefault(),e.stopImmediatePropagation())};return Object(li.a)(e,{capture:t,keydown:!0,keyup:!0},a),function(){return li.a.unbind(e,a)}}}]),e}(),jr=function(){function e(t){Object(F.a)(this,e),this.channel=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.currentTimeCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.closeCallbacks=void 0,this.subtitlesCallbacks=void 0,this.offsetCallbacks=void 0,this.playbackRateCallbacks=void 0,this.playModeCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.fullscreenToggleCallbacks=void 0,this.subtitleSettingsCallbacks=void 0,this.miscSettingsCallbacks=void 0,this.ankiSettingsCallbacks=void 0,this.alertCallbacks=void 0,this.copyCallbacks=void 0,this.channel=new BroadcastChannel(t),this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.fullscreenToggleCallbacks=[],this.subtitleSettingsCallbacks=[],this.miscSettingsCallbacks=[],this.ankiSettingsCallbacks=[],this.alertCallbacks=[],this.copyCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=e.data,r=Object(i.a)(n.readyCallbacks);try{for(r.s();!(t=r.n()).done;){(0,t.value)(a.duration,a.videoFileName)}}catch(ee){r.e(ee)}finally{r.f()}break;case"play":var s,o=Object(i.a)(n.playCallbacks);try{for(o.s();!(s=o.n()).done;){(0,s.value)()}}catch(ee){o.e(ee)}finally{o.f()}break;case"pause":var c,u=Object(i.a)(n.pauseCallbacks);try{for(u.s();!(c=u.n()).done;){(0,c.value)()}}catch(ee){u.e(ee)}finally{u.f()}break;case"currentTime":var l,d=e.data,b=Object(i.a)(n.currentTimeCallbacks);try{for(b.s();!(l=b.n()).done;){(0,l.value)(d.value)}}catch(ee){b.e(ee)}finally{b.f()}break;case"audioTrackSelected":var f,h=e.data,v=Object(i.a)(n.audioTrackSelectedCallbacks);try{for(v.s();!(f=v.n()).done;){(0,f.value)(h.id)}}catch(ee){v.e(ee)}finally{v.f()}break;case"close":var p,g=Object(i.a)(n.closeCallbacks);try{for(g.s();!(p=g.n()).done;){(0,p.value)()}}catch(ee){g.e(ee)}finally{g.f()}break;case"subtitles":var j,m=e.data,k=Object(i.a)(n.subtitlesCallbacks);try{for(k.s();!(j=k.n()).done;){(0,j.value)(m.value)}}catch(ee){k.e(ee)}finally{k.f()}break;case"offset":var O,y=e.data,x=Object(i.a)(n.offsetCallbacks);try{for(x.s();!(O=x.n()).done;){(0,O.value)(y.value)}}catch(ee){x.e(ee)}finally{x.f()}break;case"playbackRate":var S,C=e.data,w=Object(i.a)(n.playbackRateCallbacks);try{for(w.s();!(S=w.n()).done;){(0,S.value)(C.value)}}catch(ee){w.e(ee)}finally{w.f()}break;case"subtitleSettings":var T,F=e.data,_=Object(i.a)(n.subtitleSettingsCallbacks);try{for(_.s();!(T=_.n()).done;){(0,T.value)(F.value)}}catch(ee){_.e(ee)}finally{_.f()}break;case"playMode":var P,E=e.data,R=Object(i.a)(n.playModeCallbacks);try{for(R.s();!(P=R.n()).done;){(0,P.value)(E.playMode)}}catch(ee){R.e(ee)}finally{R.f()}break;case"hideSubtitlePlayerToggle":var M,A=e.data,B=Object(i.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(B.s();!(M=B.n()).done;){(0,M.value)(A.value)}}catch(ee){B.e(ee)}finally{B.f()}break;case"appBarToggle":var I,N=e.data,D=Object(i.a)(n.appBarToggleCallbacks);try{for(D.s();!(I=D.n()).done;){(0,I.value)(N.value)}}catch(ee){D.e(ee)}finally{D.f()}break;case"fullscreenToggle":var L,H=e.data,W=Object(i.a)(n.fullscreenToggleCallbacks);try{for(W.s();!(L=W.n()).done;){(0,L.value)(H.value)}}catch(ee){W.e(ee)}finally{W.f()}break;case"ankiSettings":var U,z=e.data,V=Object(i.a)(n.ankiSettingsCallbacks);try{for(V.s();!(U=V.n()).done;){(0,U.value)(z.value)}}catch(ee){V.e(ee)}finally{V.f()}break;case"miscSettings":var K,q=e.data,G=Object(i.a)(n.miscSettingsCallbacks);try{for(G.s();!(K=G.n()).done;){(0,K.value)(q.value)}}catch(ee){G.e(ee)}finally{G.f()}break;case"alert":var X,J=e.data,Y=Object(i.a)(n.alertCallbacks);try{for(Y.s();!(X=Y.n()).done;){(0,X.value)(J.message,J.severity)}}catch(ee){Y.e(ee)}finally{Y.f()}break;case"copy":var Q,Z=e.data,$=Object(i.a)(n.copyCallbacks);try{for($.s();!(Q=$.n()).done;){(0,Q.value)(Z.postMineAction)}}catch(ee){$.e(ee)}finally{$.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(_.a)(e,[{key:"currentTime",set:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"currentTime",value:e,echo:!0})}},{key:"onPlay",value:function(e){var t=this;return this.playCallbacks.push(e),function(){return t._remove(e,t.playCallbacks)}}},{key:"onPause",value:function(e){var t=this;return this.pauseCallbacks.push(e),function(){return t._remove(e,t.pauseCallbacks)}}},{key:"onCurrentTime",value:function(e){var t=this;return this.currentTimeCallbacks.push(e),function(){return t._remove(e,t.currentTimeCallbacks)}}},{key:"onAudioTrackSelected",value:function(e){var t=this;return this.audioTrackSelectedCallbacks.push(e),function(){return t._remove(e,t.audioTrackSelectedCallbacks)}}},{key:"onClose",value:function(e){var t=this;return this.closeCallbacks.push(e),function(){return t._remove(e,t.closeCallbacks)}}},{key:"onReady",value:function(e){var t=this;return this.readyCallbacks.push(e),function(){return t._remove(e,t.readyCallbacks)}}},{key:"onSubtitles",value:function(e){var t=this;return this.subtitlesCallbacks.push(e),function(){return t._remove(e,t.subtitlesCallbacks)}}},{key:"onOffset",value:function(e){var t=this;return this.offsetCallbacks.push(e),function(){return t._remove(e,t.offsetCallbacks)}}},{key:"onPlaybackRate",value:function(e){var t=this;return this.playbackRateCallbacks.push(e),function(){return t._remove(e,t.playbackRateCallbacks)}}},{key:"onPlayMode",value:function(e){var t=this;return this.playModeCallbacks.push(e),function(){return t._remove(e,t.playModeCallbacks)}}},{key:"onHideSubtitlePlayerToggle",value:function(e){var t=this;return this.hideSubtitlePlayerToggleCallbacks.push(e),function(){return t._remove(e,t.hideSubtitlePlayerToggleCallbacks)}}},{key:"onAppBarToggle",value:function(e){var t=this;return this.appBarToggleCallbacks.push(e),function(){return t._remove(e,t.appBarToggleCallbacks)}}},{key:"onFullscreenToggle",value:function(e){var t=this;return this.fullscreenToggleCallbacks.push(e),function(){return t._remove(e,t.fullscreenToggleCallbacks)}}},{key:"onSubtitleSettings",value:function(e){var t=this;return this.subtitleSettingsCallbacks.push(e),function(){return t._remove(e,t.subtitleSettingsCallbacks)}}},{key:"onMiscSettings",value:function(e){var t=this;return this.miscSettingsCallbacks.push(e),function(){return t._remove(e,t.miscSettingsCallbacks)}}},{key:"onAnkiSettings",value:function(e){var t=this;return this.ankiSettingsCallbacks.push(e),function(){return t._remove(e,t.ankiSettingsCallbacks)}}},{key:"onAlert",value:function(e){var t=this;return this.alertCallbacks.push(e),function(){return t._remove(e,t.alertCallbacks)}}},{key:"onCopy",value:function(e){var t=this;return this.copyCallbacks.push(e),function(){return t._remove(e,t.copyCallbacks)}}},{key:"ready",value:function(e,t,n,a,i){var r,s={command:"ready",duration:e,paused:t,currentTime:0,audioTracks:a,selectedAudioTrack:i,playbackRate:n};null===(r=this.channel)||void 0===r||r.postMessage(s)}},{key:"readyState",value:function(e){var t,n={command:"readyState",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"play",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){var t,n={command:"audioTrackSelected",id:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"offset",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n={command:"offset",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}))},{key:"playbackRate",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n={command:"playbackRate",value:e,echo:!0};null===(t=this.channel)||void 0===t||t.postMessage(n)}))},{key:"popOutToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e,t,n,a){var i,r={command:"copy",subtitle:e,surroundingSubtitles:t,postMineAction:a,mediaTimestamp:n};null===(i=this.channel)||void 0===i||i.postMessage(r)}},{key:"playMode",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"playMode",playMode:e})}))},{key:"hideSubtitlePlayerToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"hideSubtitlePlayerToggle"})}},{key:"appBarToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"appBarToggle"})}},{key:"fullscreenToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"fullscreenToggle"})}},{key:"toggleSubtitleTrackInList",value:function(e){var t,n={command:"toggleSubtitleTrackInList",track:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=void 0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.fullscreenToggleCallbacks=[],this.subtitleSettingsCallbacks=[],this.miscSettingsCallbacks=[],this.ankiSettingsCallbacks=[],this.alertCallbacks=[],this.copyCallbacks=[])}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}}]),e}(),mr=function(){function e(t,n){var a=this;Object(F.a)(this,e),this.defaultKeyBinder=void 0,this.extension=void 0,this.copyHandlers=[],this.ankiExportHandlers=[],this.updateLastCardHandlers=[],this.takeScreenshotHandlers=[],this.onExtensionMessage=void 0,this.defaultKeyBinder=t,this.extension=n,this.onExtensionMessage=function(e){var t;if("copy-subtitle"===e.data.command){var n=e.data;switch(n.postMineAction){case re.none:t=a.copyHandlers;break;case re.showAnkiDialog:t=a.ankiExportHandlers;break;case re.updateLastCard:t=a.updateLastCardHandlers;break;default:console.error("Unknown post mine action "+n.postMineAction)}}else"take-screenshot"===e.data.command&&(t=a.takeScreenshotHandlers);if(void 0!==t){var r,s=Object(i.a)(t);try{for(s.s();!(r=s.n()).done;){(0,r.value)(new KeyboardEvent("mock"))}}catch(o){s.e(o)}finally{s.f()}}},n.subscribe(this.onExtensionMessage)}return Object(_.a)(e,[{key:"bindCopy",value:function(e,t,n,a){var i=this;if(this.extension.installed){var r=this.defaultKeyBinder.copyHandler(e,t,n);return this.copyHandlers.push(r),function(){i._remove(r,i.copyHandlers)}}return this.defaultKeyBinder.bindCopy(e,t,n,a)}},{key:"bindAnkiExport",value:function(e,t,n){var a=this;if(this.extension.installed){var i=this.defaultKeyBinder.ankiExportHandler(e,t);return this.ankiExportHandlers.push(i),function(){a._remove(i,a.ankiExportHandlers)}}return this.defaultKeyBinder.bindAnkiExport(e,t,n)}},{key:"bindUpdateLastCard",value:function(e,t,n){var a=this;if(this.extension.installed){var i=this.defaultKeyBinder.updateLastCardHandler(e,t);return this.updateLastCardHandlers.push(i),function(){a._remove(i,a.updateLastCardHandlers)}}return this.defaultKeyBinder.bindUpdateLastCard(e,t,n)}},{key:"bindTakeScreenshot",value:function(e,t,n){var a=this;if(this.extension.installed){var i=this.defaultKeyBinder.takeScreenshotHandler(e,t);return this.takeScreenshotHandlers.push(i),function(){a._remove(i,a.takeScreenshotHandlers)}}return this.defaultKeyBinder.bindTakeScreenshot(e,t,n)}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}},{key:"bindSeekToSubtitle",value:function(e,t,n,a,i){return this.defaultKeyBinder.bindSeekToSubtitle(e,t,n,a,i)}},{key:"bindSeekToBeginningOfCurrentSubtitle",value:function(e,t,n,a,i){return this.defaultKeyBinder.bindSeekToBeginningOfCurrentSubtitle(e,t,n,a,i)}},{key:"bindSeekBackwardOrForward",value:function(e,t,n){return this.defaultKeyBinder.bindSeekBackwardOrForward(e,t,n)}},{key:"bindOffsetToSubtitle",value:function(e,t,n,a,i){return this.defaultKeyBinder.bindOffsetToSubtitle(e,t,n,a,i)}},{key:"bindAdjustOffset",value:function(e,t,n,a){return this.defaultKeyBinder.bindAdjustOffset(e,t,n,a)}},{key:"bindResetOffet",value:function(e,t,n){return this.defaultKeyBinder.bindResetOffet(e,t,n)}},{key:"bindAdjustPlaybackRate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.defaultKeyBinder.bindAdjustPlaybackRate(e,t,n)}},{key:"bindToggleSubtitles",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitles(e,t,n)}},{key:"bindToggleSubtitleTrackInVideo",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitleTrackInVideo(e,t,n)}},{key:"bindToggleSubtitleTrackInList",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitleTrackInList(e,t,n)}},{key:"bindPlay",value:function(e,t,n){return this.defaultKeyBinder.bindPlay(e,t,n)}},{key:"bindAutoPause",value:function(e,t,n){return this.defaultKeyBinder.bindAutoPause(e,t,n)}},{key:"bindCondensedPlayback",value:function(e,t,n){return this.defaultKeyBinder.bindCondensedPlayback(e,t,n)}}]),e}(),kr=(n(371),Object(x.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},cursorHidden:{cursor:"none"},subtitleContainer:{position:"absolute",paddingLeft:20,paddingRight:20,textAlign:"center",whiteSpace:"pre-wrap",lineHeight:"normal"}}));function Or(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),s=window.screen.availHeight-(window.outerHeight-window.innerHeight),o=Math.min(1,Math.min(r/e.videoWidth,s/e.videoHeight));window.resizeTo(o*e.videoWidth+(window.outerWidth-window.innerWidth),o*e.videoHeight+(window.outerHeight-window.innerHeight))}var c,u;if(e.audioTracks){c=[];var l,d=Object(i.a)(e.audioTracks);try{for(d.s();!(l=d.n()).done;){var b=l.value;c.push({id:b.id,label:b.label,language:b.language}),b.enabled&&(u=b.id)}}catch(f){d.e(f)}finally{d.f()}}else c=void 0,u=void 0;n(c),a(u),t.ready(e.duration,e.paused,e.playbackRate,c,u)}var yr=function(e){var t,n,a,i=e.subtitle,r=e.videoRef,s=e.subtitleStyles,o=e.imageBasedSubtitleScaleFactor;i.textImage?t=Object(pe.jsx)(ot,{availableWidth:null!==(n=null===(a=r.current)||void 0===a?void 0:a.width)&&void 0!==n?n:window.screen.availWidth,subtitle:i,scale:o}):t=Object(pe.jsx)("span",{style:s,children:i.text});return Object(pe.jsx)("div",{children:t})};function xr(e){var t=e.settingsProvider,n=e.playbackPreferences,a=e.extension,r=e.videoFile,o=e.channel,u=e.popOut,d=e.ankiDialogFinishedRequest,h=e.ankiDialogOpen,p=e.seekRequest,g=e.onAnkiDialogRequest,j=e.onError,m=e.onPlayModeChangedViaBind,k=e.onAnkiDialogRewind,O=kr(),y=Object(f.useRef)(),x=Object(f.useRef)(),S=w(!0),C=Object(l.a)(S,2),T=C[0],F=C[1];x.current&&(x.current.width=T,x.current.height=F);var _=Object(f.useMemo)((function(){return new jr(o)}),[o]),P=Object(f.useState)(!1),E=Object(l.a)(P,2),R=E[0],M=E[1],A=Object(f.useState)(!1),B=Object(l.a)(A,2),D=B[0],L=B[1],H=Object(f.useState)(!1),W=Object(l.a)(H,2),U=W[0],K=W[1],q=Object(f.useRef)();q.current=D;var G=Object(f.useState)(0),X=Object(l.a)(G,2),J=X[0],Y=X[1],Q=Object(f.useState)(),Z=Object(l.a)(Q,2),$=Z[0],ee=Z[1],te=Object(f.useState)(0),ne=Object(l.a)(te,2),ae=ne[0],ie=ne[1],ce=Object(f.useState)(1),de=Object(l.a)(ce,2),be=de[0],fe=de[1],he=Object(f.useState)(),ve=Object(l.a)(he,2),ge=ve[0],me=ve[1],ke=Object(f.useState)(),Oe=Object(l.a)(ke,2),ye=Oe[0],xe=Oe[1],Se=Object(f.useState)(!1),Ce=Object(l.a)(Se,2)[1],we=Object(f.useState)([]),Te=Object(l.a)(we,2),Fe=Te[0],_e=Te[1],Pe=Object(f.useMemo)((function(){return new On(Fe,{returnLastShown:!1,showingCheckRadiusMs:150})}),[Fe]),Ee=Object(f.useState)([]),Re=Object(l.a)(Ee,2),Me=Re[0],Ae=Re[1],Be=Object(f.useState)(!0),Ie=Object(l.a)(Be,2),Ne=Ie[0],De=Ie[1],Le=Object(f.useState)({}),He=Object(l.a)(Le,2),We=He[0],Ue=He[1],ze=Object(f.useState)(oe.normal),Ve=Object(l.a)(ze,2),Ke=Ve[0],qe=Ve[1],Ge=Object(f.useState)(!1),Xe=Object(l.a)(Ge,2),Je=Xe[0],Ye=Xe[1],Qe=Object(f.useState)(n.theaterMode),Ze=Object(l.a)(Qe,2),$e=Ze[0],et=Ze[1],tt=Object(f.useState)(n.subtitleAlignment),nt=Object(l.a)(tt,2),at=nt[0],it=nt[1],rt=Object(f.useState)(n.subtitlePositionOffset),st=Object(l.a)(rt,2),ot=st[0],ct=st[1],ut=Object(f.useRef)([]);ut.current=Me;var lt=Object(f.useMemo)((function(){return new Cn}),[]),dt=Object(f.useRef)({x:0,y:0}),bt=Object(f.useState)(!1),ft=Object(l.a)(bt,2),ht=ft[0],vt=ft[1],pt=Object(f.useRef)(0),gt=Object(f.useRef)(null),jt=Object(f.useState)(t.miscSettings),mt=Object(l.a)(jt,2),kt=mt[0],Ot=mt[1],yt=Object(f.useState)(t.subtitleSettings),xt=Object(l.a)(yt,2),St=xt[0],Ct=xt[1],wt=Object(f.useState)(t.ankiSettings),Tt=Object(l.a)(wt,2),Ft=Tt[0],_t=Tt[1],Pt=Object(f.useState)(!1),Et=Object(l.a)(Pt,2),Rt=Et[0],Mt=Et[1],At=Object(f.useState)(""),Bt=Object(l.a)(At,2),It=Bt[0],Nt=Bt[1],Dt=Object(f.useState)("info"),Lt=Object(l.a)(Dt,2),Ht=Lt[0],Wt=Lt[1],Ut=Object(f.useState)(),zt=Object(l.a)(Ut,2),Vt=zt[0],Kt=zt[1],qt=Object(f.useMemo)((function(){var e=new ue;return e.onStartedShowing=function(){Ke===oe.autoPause&&kt.autoPausePreference===se.atStart&&_.pause()},e.onWillStopShowing=function(){Ke===oe.autoPause&&kt.autoPausePreference===se.atEnd&&_.pause()},e}),[_,kt,Ke]),Gt=Object(f.useRef)();Gt.current=qt;var Xt=Object(f.useMemo)((function(){return new mr(new gr(kt.keyBindSet),a)}),[kt.keyBindSet,a]);Object(f.useEffect)((function(){v.a.language!==kt.language&&v.a.changeLanguage(kt.language)}),[kt]);var Jt=Object(f.useCallback)((function(e){if(e){var t=e;x.current=t,4===t.readyState?Or(t,_,me,xe):t.onloadeddata=function(e){Or(t,_,me,xe)},t.oncanplay=function(e){_.readyState(4),q.current&&lt.start()},t.ontimeupdate=function(t){return lt.setTime(1e3*e.currentTime)},t.onerror=function(t){return j(function(e){var t,n,a;switch(null===(t=e.error)||void 0===t?void 0:t.code){case 1:case 2:a="MEDIA_ERR_ABORTED";break;case 3:a="MEDIA_ERR_DECODE";break;case 4:a="MEDIA_ERR_SRC_NOT_SUPPORTED";break;default:a="Unknown error"}return a+": "+((null===(n=e.error)||void 0===n?void 0:n.message)||"<details missing>")}(e))}}}),[lt,_,j]);function Yt(e){var t,n=null===(t=x.current)||void 0===t?void 0:t.audioTracks;if(n){var a,r=Object(i.a)(n);try{for(r.s();!(a=r.n()).done;){var s=a.value;s.id===e?s.enabled=!0:s.enabled=!1}}catch(o){r.e(o)}finally{r.f()}}}var Qt=Object(f.useCallback)((function(e){ie(e),_e((function(t){return t.map((function(t,n){return{text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,track:t.track,index:n}}))}))}),[]),Zt=Object(f.useCallback)((function(e,t){x.current&&(x.current.playbackRate=e,lt.rate=e,fe(e),t&&_.playbackRate(e))}),[_,lt]);Object(f.useEffect)((function(){return _.onReady((function(e,t){Y(e),ee(t)})),_.onPlay(Object(s.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=x.current)||void 0===t?void 0:t.play();case 2:lt.start(),L(!0);case 4:case"end":return e.stop()}}),e)})))),_.onPause((function(){var e;null===(e=x.current)||void 0===e||e.pause(),lt.stop(),L(!1)})),_.onCurrentTime((function(e){var t,n;x.current&&(x.current.currentTime=e),4===(null===(t=x.current)||void 0===t?void 0:t.readyState)&&_.readyState(4),lt.stop(),lt.setTime(1e3*e),null===(n=Gt.current)||void 0===n||n.clear()})),_.onAudioTrackSelected((function(e){Yt(e),xe(e),_.audioTrackSelected(e)})),_.onClose((function(){_.close(),window.close()})),_.onSubtitles((function(e){var t;if(_e(e.map((function(e,t){return Object(c.a)(Object(c.a)({},e),{},{index:t})}))),e&&e.length>0){var n=e[0],a=n.start-n.originalStart;ie(a)}Ae([]),null===(t=Gt.current)||void 0===t||t.clear()})),_.onPlayMode((function(e){return qe(e)})),_.onHideSubtitlePlayerToggle((function(e){return Ye(e)})),_.onAppBarToggle((function(e){return et(e)})),_.onFullscreenToggle((function(e){return K(e)})),_.onSubtitleSettings(Ct),_.onMiscSettings(Ot),_.onAnkiSettings(_t),_.onOffset(Qt),_.onPlaybackRate((function(e){Zt(e,!1)})),_.onAlert((function(e,t){u&&(Mt(!0),Nt(e),Wt(t))})),window.onbeforeunload=function(e){y.current||_.close()},M(!0),function(){return _.close()}}),[lt,_,Qt,Zt,u]);var $t=Object(f.useCallback)((function(){x.current&&_.play()}),[_]),en=Object(f.useCallback)((function(){return _.pause()}),[_]),tn=Object(f.useCallback)((function(e){q.current&&lt.stop();var t=e*J;_.currentTime=t/1e3}),[J,lt,_]);Object(f.useEffect)((function(){void 0!==p&&tn(p.timestamp/J)}),[tn,p,J]);var nn=Object(f.useCallback)((function(e){q.current&&(lt.stop(),_.pause()),Yt(e),xe(e),_.currentTime=0,_.audioTrackSelected(e)}),[_,lt]);Object(f.useEffect)((function(){if(Fe&&0!==Fe.length){var e=setInterval((function(){var e,t=lt.time(J),n=[],a=Pe.subtitlesAt(t),r=Object(i.a)(a.showing);try{for(r.s();!(e=r.n()).done;){var s=e.value;We[s.track]||n.push(s)}}catch(o){r.e(o)}finally{r.f()}a.startedShowing&&!We[a.startedShowing.track]&&qt.startedShowing(a.startedShowing),a.willStopShowing&&!We[a.willStopShowing.track]&&qt.willStopShowing(a.willStopShowing),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0}(n=n.sort((function(e,t){return e.track-t.track})),ut.current,(function(e,t){return e.index===t.index}))||(Ae(n),n.length>0&&kt.autoCopyCurrentSubtitle&&document.hasFocus()&&navigator.clipboard.writeText(n.map((function(e){return e.text})).join("\n")).catch((function(e){})))}),100);return function(){return clearTimeout(e)}}}),[Pe,_,Fe,We,lt,J,qt,kt]);var an=Object(f.useCallback)((function(e){Qt(e),_.offset(e)}),[_,Qt]),rn=Object(f.useCallback)((function(e){Zt(e,!0)}),[Zt]);Object(f.useEffect)((function(){return Xt.bindSeekToSubtitle((function(e,t){e.preventDefault(),_.currentTime=t.start/1e3}),(function(){return!x.current}),(function(){return lt.time(J)}),(function(){return Fe}))}),[Xt,_,Fe,J,lt]),Object(f.useEffect)((function(){return Xt.bindSeekToBeginningOfCurrentSubtitle((function(e,t){e.preventDefault(),_.currentTime=t.start/1e3}),(function(){return!x.current}),(function(){return lt.time(J)}),(function(){return Fe}))}),[Xt,_,Fe,J,lt]),Object(f.useEffect)((function(){return Xt.bindSeekBackwardOrForward((function(e,t){e.preventDefault();var n=lt.time(J);_.currentTime=t?Math.min(J/1e3,(n+1e4)/1e3):Math.max(0,(n-1e4)/1e3)}),(function(){return!x.current}))}),[Xt,_,J,lt]);var sn=Object(f.useCallback)((function(e){return I(Fe,e,Ft.surroundingSubtitlesCountRadius,Ft.surroundingSubtitlesTimeRadius)}),[Fe,Ft.surroundingSubtitlesCountRadius,Ft.surroundingSubtitlesTimeRadius]);Object(f.useEffect)((function(){return Xt.bindAdjustOffset((function(e,t){e.preventDefault(),an(t)}),(function(){return!1}),(function(){return Fe}))}),[Xt,an,Fe]),Object(f.useEffect)((function(){return Xt.bindResetOffet((function(e){e.preventDefault(),an(0)}),(function(){return!1}))}),[Xt,an]),Object(f.useEffect)((function(){return Xt.bindAdjustPlaybackRate((function(e,t){e.preventDefault(),Zt(t?Math.min(5,be+.1):Math.max(.1,be-.1),!0)}),(function(){return!1}))}),[Zt,be,Xt]),Object(f.useEffect)((function(){return Xt.bindToggleSubtitles((function(e){e.preventDefault(),De((function(e){return!e}))}),(function(){return!1}))}),[Xt]),Object(f.useEffect)((function(){return Xt.bindToggleSubtitleTrackInVideo((function(e,t){e.preventDefault(),Ue((function(e){var n=Object(c.a)({},e);return n[t]=!e[t],n}))}),(function(){return!1}))}),[Xt]),Object(f.useEffect)((function(){return Xt.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),_.toggleSubtitleTrackInList(t)}),(function(){return!1}))}),[Xt,_]),Object(f.useEffect)((function(){return Xt.bindOffsetToSubtitle((function(e,t){e.preventDefault(),an(t)}),(function(){return!1}),(function(){return lt.time(J)}),(function(){return Fe}))}),[Xt,an,Fe,lt,J]);var on=Object(f.useCallback)((function(){if(!Fe||0===Fe.length){var e=lt.time(J),t=Math.min(e+5e3,J),n={text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0};return{currentSubtitle:n,surroundingSubtitles:N(n,J,5e3)}}if(ut.current&&ut.current.length>0){var a=ut.current[0];return{currentSubtitle:a,surroundingSubtitles:sn(a.index)}}}),[Fe,sn,J,lt]),cn=Object(f.useCallback)((function(e,t,n,a,i,r,s,o){if(e===re.showAnkiDialog)u?(_.copy(r,s,o,re.none),g(t,null!==n&&void 0!==n?n:"",a,i,r,s,o),D&&(_.pause(),Ce(!0))):_.copy(r,s,o,re.showAnkiDialog);else _.copy(r,s,o,e);Kt({videoFileUrl:t,videoFileName:null!==n&&void 0!==n?n:"",selectedAudioTrack:a,playbackRate:i,subtitle:r,surroundingSubtitles:s,timestamp:o})}),[g,_,D,u]),un=Object(f.useCallback)((function(e){var t=on();if(void 0!==t){var n=t.currentSubtitle,a=t.surroundingSubtitles;cn(e,r,null!==$&&void 0!==$?$:"",ye,be,n,a,lt.time(J))}}),[cn,on,lt,J,be,ye,r,$]);Object(f.useEffect)((function(){return _.onCopy(un)}),[_,un]),Object(f.useEffect)((function(){return Xt.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation(),un(re.showAnkiDialog)}),(function(){return!1}))}),[un,Xt]),Object(f.useEffect)((function(){d&&d.timestamp>0&&Ce((function(e){return e&&d.resume&&_.play(),!1}))}),[d,_]),Object(f.useEffect)((function(){return Xt.bindUpdateLastCard((function(e){e.preventDefault(),e.stopPropagation(),un(re.updateLastCard)}),(function(){return!1}))}),[un,Xt]),Object(f.useEffect)((function(){return Xt.bindTakeScreenshot((function(e){if(e.preventDefault(),u&&h)k();else if(Vt){var t=lt.time(J);cn(re.showAnkiDialog,Vt.videoFileUrl,Vt.videoFileName,Vt.selectedAudioTrack,Vt.playbackRate,Vt.subtitle,Vt.surroundingSubtitles,t)}}),(function(){return!1}))}),[lt,J,Xt,Vt,cn,u,h,k]),Object(f.useEffect)((function(){return Xt.bindCopy((function(e,t){e.preventDefault(),un(re.none)}),(function(){return!1}),(function(){var e=on();if(void 0!==e)return e.currentSubtitle}))}),[on,un,Xt]),Object(f.useEffect)((function(){return Xt.bindPlay((function(e){e.preventDefault(),D?_.pause():_.play()}),(function(){return!1}))}),[Xt,D,_]);var ln=Object(f.useCallback)((function(e,t){e.preventDefault();var n=Ke===t?oe.normal:t;_.playMode(n),m(Ke,n)}),[Ke,_,m]);Object(f.useEffect)((function(){return Xt.bindAutoPause((function(e){return ln(e,oe.autoPause)}),(function(){return!1}))}),[Xt,ln]),Object(f.useEffect)((function(){return Xt.bindCondensedPlayback((function(e){return ln(e,oe.condensed)}),(function(){return!1}))}),[Xt,ln]);var dn=Object(f.useCallback)((function(){return De((function(e){return!e}))}),[]),bn=Object(f.useCallback)((function(){u?K((function(e){return e?document.exitFullscreen():document.documentElement.requestFullscreen(),!e})):_.fullscreenToggle()}),[_,u]),fn=Object(f.useCallback)((function(e){x.current&&(x.current.volume=e)}),[]),hn=Object(f.useCallback)((function(){_.popOutToggle(),u&&(y.current=!0,window.close())}),[_,u]),vn=Object(f.useCallback)((function(e){_.playMode(e)}),[_]),pn=Object(f.useCallback)((function(){_.close(),window.close()}),[_]),gn=Object(f.useCallback)((function(){_.hideSubtitlePlayerToggle()}),[_]),jn=Object(f.useCallback)((function(){_.appBarToggle()}),[_]),mn=Object(f.useCallback)((function(e){it(e),n.subtitleAlignment=e}),[n]);Object(f.useEffect)((function(){var e=function(e){var t;if(Ne&&null!==(t=ut.current)&&void 0!==t&&t.length&&!(Math.abs(e.deltaY)<10)){var a;switch(at){case yn.bottom:a=e.deltaY>0;break;case yn.top:a=e.deltaY<0}ct((function(e){var t=a?--e:++e;return n.subtitlePositionOffset=t,t}))}};return window.addEventListener("wheel",e),function(){return window.removeEventListener("wheel",e)}}),[at,Ne,n]);var kn=Object(f.useCallback)((function(){D?_.pause():_.play()}),[_,D]),xn=Object(f.useCallback)((function(){return bn()}),[bn]),Sn=St.subtitleSize,wn=St.subtitleColor,Tn=St.subtitleThickness,Fn=St.subtitleOutlineThickness,_n=St.subtitleOutlineColor,Pn=St.subtitleBackgroundColor,En=St.subtitleBackgroundOpacity,Rn=St.subtitleFontFamily,Mn=St.subtitleCustomStyles,An=St.imageBasedSubtitleScaleFactor,Bn=Object(f.useMemo)((function(){return z({subtitleSize:Sn,subtitleColor:wn,subtitleThickness:Tn,subtitleOutlineThickness:Fn,subtitleOutlineColor:_n,subtitleBackgroundColor:Pn,subtitleBackgroundOpacity:En,subtitleFontFamily:Rn,subtitleCustomStyles:Mn})}),[Sn,wn,Tn,Fn,_n,Pn,En,Rn,Mn]),In=Object(f.useMemo)((function(){return function(e){for(var t=z(e),n=[],a=0,i=Object.entries(t);a<i.length;a++){var r=Object(l.a)(i[a],2),s=r[0],o=r[1];n.push("".concat(V(s),": ").concat(o," !important"))}return n.join(";")}({subtitleSize:Sn,subtitleColor:wn,subtitleThickness:Tn,subtitleOutlineThickness:Fn,subtitleOutlineColor:_n,subtitleBackgroundColor:Pn,subtitleBackgroundOpacity:En,subtitleFontFamily:Rn,subtitleCustomStyles:Mn})}),[Sn,wn,Tn,Fn,_n,Pn,En,Rn,Mn]);Object(f.useEffect)((function(){var e=setInterval((function(){Date.now()-pt.current>300?ht&&vt(!1):ht||vt(!0)}),100);return function(){return clearInterval(e)}}),[ht]);var Nn=Object(f.useCallback)((function(){return Mt(!1)}),[]),Dn=function(e,t){var n=Object(f.useState)(new le),a=Object(l.a)(n,2),r=a[0],s=a[1];return Object(f.useEffect)((function(){var e=new le;return s(e),function(){return e.clear()}}),[e,t]),{getSubtitleDomCache:function(){if(r.empty){var n,a=Object(i.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;r.add(String(s.index),t(s))}}catch(o){a.e(o)}finally{a.f()}}return r}}}(Fe,Object(f.useCallback)((function(e){return function(e,t,n,a){if(e.textImage){var i,r,s=a*(null!==(i=null===(r=t.current)||void 0===r?void 0:r.width)&&void 0!==i?i:window.screen.availWidth)/e.textImage.screen.width*e.textImage.image.width;return'\n<div style="max-width:'.concat(s,'px;">\n<img\n    style="width:100%;"\n    alt="subtitle"\n    src="').concat(e.textImage.dataUrl,'"\n/>\n</div>\n')}return'<span style="'.concat(n,'">').concat(e.text,"</span>")}(e,x,In,An)}),[In,An])),Ln=Dn.getSubtitleDomCache;return R?Object(pe.jsxs)("div",{ref:gt,onMouseMove:function(e){if(pt.current=Date.now(),gt.current){var t=gt.current.getBoundingClientRect();dt.current.x=e.clientX-t.left,dt.current.y=e.clientY-t.top}},className:O.root,children:[Object(pe.jsx)(je,{open:Rt,onClose:Nn,autoHideDuration:3e3,severity:Ht,children:It}),Object(pe.jsx)("video",{preload:"auto",controls:!1,onClick:kn,onDoubleClick:xn,className:ht?O.video:"".concat(O.cursorHidden," ").concat(O.video),ref:Jt,src:r}),Ne&&Object(pe.jsx)("div",{style:at===yn.bottom?{bottom:ot}:{top:ot},className:O.subtitleContainer,children:Me.map((function(e,t){if(kt.preCacheSubtitleDom){var n=Ln();return Object(pe.jsx)("div",{ref:function(t){if(t){for(;t.firstChild;)n.return(t.lastChild);t.appendChild(n.get(String(e.index)))}}},t)}return Object(pe.jsx)(yr,{subtitle:e,subtitleStyles:Bn,videoRef:x,imageBasedSubtitleScaleFactor:An},t)}))}),Object(pe.jsx)(Sa,{mousePositionRef:dt,playing:D,clock:lt,length:J,audioTracks:ge,selectedAudioTrack:ye,subtitlesToggle:Fe&&Fe.length>0,subtitlesEnabled:Ne,offsetEnabled:!0,offset:ae,playbackRate:be,playbackRateEnabled:!0,fullscreenEnabled:!0,fullscreen:U,closeEnabled:!u,popOut:u,volumeEnabled:!0,popOutEnabled:!di.isMobile,playModeEnabled:Fe&&Fe.length>0,playMode:Ke,hideSubtitlePlayerToggleEnabled:(null===Fe||void 0===Fe?void 0:Fe.length)>0&&!u&&!U,subtitlePlayerHidden:Je,onPlay:$t,onPause:en,onSeek:tn,onAudioTrackSelected:nn,onSubtitlesToggle:dn,onFullscreenToggle:bn,onVolumeChange:fn,onOffsetChange:an,onPlaybackRateChange:rn,onPopOutToggle:hn,onPlayMode:vn,onClose:pn,onHideSubtitlePlayerToggle:gn,playbackPreferences:n,showOnMouseMovement:!1,theaterModeToggleEnabled:!u&&!U,theaterModeEnabled:$e,onTheaterModeToggle:jn,subtitleAlignment:at,subtitleAlignmentEnabled:!0,onSubtitleAlignment:mn})]}):null}var Sr,Cr=n(135),wr=n(138),Tr=function(e){Object(Cr.a)(n,e);var t=Object(wr.a)(n);function n(){var e;return Object(F.a)(this,n),(e=t.call(this,"CopyHistoryDatabase")).copyHistoryItems=void 0,e.version(1).stores({copyHistoryItems:"++index,id,timestamp"}),e}return Object(_.a)(n)}(n(254).a),Fr=function(){function e(t){Object(F.a)(this,e),this._db=new Tr,this._limit=void 0,this._limit=t}return Object(_.a)(e,[{key:"limit",set:function(e){this._limit=e}},{key:"fetch",value:function(){var e=Object(s.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t<=0)){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this._db.copyHistoryItems.reverse().limit(t).toArray();case 4:return e.next=6,e.sent;case 6:return(n=e.sent).reverse(),e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(s.a)(b.a.mark((function e(t){var n,a,i,r,s,o,c,u,l,d,f,h,v,p,g,j,m,k,O,y,x,S;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._limit<=0)){e.next=2;break}return e.abrupt("return");case 2:return n=t.text,a=t.textImage,i=t.start,r=t.end,s=t.originalStart,o=t.originalEnd,c=t.track,u=t.name,l=t.id,d=t.timestamp,f=t.surroundingSubtitles,h=t.audioTrack,v=t.filePlaybackRate,p=t.videoFile,g=t.audioFile,j=t.subtitleFileName,m=t.mediaTimestamp,k=t.audio,O=t.image,y=t.url,x={text:n,textImage:a,start:i,end:r,originalStart:s,originalEnd:o,track:c,name:u,id:l,timestamp:d,surroundingSubtitles:f,audioTrack:h,filePlaybackRate:v,videoFileName:null===p||void 0===p?void 0:p.name,audioFileName:null===g||void 0===g?void 0:g.name,subtitleFileName:j,mediaTimestamp:m,audio:k,image:O,url:y},e.next=6,this._db.copyHistoryItems.put(x);case 6:return S=e.sent,e.next=9,this._prune(S);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_prune",value:function(){var e=Object(s.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._db.copyHistoryItems.count();case 2:if(!(e.sent>this._limit)){e.next=10;break}return e.next=6,this._db.copyHistoryItems.where("index").belowOrEqual(t-this._limit).primaryKeys();case 6:if(!((n=e.sent).length>0)){e.next=10;break}return e.next=10,this._db.copyHistoryItems.bulkDelete(n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(s.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._db.copyHistoryItems.where("id").equals(t).primaryKeys();case 2:return n=e.sent,e.next=5,this._db.copyHistoryItems.bulkDelete(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),_r=n(258),Pr=function(e){Object(Cr.a)(n,e);var t=Object(wr.a)(n);function n(e){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(F.a)(this,n),(a=t.call(this,e)).key=void 0,a.params=void 0,a.key=e,a.params=i,a}return Object(_.a)(n,[{key:"locKey",get:function(){return this.key}},{key:"locParams",get:function(){return this.params}}]),n}(Object(_r.a)(Error)),Er=n(255),Rr=Object(be.a)(),Mr=function(){function e(t,n){var a=this;Object(F.a)(this,e),this.version=void 0,this.extensionCommands=void 0,this.tabs=void 0,this.installed=void 0,this.windowEventListener=void 0,this.onMessageCallbacks=void 0,this.onTabsCallbacks=void 0,this.heartbeatStarted=!1,this.onMessageCallbacks=[],this.onTabsCallbacks=[],this.tabs=[],this.installed=void 0!==t,this.version=null!==t&&void 0!==t?t:"",this.extensionCommands=null!==n&&void 0!==n?n:{},this.windowEventListener=function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message)if("tabs"===e.data.message.command){var t=e.data;a.tabs=t.message.tabs;var n,r=Object(i.a)(a.onTabsCallbacks);try{for(r.s();!(n=r.n()).done;){(0,n.value)(a.tabs)}}catch(u){r.e(u)}finally{r.f()}t.message.ackRequested&&window.postMessage({sender:"asbplayerv2",message:{command:"ackTabs",id:Rr,receivedTabs:a.tabs}},"*")}else{var s,o=e.data,c=Object(i.a)(a.onMessageCallbacks);try{for(c.s();!(s=c.n()).done;){(0,s.value)({data:o.message,tabId:o.tabId,src:o.src})}}catch(u){c.e(u)}finally{c.f()}}},window.addEventListener("message",this.windowEventListener)}return Object(_.a)(e,[{key:"startHeartbeat",value:function(e){var t=this;this.installed&&(this.heartbeatStarted||(e?Object(Er.gt)(this.version,"0.23.0")&&setInterval((function(){return t._sendHeartbeat(!0)}),1e3):setInterval((function(){return t._sendHeartbeat(!1)}),1e3),this.heartbeatStarted=!0))}},{key:"_sendHeartbeat",value:function(e){window.postMessage({sender:"asbplayerv2",message:{command:"heartbeat",id:Rr,receivedTabs:e?[]:this.tabs,videoPlayer:e}},"*")}},{key:"openShortcuts",value:function(){window.postMessage({sender:"asbplayerv2",message:{command:"open-extension-shortcuts"}})}},{key:"sendMessage",value:function(e,t,n){var a={sender:"asbplayerv2",message:e,tabId:t,src:n};window.postMessage(a,"*")}},{key:"publishSharedGlobalSettings",value:function(e){var t={sender:"asbplayerv2",message:{command:"shared-settings-updated",settings:{language:e.language,themeType:e.themeType}}};window.postMessage(t,"*")}},{key:"subscribeTabs",value:function(e){var t=this;return this.onTabsCallbacks.push(e),function(){return t._remove(e,t.onTabsCallbacks)}}},{key:"subscribe",value:function(e){var t=this;return this.onMessageCallbacks.push(e),function(){return t._remove(e,t.onMessageCallbacks)}}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}},{key:"unbind",value:function(){window.removeEventListener("message",this.windowEventListener),this.onMessageCallbacks=[],this.onTabsCallbacks=[]}}]),e}(),Ar={"copy-subtitle":"copySubtitle","copy-subtitle-with-dialog":"ankiExport","update-last-card":"updateLastCard","take-screenshot":"takeScreenshot"},Br=new Mr,Ir=function(e){var t=function(t){if(t.source===window&&"asbplayer-extension-to-player"===t.data.sender&&"version"===t.data.message.command){for(var n,a=t.data.message,i={},r=null!==(n=a.extensionCommands)&&void 0!==n?n:{},s=0,o=Object.keys(r);s<o.length;s++){var c=o[s];i[Ar[c]]=r[c]}e(new Mr(a.version,i))}};return window.addEventListener("message",t),function(){window.removeEventListener("message",t)}},Nr=Ir((function(e){return Sr=e})),Dr=["searchParams"],Lr=Object(x.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:function(t){var n=t.drawerWidth;return{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:n}}}}));function Hr(e,t,n,a){if(e.audio){var i,r,s,o,c,u=null!==(i=e.audio.start)&&void 0!==i?i:e.start,d=null!==(r=e.audio.end)&&void 0!==r?r:e.end;return Q.fromBase64(e.subtitleFileName,Math.max(0,u-(null!==(s=e.audio.paddingStart)&&void 0!==s?s:0)),d+(null!==(o=e.audio.paddingEnd)&&void 0!==o?o:0),null!==(c=e.audio.playbackRate)&&void 0!==c?c:1,e.audio.base64,e.audio.extension)}var b=function(){var n,a;return t?(n=t.subtitleStart,a=t.subtitleEnd):(n=e.start,a=e.end),[n,a]};if(e.audioFile||e.videoFile){var f,h=b(),v=Object(l.a)(h,2),p=v[0],g=v[1];return Q.fromFile(e.audioFile||e.videoFile,Math.max(0,p-n),g+a,null!==(f=e.filePlaybackRate)&&void 0!==f?f:1,e.audioTrack)}if(e.audioFileName||e.videoFileName){var j=b(),m=Object(l.a)(j,2),k=m[0],O=m[1];return Q.fromMissingFile(e.audioFileName||e.videoFileName,k,O)}}function Wr(e,t,n){return e.image?ne.fromBase64(e.subtitleFileName,e.start,e.image.base64,e.image.extension):e.videoFile?ne.fromFile(e.videoFile,null!==(a=e.mediaTimestamp)&&void 0!==a?a:e.start,t,n):e.videoFileName?ne.fromMissingFile(e.videoFileName,null!==(i=e.mediaTimestamp)&&void 0!==i?i:e.start):void 0;var a,i}function Ur(e){var t,n,a,i;if(e){var r=null!==(t=null!==(n=e.subtitleFileName)&&void 0!==n?n:null===(a=e.audioFile)||void 0===a?void 0:a.name)&&void 0!==t?t:null===(i=e.videoFile)||void 0===i?void 0:i.name;if(r)return"".concat(r," (").concat(B(e.start),")")}}function zr(e){var t=e.searchParams,n=t.get("video"),a=t.get("channel"),i=t.get("popout");return Object(pe.jsx)(O.a,{to:"/video?video="+encodeURIComponent(n)+"&channel="+a+"&popout="+i})}function Vr(e){var t=e.searchParams,n=Object(u.a)(e,Dr),a=t.get("video"),i=t.get("channel"),r="true"===t.get("popout");return Object(pe.jsx)(xr,Object(c.a)({videoFile:a,channel:i,popOut:r},n))}function Kr(e){var t=Lr(e);return Object(pe.jsx)("main",{className:Object(fe.a)(t.content,Object(o.a)({},t.contentShift,e.drawerOpen)),children:e.children})}var qr=function(){var e=Object(p.c)().t,t=Object(f.useMemo)((function(){return new pr}),[]),n=Object(f.useMemo)((function(){var e;try{e=""===t.subtitleRegexFilter.trim()?void 0:new RegExp(t.subtitleRegexFilter,"g")}catch(n){e=void 0}return void 0!==e?new Pt({regex:e,replacement:t.subtitleRegexFilterTextReplacement}):new Pt}),[t.subtitleRegexFilter,t.subtitleRegexFilterTextReplacement]),a=Object(f.useMemo)((function(){return new ha(t)}),[t]),u=Object(f.useMemo)((function(){return Object(S.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:T.a.A400},type:t.themeType}})}),[t.themeType]),d=Object(f.useMemo)((function(){return new ce(t)}),[t]),h=Object(O.f)(),g=Object(y.b)(),j=Object(l.a)(g,1)[0],m="/video"===h.pathname||null!==j.get("video"),x=function(){var e=Object(f.useState)(Br),t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(f.useEffect)((function(){if(!Sr)return Nr(),Ir(a);a(Sr)}),[]),n}(),F=Object(f.useState)(!1),_=Object(l.a)(F,2),P=_[0],E=_[1],R=Object(f.useMemo)((function(){return new mr(new gr(t.keyBindSet),x)}),[t.keyBindSet,x]),M=Object(f.useRef)(null),A=Object(f.useRef)(null),I=Object(f.useState)(),N=Object(l.a)(I,2),D=N[0],L=N[1],H=w(!m),z=Object(l.a)(H,1)[0],V=M.current?.2:.3,K=M.current?150:300,q=Math.max(K,z*V),G=Object(f.useMemo)((function(){return new Fr(t.miningHistoryStorageLimit)}),[t]);Object(f.useEffect)((function(){G.limit=t.miningHistoryStorageLimit}),[G,t.miningHistoryStorageLimit]);var X=Object(f.useState)([]),J=Object(l.a)(X,2),Y=J[0],Q=J[1],Z=Object(f.useRef)([]);Z.current=Y;var $=Object(f.useState)(!1),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],ae=Object(f.useState)(a.theaterMode),ie=Object(l.a)(ae,2),se=ie[0],ue=ie[1],le=Object(f.useState)(!1),de=Object(l.a)(le,2),fe=de[0],he=de[1],ve=Object(f.useState)(!1),ge=Object(l.a)(ve,2),me=ge[0],ke=ge[1],Oe=Object(f.useState)(),ye=Object(l.a)(Oe,2),xe=ye[0],Se=ye[1],Ce=Object(f.useState)(!1),we=Object(l.a)(Ce,2),Fe=we[0],_e=we[1],Pe=Object(f.useState)(),Ee=Object(l.a)(Pe,2),Re=Ee[0],Me=Ee[1],Ae=Object(f.useState)(),Be=Object(l.a)(Ae,2),Ie=Be[0],Ne=Be[1],De=Object(f.useState)(),Le=Object(l.a)(De,2),He=Le[0],We=Le[1],Ue=Object(f.useState)({subtitleFiles:[]}),ze=Object(l.a)(Ue,2),Ve=ze[0],Ke=ze[1],qe=Object(f.useState)([]),Ge=Object(l.a)(qe,2),Xe=Ge[0],Je=Ge[1],Ye=Object(f.useState)(!1),Qe=Object(l.a)(Ye,2),Ze=Qe[0],$e=Qe[1],et=Object(f.useRef)(null),tt=Object(f.useState)(),nt=Object(l.a)(tt,2),at=nt[0],it=nt[1],rt=Object(f.useState)(!1),st=Object(l.a)(rt,2),ot=st[0],ct=st[1],ut=Object(f.useState)(!1),lt=Object(l.a)(ut,2),dt=lt[0],bt=lt[1],ft=Object(f.useState)(),ht=Object(l.a)(ft,2),gt=ht[0],jt=ht[1],mt=Object(f.useMemo)((function(){return gt&&function(e){if(e)return{subtitleStart:e.start,subtitleEnd:e.end,subtitles:e.surroundingSubtitles||[{start:e.start,end:e.end,text:e.text,track:e.track}]}}(gt)}),[gt]),Ot=Object(f.useMemo)((function(){return gt&&Hr(gt,mt,t.audioPaddingStart,t.audioPaddingEnd)}),[gt,mt,t.audioPaddingStart,t.audioPaddingEnd]),yt=Object(f.useMemo)((function(){return gt&&Wr(gt,t.maxImageWidth,t.maxImageHeight)}),[gt,t.maxImageWidth,t.maxImageHeight]),xt=Object(f.useState)(!1),St=Object(l.a)(xt,2),Ct=St[0],wt=St[1],Tt=Object(f.useState)({timestamp:0,resume:!1}),Ft=Object(l.a)(Tt,2),_t=Ft[0],Et=Ft[1],Rt=Object(f.useState)(!1),Mt=Object(l.a)(Rt,2),At=Mt[0],Bt=Mt[1],It=Object(f.useState)(),Nt=Object(l.a)(It,2),Dt=Nt[0],Lt=Nt[1],Ht=Object(f.useState)(!1),Wt=Object(l.a)(Ht,2),Ut=Wt[0],zt=Wt[1],Vt=Object(f.useState)(!1),Kt=Object(l.a)(Vt,2),qt=Kt[0],Gt=Kt[1],Jt=Object(f.useState)(),Yt=Object(l.a)(Jt,2),Qt=Yt[0],Zt=Yt[1],$t=Object(f.useState)(),en=Object(l.a)($t,2),tn=en[0],nn=en[1],an=Object(f.useState)([]),rn=Object(l.a)(an,2),sn=rn[0],on=rn[1],cn=Object(f.useRef)(null),un=Object(f.useRef)(!1);un.current=Ct;var ln=Ve.subtitleFiles,dn=Object(f.useCallback)((function(t){var n;(console.error(t),Me("error"),t instanceof Pr)?Se(null!==(n=e(t.locKey,t.locParams))&&void 0!==n?n:"<failed to localize error>"):t instanceof Error?Se(t.message):Se("string"===typeof t?t:String(t));_e(!0)}),[e]),bn=Object(f.useCallback)((function(e){if(e||0!==Z.current.length){var t=null!==e&&void 0!==e?e:Z.current[Z.current.length-1];jt(t),ct(!0),bt(!1),Gt(!0),wt(!0)}}),[]),fn=Object(f.useCallback)(function(){var e=Object(s.a)(b.a.mark((function e(t,n,a,i,r,s,o){var u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c.a,e.t1=Object(c.a)({},r),e.t2={},e.t3=s,e.t4=Date.now(),e.t5=Object(be.a)(),e.t6=n,e.t7=o,e.next=10,fetch(t).then((function(e){return e.blob()})).then((function(e){return new File([e],n)}));case 10:e.t8=e.sent,e.t9=a,e.t10=i,e.t11={surroundingSubtitles:e.t3,timestamp:e.t4,id:e.t5,name:e.t6,mediaTimestamp:e.t7,videoFile:e.t8,selectedAudioTrack:e.t9,filePlaybackRate:e.t10},u=(0,e.t0)(e.t1,e.t2,e.t11),bn(u);case 16:case"end":return e.stop()}}),e)})));return function(t,n,a,i,r,s,o){return e.apply(this,arguments)}}(),[bn]),vn=Object(f.useCallback)(function(){var t=Object(s.a)(b.a.mark((function t(n,a,i,r,s,o,c,u,l,f){var h;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return bt(!0),t.prev=1,t.next=4,d.export(n,a,i,r,s,o,c,u,l,f);case 4:h=t.sent,"gui"!==f&&("default"===f?(Me("success"),Se(e("info.exportedCard",{result:h})),_e(!0)):"updateLast"===f&&(Me("success"),Se(e("info.updatedCard",{result:h})),_e(!0)),ct(!1),un.current&&(Et({timestamp:Date.now(),resume:!0}),wt(!1))),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),dn(t.t0);case 11:return t.prev=11,bt(!1),Gt(!1),t.finish(11);case 15:case"end":return t.stop()}}),t,null,[[1,8,11,15]])})));return function(e,n,a,i,r,s,o,c,u,l){return t.apply(this,arguments)}}(),[d,dn,e]),pn=Object(f.useCallback)((function(e){if(void 0!==Ve.videoFile&&0!==Y.length){var t=Y[Y.length-1],n=Object(c.a)(Object(c.a)({},t),{},{id:Object(be.a)(),image:void 0,videoFile:Ve.videoFile,mediaTimestamp:e});Q((function(e){return[].concat(Object(r.a)(e),[n])})),G.save(n),bn(n)}}),[Ve.videoFile,Y,bn,G]),gn=Object(f.useCallback)((function(n,a,i,s,o,u,l,d,b,f,h,v,p){var g,j,m,k;n&&t.copyToClipboardOnMine&&navigator.clipboard.writeText(n.text);var O=Object(c.a)(Object(c.a)({},n),{},{surroundingSubtitles:a,timestamp:Date.now(),id:p||Object(be.a)(),name:null!==(g=null!==(j=null!==(m=null!==at&&void 0!==at?at:null===o||void 0===o?void 0:o.name)&&void 0!==m?m:null===s||void 0===s?void 0:s.name)&&void 0!==j?j:null===i||void 0===i?void 0:i.name)&&void 0!==g?g:"",subtitleFileName:null===o||void 0===o?void 0:o.name,audioFile:i,videoFile:s,filePlaybackRate:d,mediaTimestamp:u,audioTrack:l,audio:b,image:f,url:h});switch(Q((function(e){return[].concat(Object(r.a)(e),[O])})),null!==v&&void 0!==v?v:re.none){case re.none:break;case re.showAnkiDialog:bn(O);break;case re.updateLastCard:wt(!0);var y=Hr(O,void 0,t.audioPaddingStart,t.audioPaddingEnd);y&&t.preferMp3&&(y=y.toMp3()),vn(W(n,a),"",y,Wr(O,t.maxImageWidth,t.maxImageHeight),"",null!==(k=Ur(O))&&void 0!==k?k:"","",{},t.tags,"updateLast");break;default:throw new Error("Unknown post mine action: "+v)}n&&(Me("success"),Se(""===n.text?e("info.savedTimestamp",{timestamp:B(n.start)}):e("info.copiedSubtitle",{text:n.text})),_e(!0)),G.save(O)}),[at,t,G,vn,bn,e]);Object(f.useEffect)((function(){m||Object(s.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Q,e.next=3,G.fetch(t.miningHistoryStorageLimit);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))()}),[m,G,t]);var jn=Object(f.useCallback)((function(){ne((function(e){return!e})),E(!1)}),[]),kn=Object(f.useCallback)((function(){return ne(!1)}),[]),On=Object(f.useCallback)((function(){var e=!a.theaterMode;a.theaterMode=e,ue(e),E(!1)}),[a]),yn=Object(f.useCallback)((function(){E((function(e){return!e}))}),[]);Object(f.useEffect)((function(){P?document.fullscreenElement||document.documentElement.requestFullscreen():document.fullscreenElement&&document.exitFullscreen()}),[P]),Object(f.useEffect)((function(){var e=function(){document.fullscreenElement||E(!1)};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]);var xn=Object(f.useCallback)((function(){he((function(e){return!e}))}),[]),Sn=Object(f.useCallback)((function(){ke((function(e){return!e})),he(!1)}),[]),Cn=Object(f.useCallback)((function(){Gt(!0),Bt(!0)}),[]),wn=Object(f.useCallback)((function(){return _e(!1)}),[]),Tn=Object(f.useCallback)((function(){return zt(!1)}),[]),Fn=Object(f.useCallback)((function(e){var n,a,i;t.settings=e,v.a.language!==t.language&&v.a.changeLanguage(t.language),Bt(!1),Lt(void 0),Gt(ot),null===(n=A.current)||void 0===n||n.subtitleSettings(t.subtitleSettings),null===(a=A.current)||void 0===a||a.ankiSettings(t.ankiSettings),null===(i=A.current)||void 0===i||i.miscSettings(t.miscSettings),x.publishSharedGlobalSettings(t.miscSettings)}),[t,ot,x]),_n=Object(f.useCallback)((function(e){var t,n=[],a=Object(i.a)(Y);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.id!==r.id&&n.push(r)}}catch(s){a.e(s)}finally{a.f()}Q(n),G.delete(e.id)}),[Y,G]),Pn=Object(f.useCallback)((function(e){e===Ve.audioFileUrl&&Ke((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:void 0,audioFileUrl:void 0,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[Ve]),En=Object(f.useCallback)((function(e){e===Ve.videoFileUrl&&(Ke((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:void 0,videoFileUrl:void 0}})),E(!1))}),[Ve]),Rn=Object(f.useCallback)(function(){var e=Object(s.a)(b.a.mark((function e(n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Hr(n,void 0,t.audioPaddingStart,t.audioPaddingEnd);case 3:a=e.sent,t.preferMp3?a.toMp3().download():a.download(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),dn(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[dn,t]),Mn=Object(f.useCallback)(function(){var e=Object(s.a)(b.a.mark((function e(n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Wr(n,t.maxImageWidth,t.maxImageHeight);case 3:e.sent.download(),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0),dn(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),[dn,t]),An=Object(f.useCallback)((function(e,t){var a,r=[],s=Object(i.a)(t);try{var o=function(){var e=a.value;void 0===r.find((function(t){return t.start===e.start&&t.end===e.end&&t.text===e.text}))&&r.push(e)};for(s.s();!(a=s.n()).done;)o()}catch(c){s.e(c)}finally{s.f()}U(new Blob([n.subtitlesToSrt(r)],{type:"text/plain"}),"".concat(e,"_MiningHistory_").concat((new Date).toISOString(),".srt"))}),[n]),Bn=Object(f.useCallback)((function(t){ln.find((function(e){return e.name===t.subtitleFileName}))?Ne({text:t.text,start:t.start,end:t.end,originalStart:t.originalStart,originalEnd:t.originalEnd,track:t.track}):dn(e("error.subtitleFileNotOpen",{fileName:t.subtitleFileName}))}),[ln,dn,e]),In=Object(f.useCallback)((function(e){jt(e),ct(!0),bt(!1),Gt(!0)}),[]),Nn=Object(f.useCallback)((function(){ct(!1),bt(!1),Gt(!1),Ct&&(Et({timestamp:Date.now(),resume:!0}),wt(!1))}),[Ct]),Dn=Object(f.useCallback)((function(){if(gt)if(ln.find((function(e){return e.name===gt.subtitleFileName}))){var t={text:gt.text,start:gt.start,end:gt.end,originalStart:gt.originalStart,originalEnd:gt.originalEnd,track:gt.track};We(t),Nn()}else dn(e("error.subtitleFileNotOpen",{fileName:gt.subtitleFileName}))}),[gt,ln,Nn,dn,e]),Ln=Object(f.useCallback)((function(){if(gt){var e={text:gt.text,start:gt.start,end:gt.end,originalStart:gt.originalStart,originalEnd:gt.originalEnd,track:gt.track};L({timestamp:e.start}),Nn()}}),[gt,Nn]),Hn=Object(f.useCallback)((function(e){Zt(e),zt(!0)}),[]);Object(f.useEffect)((function(){return x.subscribeTabs((function(t){if(t.length!==sn.length)on(t);else{for(var n=!1,a=0;a<sn.length;++a){var i=sn[a],r=t[a];if(i.id!==r.id||i.title!==r.title||i.src!==r.src){n=!0;break}}n&&on(t)}var s=tn&&0===t.filter((function(e){return e.id===tn.id&&e.src===tn.src})).length;s&&(nn(void 0),dn(e("error.lostTabConnection",{tabName:tn.id+" "+tn.title})))}))}),[sn,tn,x,dn,e]);var Wn=Object(f.useCallback)((function(e){return nn(e)}),[]),Un=Object(f.useCallback)((function(e){try{var t=function(e){for(var t=[],n=void 0,a=void 0,i=0;i<e.length;++i){var r=e[i],s=r.name.lastIndexOf(".");if(-1===s)throw new Pr("error.unknownExtension",{fileName:r.name});var o=r.name.substring(s+1,r.name.length);switch(o){case"ass":case"srt":case"vtt":case"nfvtt":case"sup":case"ytxml":case"dfxp":case"ttml2":t.push(r);break;case"mkv":case"mp4":case"avi":if(a)throw new Pr("error.onlyOneVideoFile");a=r;break;case"mp3":case"m4a":case"aac":case"flac":case"ogg":case"wav":case"opus":if(n)throw new Pr("error.onlyOneAudioFile");n=r;break;default:throw new Pr("error.unsupportedExtension",{extension:o})}}if(a&&n)throw new Pr("error.bothAudioAndVideNotAllowed");return{subtitleFiles:t,audioFile:n,videoFile:a}}(e),n=t.subtitleFiles,a=t.audioFile,s=t.videoFile;if(Ke((function(e){var t=void 0,o=void 0;s||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),s?t=URL.createObjectURL(s):a&&(o=URL.createObjectURL(a)),nn(void 0)):(s=e.videoFile,t=e.videoFileUrl,a=e.audioFile,o=e.audioFileUrl);var c={subtitleFiles:0===n.length?e.subtitleFiles:n,audioFile:a,audioFileUrl:o,videoFile:s,videoFileUrl:t},u=function(e){return[].concat(Object(r.a)(e.subtitleFiles),[e.videoFile,e.audioFile]).filter((function(e){return void 0!==e}))},l=u(e),d=u(c).filter((function(e){var t,n=Object(i.a)(l);try{for(n.s();!(t=n.n()).done;){if(e===t.value)return!1}}catch(a){n.e(a)}finally{n.f()}return!0}));return Je(d),c})),n.length>0){var o=n[0].name;it(o.substring(0,o.lastIndexOf(".")))}}catch(c){console.error(c),dn(c)}}),[dn]),zn=Object(f.useCallback)(function(){var t=Object(s.a)(b.a.mark((function t(n){var a,r,s,o,c,u,l,d;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1===n.length){t.next=3;break}return dn(e("error.onlyOneDirectoryAllowed")),t.abrupt("return");case 3:if((a=n[0].webkitGetAsEntry())&&a.isDirectory){t.next=7;break}return dn(e("error.failedToLoadDirectory")),t.abrupt("return");case 7:return r=a,t.prev=8,t.next=11,new Promise((function(e,t){return r.createReader().readEntries(e,t)}));case 11:if(!(s=t.sent).find((function(e){return e.isDirectory}))){t.next=15;break}return dn(e("error.subdirectoriesNotAllowed")),t.abrupt("return");case 15:o=s.map((function(e){return new Promise((function(t,n){return e.file(t,n)}))})),c=[],u=Object(i.a)(o),t.prev=18,u.s();case 20:if((l=u.n()).done){t.next=29;break}return d=l.value,t.t0=c,t.next=25,d;case 25:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 27:t.next=20;break;case 29:t.next=34;break;case 31:t.prev=31,t.t2=t.catch(18),u.e(t.t2);case 34:return t.prev=34,u.f(),t.finish(34);case 37:Un(c),t.next=43;break;case 40:t.prev=40,t.t3=t.catch(8),dn(t.t3);case 43:case"end":return t.stop()}}),t,null,[[8,40],[18,31,34,37]])})));return function(e){return t.apply(this,arguments)}}(),[dn,Un,e]);Object(f.useEffect)((function(){if(!m){var e=x.subscribe((function(e){return t.apply(this,arguments)}));return x.startHeartbeat(!1),e}function t(){return t=Object(s.a)(b.a.mark((function e(t){var n,a,i,r,o,c,u,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("sync"!==t.data.command&&"syncv2"!==t.data.command){e.next=37;break}if(n=x.tabs.filter((function(e){return e.id===t.tabId&&(!t.src||e.src===t.src)})),0!==n.length){e.next=5;break}return t.src?console.error("Received sync request but the requesting tab ID "+t.tabId+" with src "+t.src+" was not found"):console.error("Received sync request but the requesting tab ID "+t.tabId+" was not found"),e.abrupt("return");case 5:if(a=n[0],r=!1,"sync"!==t.data.command){e.next=21;break}return o=t.data,e.t0=File,e.next=12,fetch("data:text/plain;base64,"+o.subtitles.base64);case 12:return e.next=14,e.sent.blob();case 14:e.t1=e.sent,e.t2=[e.t1],e.t3=o.subtitles.name,e.t4=new e.t0(e.t2,e.t3),i=[e.t4],e.next=31;break;case 21:if("syncv2"!==t.data.command){e.next=29;break}return u=t.data,e.next=25,Promise.all(u.subtitles.map(function(){var e=Object(s.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=File,e.next=3,fetch("data:text/plain;base64,"+t.base64);case 3:return e.next=5,e.sent.blob();case 5:return e.t1=e.sent,e.t2=[e.t1],e.t3=t.name,e.abrupt("return",new e.t0(e.t2,e.t3));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 25:i=e.sent,r=null!==(c=u.flatten)&&void 0!==c&&c,e.next=31;break;case 29:return console.error("Unknown message "+t.data.command),e.abrupt("return");case 31:l=i[0].name,it(l.substring(0,l.lastIndexOf("."))),Ke({subtitleFiles:i,flattenSubtitleFiles:r,audioFile:void 0,audioFileUrl:void 0,videoFile:void 0,videoFileUrl:void 0}),nn(a),e.next=38;break;case 37:"edit-keyboard-shortcuts"===t.data.command?(Bt(!0),Lt("keyboard-shortcuts")):"open-asbplayer-settings"===t.data.command&&Bt(!0);case 38:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}x.startHeartbeat(!0)}),[x,m]);var Vn=Object(f.useCallback)((function(t,n){switch(n){case oe.autoPause:Se(e("info.enabledAutoPause"));break;case oe.condensed:Se(e("info.enabledCondensedPlayback"));break;case oe.normal:t===oe.autoPause?Se(e("info.disabledAutoPause")):t===oe.condensed&&Se(e("info.disabledCondensedPlayback"))}Me("info"),_e(!0)}),[e]),Kn=Object(f.useCallback)((function(t){ot||(t.preventDefault(),m?dn(e("error.videoPlayerDragAndDropNotAllowed")):($e(!1),et.current=null,t.dataTransfer.items&&t.dataTransfer.items.length>0&&function(e){for(var t=0;t<e.length;++t){var n;if(null===(n=e[t].webkitGetAsEntry())||void 0===n||!n.isDirectory)return!1}return!0}(t.dataTransfer.items)?zn(t.dataTransfer.items):t.dataTransfer.files&&t.dataTransfer.files.length>0&&Un(t.dataTransfer.files)))}),[m,dn,Un,zn,ot,e]),qn=Object(f.useCallback)((function(){var e,t=null===(e=cn.current)||void 0===e?void 0:e.files;t&&t.length>0&&Un(t)}),[Un]),Gn=Object(f.useCallback)((function(){var e;return null===(e=cn.current)||void 0===e?void 0:e.click()}),[]),Xn=Object(f.useCallback)(Object(s.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==Ve.subtitleFiles){e.next=2;break}return e.abrupt("return");case 2:if(0!==(t=Ve.subtitleFiles.filter((function(e){return!e.name.endsWith(".sup")}))).length){e.next=5;break}return e.abrupt("return");case 5:return e.t0=U,e.t1=Blob,e.next=9,n.filesToSrt(t);case 9:e.t2=e.sent,e.t3=[e.t2],e.t4={type:"text/plain"},e.t5=new e.t1(e.t3,e.t4),e.t6="".concat(at,".srt"),(0,e.t0)(e.t5,e.t6);case 15:case"end":return e.stop()}}),e)}))),[at,Ve.subtitleFiles,n]),Jn=Object(f.useCallback)((function(e){ot||e.preventDefault()}),[ot]),Yn=Object(f.useCallback)((function(e){ot||(e.preventDefault(),e.stopPropagation(),m||(et.current=e.target,$e(!0)))}),[m,ot]),Qn=Object(f.useCallback)((function(e){e.nativeEvent.preventDefault(),e.nativeEvent.stopPropagation(),m||et.current!==e.target||$e(!1)}),[m]),Zn=Object(f.useCallback)((function(e){Je((function(t){return null===t||void 0===t?void 0:t.filter((function(t){var n,a=Object(i.a)(e);try{for(a.s();!(n=a.n()).done;){if(n.value===t)return!1}}catch(r){a.e(r)}finally{a.f()}return!0}))}))}),[]);Object(f.useEffect)((function(){if("settings"===j.get("view")&&(Bt(!0),h.hash&&h.hash.startsWith("#"))){var e=h.hash.substring(1,h.hash.length);Lt(e)}}),[j,h]),Object(f.useEffect)((function(){var e;Fe&&xe&&Re&&(null===(e=A.current)||void 0===e||e.alert(xe,Re))}),[xe,Re,Fe]);var $n=Object(f.useCallback)((function(e){navigator.clipboard.write([new ClipboardItem(Object(o.a)({},e.type,e))]).catch(console.error)}),[]),ea=function(){var e=Object(f.useState)(!1),t=Object(l.a)(e,2),n=t[0],a=t[1],i=Object(f.useState)(v.a.language),r=Object(l.a)(i,2),s=r[0],o=r[1];return Object(f.useEffect)((function(){k.then((function(){return a(!0)}))}),[]),Object(f.useEffect)((function(){return v.a.on("languageChanged",o),function(){return v.a.off("languageChanged",o)}}),[]),{i18nInitialized:n,language:s}}();if(!ea.i18nInitialized)return null;if("/"===h.pathname&&j.get("video"))return Object(pe.jsx)(zr,{searchParams:j});var ta=0!==Xe.length,na=ta&&!M.current||0===Ve.subtitleFiles.length&&!Ve.audioFile&&!Ve.videoFile,aa=void 0!==Ve.videoFile&&(se&&!me||P),ia=te&&!P;return Object(pe.jsxs)(C.a,{theme:u,children:[Object(pe.jsx)(pt.a,{}),Object(pe.jsxs)("div",{onDrop:Kn,onDragOver:Jn,onDragEnter:Yn,onDragLeave:Qn,children:[Object(pe.jsx)(je,{open:Fe,onClose:wn,autoHideDuration:3e3,severity:Re,children:xe}),Object(pe.jsxs)(O.d,{children:[Object(pe.jsx)(O.b,{path:"/video",element:Object(pe.jsxs)(pe.Fragment,{children:[Object(pe.jsx)(Vr,{searchParams:j,settingsProvider:t,playbackPreferences:a,extension:x,ankiDialogFinishedRequest:_t,ankiDialogOpen:ot,seekRequest:D,onAnkiDialogRequest:fn,onAnkiDialogRewind:Ln,onError:dn,onPlayModeChangedViaBind:Vn}),Object(pe.jsx)(vt,{open:ot,disabled:dt,audioClip:Ot,image:yt,source:Ur(gt),url:null===gt||void 0===gt?void 0:gt.url,sliderContext:mt,customFields:t.customAnkiFields,anki:d,settingsProvider:t,onCancel:Nn,onProceed:vn,onViewImage:Hn,onCopyToClipboard:$n}),Object(pe.jsx)(Te,{open:Ut,image:Qt,onClose:Tn})]})}),Object(pe.jsx)(O.b,{path:"/",element:Object(pe.jsxs)("div",{children:[Object(pe.jsx)(hn,{items:Y,open:ia,drawerWidth:q,onClose:kn,onDelete:_n,onClipAudio:Rn,onDownloadImage:Mn,onDownloadSectionAsSrt:An,onSelect:Bn,onAnki:In}),Object(pe.jsx)(vt,{open:ot,disabled:dt,audioClip:Ot,image:yt,source:Ur(gt),url:null===gt||void 0===gt?void 0:gt.url,sliderContext:mt,customFields:t.customAnkiFields,anki:d,settingsProvider:t,onCancel:Nn,onProceed:vn,onViewImage:Hn,onOpenSettings:Cn,onCopyToClipboard:$n}),Object(pe.jsx)(Te,{open:Ut,image:Qt,onClose:Tn}),Object(pe.jsx)(wi,{anki:d,extension:x,open:At,onClose:Fn,settings:t.settings,scrollToId:Dt}),Object(pe.jsx)(Xt,{title:at||"asbplayer",drawerWidth:q,drawerOpen:ia,hidden:aa,subtitleFiles:Ve.subtitleFiles,onOpenCopyHistory:jn,onDownloadSubtitleFilesAsSrt:Xn,onOpenSettings:Cn,onFileSelector:Gn}),Object(pe.jsx)("input",{ref:cn,onChange:qn,type:"file",accept:".srt,.ass,.vtt,.sup,.mp3,.m4a,.aac,.flac,.ogg,.wav,.opus,.mkv,.mp4,.avi",multiple:!0,hidden:!0}),Object(pe.jsxs)(Kr,{drawerWidth:q,drawerOpen:ia,children:[Object(pe.jsxs)("div",{style:{width:"100%",height:"100%",position:"relative"},children:[na&&Object(pe.jsx)(mn,{latestExtensionVersion:"0.28.0",extensionUrl:"https://github.com/killergerbah/asbplayer/releases/latest",extension:x,loading:ta,dragging:Ze,appBarHidden:aa,onFileSelector:Gn}),Object(pe.jsx)(kt,{dragging:Ze,appBarHidden:aa,loading:ta})]}),Object(pe.jsx)(za,{subtitleReader:n,settingsProvider:t,playbackPreferences:a,onCopy:gn,onError:dn,onUnloadAudio:Pn,onUnloadVideo:En,onLoaded:Zn,onTabSelected:Wn,onAnkiDialogRequest:bn,onAnkiDialogRewind:Dn,onAppBarToggle:On,onFullscreenToggle:yn,onHideSubtitlePlayer:xn,onVideoPopOut:Sn,onPlayModeChangedViaBind:Vn,onTakeScreenshot:pn,tab:tn,availableTabs:sn,sources:Ve,jumpToSubtitle:Ie,rewindSubtitle:He,videoFrameRef:M,videoChannelRef:A,extension:x,drawerOpen:ia,appBarHidden:aa,videoFullscreen:P,hideSubtitlePlayer:fe||P,videoPopOut:me,disableKeyEvents:qt,ankiDialogRequested:Ct,ankiDialogFinishedRequest:_t,keyBinder:R,ankiDialogOpen:ot})]})]})})]})]})]})},Gr=function(e){e&&e instanceof Function&&n.e(7).then(n.bind(null,498)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),i(e),r(e),s(e)}))};Object(a.createRoot)(document.querySelector("#root")).render(Object(pe.jsx)(y.a,{basename:"/asbplayer",children:Object(pe.jsx)(qr,{})})),Gr()}},[[402,1,2]]]);
//# sourceMappingURL=main.40e17fc8.chunk.js.map